import{r as i,j as e}from"./react-BLSrs4ew.js";import{I as a}from"./index-Bdeh4hUX.js";const W=({deal:s,onRateClick:m,onTrackClick:f,isGuest:c=!1,showRatingButton:v=!0})=>{var H,I,A,M;const[w,k]=i.useState(!1),[C,T]=i.useState(!1),[$,L]=i.useState(!1),[S,B]=i.useState(!1),[x,p]=i.useState(!1),[y,_]=i.useState(!1),g=i.useRef(null),u=((H=s.company)==null?void 0:H.overall_rating)||0,n=((I=s.company)==null?void 0:I.total_reviews)||0,j=!!s.userRating,P=(A=s.userRating)==null?void 0:A.rating_type,R=i.useCallback(()=>{f(s)},[s,f]),F=i.useCallback(()=>{m&&!c&&m(s)},[s,m,c]),V=i.useCallback(t=>{t.preventDefault(),t.stopPropagation(),p(r=>!r)},[]);i.useEffect(()=>{const t=()=>{if(x&&!y){const r=setTimeout(()=>{y||p(!1)},300);return()=>clearTimeout(r)}};if(g.current)return g.current.addEventListener("mouseleave",t),()=>{var r;(r=g.current)==null||r.removeEventListener("mouseleave",t)}},[x,y]);const D=i.useCallback(t=>t?(Array.isArray(t)?t:[t]).filter(d=>d&&String(d).trim()!=="").map(d=>{const o=String(d).trim();return o.toLowerCase().includes("terms and conditions")?{type:"header",content:o}:/^\d+\.\s+[A-Z\s&]+$/i.test(o)?{type:"section",content:o,level:1}:/^\d+\.\d+\s+/.test(o)?{type:"section",content:o,level:2}:/^[•▪▫-]\s+/.test(o)||/^\s{2,}[•▪▫-]\s+/.test(o)?{type:"bullet",content:o.replace(/^[\s•▪▫-]+/,"")}:{type:"paragraph",content:o}}):[],[])(s.terms),b=t=>t===0?"0.0":t.toFixed(1),z=t=>t.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),O=s.end_date&&new Date(s.end_date).getTime()-Date.now()<7*24*60*60*1e3,E=u>=4.5&&n>=10,N=n===0,Q=n>0&&n<10,h=n===0?{level:"unrated",color:"text-foreground/50",label:"No ratings yet"}:n<10?{level:"new",color:"text-success",label:"New platform"}:n<50?{level:"emerging",color:"text-success",label:"Growing community"}:n<100?{level:"established",color:"text-primary",label:"Established"}:{level:"trusted",color:"text-secondary",label:"Community trusted"},U=(t,r="w-4 h-4")=>e.jsx("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(l=>{if(t>=l)return e.jsx(a.star,{className:`${r} fill-warning text-warning`},l);if(t>l-1){const d=(t-(l-1))*100;return e.jsxs("div",{className:"relative",children:[e.jsx(a.star,{className:`${r} text-foreground/30`}),e.jsx("div",{className:"absolute inset-0 overflow-hidden",style:{width:`${d}%`},children:e.jsx(a.star,{className:`${r} text-warning fill-warning`})})]},l)}else return e.jsx(a.star,{className:`${r} text-foreground/30`},l)})}),Y=(t,r)=>{switch(t.type){case"header":return e.jsxs("div",{className:"text-center py-md animate-fade-in-up",style:{animationDelay:`${r*100}ms`},children:[e.jsx("h3",{className:"text-base font-bold text-foreground mb-sm",children:t.content}),e.jsx("div",{className:"w-12 h-0.5 bg-gradient-to-r from-primary to-secondary mx-auto rounded-full animate-pulse"})]},r);case"section":const l=t.level||1,d=l===1?"text-sm":"text-xs",o=l===1?"mt-md":"mt-sm";return e.jsxs("div",{className:`${o} mb-sm animate-slide-in-left`,style:{animationDelay:`${r*100}ms`},children:[e.jsxs("h4",{className:`${d} font-semibold text-foreground flex items-center gap-sm hover:text-primary transition-all duration-300 group hover:scale-105`,children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-gradient-to-r from-primary to-secondary rounded-full flex-shrink-0 group-hover:scale-125 transition-transform duration-300"}),t.content]}),e.jsx("div",{className:"w-full h-px bg-gradient-to-r from-divider/30 to-transparent mt-sm group-hover:from-primary/50 transition-colors duration-300"})]},r);case"bullet":return e.jsxs("div",{className:"flex items-start gap-sm ml-md py-xs hover:bg-content2/30 rounded-md container-px-sm transition-all duration-300 group animate-slide-in-left",style:{animationDelay:`${r*100}ms`},children:[e.jsx("div",{className:"w-1 h-1 bg-gradient-to-r from-primary to-secondary rounded-full mt-1.5 flex-shrink-0 group-hover:scale-125 transition-transform duration-300"}),e.jsx("p",{className:"text-foreground/80 leading-relaxed text-xs group-hover:text-foreground transition-colors duration-300",children:t.content})]},r);case"paragraph":return e.jsx("p",{className:"text-foreground/80 leading-relaxed text-xs hover:bg-content2/20 rounded-md container-p-sm transition-all duration-300 animate-fade-in-up hover:scale-105",style:{animationDelay:`${r*100}ms`},children:t.content},r);default:return null}};return e.jsxs("div",{ref:g,className:"group glass-enhanced rounded-2xl border border-divider/40 hover:border-primary/30 transition-all duration-500 hover:shadow-enhanced-lg hover:shadow-primary/10 card-hover-enhanced overflow-hidden flex flex-col h-full relative background-enhanced",onMouseEnter:()=>_(!0),onMouseLeave:()=>_(!1),children:[x&&e.jsxs("div",{className:"absolute inset-0 glass-enhanced z-20 overflow-hidden animate-scale-in duration-500 flex flex-col",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary/10 via-secondary/5 to-primary/10 container-p-lg border-b border-divider/30 flex-shrink-0",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-base font-bold text-foreground",children:"Terms & Conditions"}),e.jsx("p",{className:"text-xs text-foreground/60",children:s.company_name})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto container-p-lg scrollbar-thin scrollbar-thumb-primary/30 scrollbar-track-transparent",children:D.length>0?e.jsx("div",{className:"space-y-sm",children:D.map(Y)}):e.jsxs("div",{className:"text-center py-xl animate-scale-in duration-500",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary/10 to-secondary/10 rounded-xl flex items-center justify-center mx-auto mb-sm animate-pulse",children:e.jsx(a.document,{className:"w-6 h-6 text-primary/60"})}),e.jsx("h3",{className:"text-sm font-semibold text-foreground mb-sm",children:"No Terms Available"}),e.jsxs("p",{className:"text-xs text-foreground/60",children:["Please visit ",s.company_name,"'s website for complete terms and conditions."]})]})}),e.jsx("div",{className:"bg-content2/95 backdrop-blur-sm border-t border-divider/30 container-p-lg flex-shrink-0",children:e.jsxs("div",{className:"flex gap-sm",children:[e.jsx("button",{onClick:()=>p(!1),className:"flex-1 container-px-md container-py-sm text-foreground/70 border border-divider/50 rounded-lg hover:bg-content2 hover:text-foreground transition-all duration-300 font-medium text-sm hover:scale-105 active:scale-95 focus-enhanced",children:"Close"}),e.jsxs("button",{onClick:()=>{p(!1),R()},className:"btn-enhanced flex-1 container-px-md container-py-sm bg-gradient-to-r from-primary to-secondary text-white rounded-lg hover:shadow-enhanced hover:scale-105 active:scale-95 transition-all duration-300 font-medium text-sm flex items-center justify-center gap-xs focus-enhanced",children:[e.jsx(a.gift,{className:"w-3 h-3"}),"Claim Deal"]})]})})]}),e.jsxs("div",{className:`flex-1 flex flex-col transition-opacity duration-300 ${x?"opacity-0 pointer-events-none":"opacity-100"}`,children:[e.jsxs("div",{className:"container-p-lg pb-md",children:[e.jsxs("div",{className:"flex items-start justify-between my-md gap-sm",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[(M=s.company)!=null&&M.logo_url?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.company.logo_url,alt:`${s.company_name} logo`,className:`w-16 h-16 rounded-xl object-cover bg-content2 border-2 border-divider/50 group-hover:border-primary/50 transition-all duration-300 shadow-sm hover:shadow-md ${$?"opacity-100 scale-100":"opacity-0 scale-95"}`,onLoad:()=>L(!0),onError:t=>{const r=t.target;r.style.display="none",L(!0)}}),!$&&e.jsx("div",{className:"absolute inset-0 w-16 h-16 bg-gradient-to-br from-content2 to-content3 animate-shimmer rounded-xl border-2 border-divider/50"})]}):e.jsx("div",{className:"w-16 h-16 rounded-xl bg-gradient-to-br from-primary/20 to-secondary/20 flex items-center justify-center border-2 border-divider/50 group-hover:border-primary/50 transition-all duration-300 shadow-sm",children:e.jsx(a.arrowTrendingUp,{className:"w-8 h-8 text-primary"})}),E&&e.jsx("div",{className:"absolute -top-2 -right-2 w-7 h-7 bg-gradient-to-r from-warning to-warning/80 rounded-full flex items-center justify-center shadow-enhanced border-2 border-white animate-pulse-glow",children:e.jsx(a.trophy,{className:"w-4 h-4 text-warning-foreground"})}),N&&e.jsx("div",{className:"absolute -top-2 -right-2 w-7 h-7 bg-gradient-to-r from-success to-success/80 rounded-full flex items-center justify-center shadow-enhanced border-2 border-white animate-float",children:e.jsx(a.sparkles,{className:"w-4 h-4 text-success-foreground"})}),h.level==="trusted"&&e.jsx("div",{className:"absolute -top-2 -right-2 w-7 h-7 bg-gradient-to-r from-secondary to-secondary/80 rounded-full flex items-center justify-center shadow-enhanced border-2 border-white",children:e.jsx(a.shield,{className:"w-4 h-4 text-secondary-foreground"})})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-medium text-sm text-foreground group-hover:text-primary transition-colors truncate",children:s.company_name}),e.jsxs("div",{className:"mt-1",children:[n>0?e.jsxs("div",{className:"flex items-center gap-2",children:[U(u,"w-3 h-3"),e.jsx("span",{className:"text-sm font-medium text-foreground",children:b(u)}),e.jsxs("div",{className:"flex items-center gap-1 text-primary",children:[e.jsx(a.users,{className:"w-3 h-3"}),e.jsx("span",{className:"text-xs font-medium",children:n.toLocaleString()})]})]}):e.jsxs("div",{className:"flex items-center gap-1 text-foreground/60 text-xs",children:[e.jsx(a.star,{className:"w-3 h-3"}),e.jsx("span",{children:"No ratings yet"})]}),e.jsx("div",{className:`text-xs ${h.color} font-medium mt-1`,children:h.label})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 items-end flex-shrink-0",children:[e.jsx("span",{className:"px-3 py-1 bg-primary/10 text-primary text-xs font-medium rounded-full whitespace-nowrap border border-primary/20",children:z(s.category||"")}),O&&e.jsx("span",{className:"px-2 py-1 bg-danger/10 text-danger text-xs font-medium rounded-full border border-danger/20 animate-pulse",children:"Ending Soon"}),E&&e.jsx("span",{className:"px-2 py-1 bg-warning/10 text-warning text-xs font-medium rounded-full border border-warning/20",children:"Top Rated"}),N&&e.jsx("span",{className:"px-2 py-1 bg-success/10 text-success text-xs font-medium rounded-full border border-success/20",children:"New Platform"})]})]}),e.jsxs("div",{className:"my-md container-p-sm glass rounded-xl border border-divider/30",children:[e.jsxs("button",{onClick:()=>B(!S),className:"w-full flex items-center justify-between hover:text-primary transition-colors focus-enhanced",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx(a.chart,{className:"w-4 h-4 text-primary flex-shrink-0"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Community Ratings"})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:n>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[U(u,"w-3 h-3"),e.jsx("span",{className:"font-semibold text-foreground text-sm",children:b(u)})]}),e.jsxs("div",{className:"flex items-center gap-1 text-primary",children:[e.jsx(a.users,{className:"w-3 h-3 flex-shrink-0"}),e.jsx("span",{className:"font-semibold text-xs",children:n.toLocaleString()})]})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a.bolt,{className:"w-4 h-4 text-success flex-shrink-0 animate-pulse"}),e.jsx("span",{className:"text-xs text-success font-medium",children:"Be first!"})]})})]}),S&&e.jsx("div",{className:"mt-sm pt-sm border-t border-divider/30 animate-fade-in-up",children:n>0?e.jsxs("div",{className:"space-y-sm",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-foreground/70",children:"Community Trust"}),e.jsx("span",{className:`font-medium ${h.color}`,children:h.label})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-foreground/70",children:"Average Rating"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a.star,{className:"w-4 h-4 fill-warning text-warning"}),e.jsxs("span",{className:"font-medium text-foreground",children:[b(u)," / 5.0"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-foreground/70",children:"Total Reviews"}),e.jsxs("span",{className:"font-medium text-primary",children:[n.toLocaleString()," trader",n!==1?"s":""]})]})]}):e.jsxs("div",{className:"text-center py-2",children:[e.jsxs("p",{className:"text-sm text-foreground/70 mb-2",children:["No ratings yet for ",e.jsx("span",{className:"font-medium text-primary",children:s.company_name})]}),e.jsx("p",{className:"text-xs text-success",children:"Be the first to share your experience!"})]})})]}),e.jsxs("div",{className:"my-md",children:[e.jsx("h2",{className:"text-base font-semibold text-foreground my-sm line-clamp-2 leading-snug break-words",children:s.title}),s.bonus_amount&&e.jsxs("div",{className:"relative overflow-hidden bg-gradient-to-r from-secondary/20 to-primary/20 rounded-lg container-p-md my-sm h-16 flex items-center border border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-sm w-full",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-secondary to-primary rounded-lg flex items-center justify-center flex-shrink-0 shadow-sm",children:e.jsx(a.gift,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-xs text-foreground/70 font-medium",children:"Bonus Offer"}),e.jsx("div",{className:"text-primary font-semibold text-sm truncate",children:s.bonus_amount})]}),e.jsx(a.sparkles,{className:"w-4 h-4 text-primary/50 flex-shrink-0 animate-pulse"})]}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/5 to-secondary/5 translate-x-full group-hover:translate-x-0 transition-transform duration-700"})]})]}),e.jsx("p",{className:"text-foreground/70 my-md line-clamp-3 text-sm leading-relaxed",children:s.description}),s.features&&s.features.length>0&&e.jsx("div",{className:"my-md",children:e.jsxs("div",{className:"flex flex-wrap gap-sm",children:[s.features.slice(0,3).map((t,r)=>e.jsx("span",{className:"text-xs bg-content2 border border-divider/50 text-foreground/70 container-px-sm container-py-xs rounded-full hover:border-primary/30 transition-colors animate-scale-in",style:{animationDelay:`${r*100}ms`},children:t},r)),s.features.length>3&&e.jsxs("span",{className:"text-xs text-primary font-medium container-px-sm container-py-xs bg-primary/10 rounded-full border border-primary/20",children:["+",s.features.length-3," more"]})]})}),!c&&j&&e.jsx("div",{className:"my-md container-p-sm bg-gradient-to-r from-primary/5 to-secondary/5 border border-primary/20 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-sm",children:[e.jsx(a.success,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-sm text-primary font-medium",children:"You rated this company"})]}),e.jsxs("div",{className:"text-xs text-primary bg-white container-px-xs container-py-xs rounded-full",children:[P==="overall"?"Quick":"Detailed"," rating"]})]})})]}),e.jsx("div",{className:"flex-1"})]}),e.jsxs("div",{className:`container-p-lg pt-0 mt-auto transition-opacity duration-300 ${x?"opacity-0 pointer-events-none":"opacity-100"}`,children:[e.jsxs("div",{className:"flex items-center gap-md text-xs text-foreground/70 my-md bg-content2/50 rounded-lg container-p-sm border border-divider/30",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a.time,{className:"w-3 h-3"}),e.jsx("span",{children:s.end_date?`Expires ${new Date(s.end_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}`:"No expiration date"})]}),s.commission_rate&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(a.arrowTrendingUp,{className:"w-3 h-3"}),e.jsxs("span",{children:[s.commission_rate,"% commission"]})]})]}),e.jsxs("div",{className:"flex gap-sm",children:[e.jsx("button",{onClick:R,onMouseEnter:()=>k(!0),onMouseLeave:()=>k(!1),className:"btn-enhanced flex-1 relative overflow-hidden bg-gradient-to-r from-primary to-secondary text-white font-medium text-sm container-py-sm container-px-md rounded-lg transition-all duration-300 hover:shadow-enhanced hover:scale-105 group/button focus-enhanced",children:e.jsxs("div",{className:"flex items-center justify-center gap-xs relative z-10",children:[e.jsx(a.gift,{className:`w-4 h-4 transition-transform duration-300 ${w?"scale-110 rotate-12":""}`}),e.jsx("span",{children:"Claim Deal"}),e.jsx(a.externalLink,{className:`w-3 h-3 transition-transform duration-300 ${w?"scale-110 translate-x-1":""}`})]})}),!c&&v&&m&&e.jsxs("button",{onClick:F,onMouseEnter:()=>T(!0),onMouseLeave:()=>T(!1),className:"bg-content2 hover:bg-content3 border border-divider/50 hover:border-primary/50 text-foreground font-medium text-sm container-py-sm container-px-md rounded-lg transition-all duration-300 hover:shadow-md group/rate relative card-hover-enhanced focus-enhanced",title:j?"Update your rating":"Rate this company",children:[e.jsxs("div",{className:"flex items-center gap-xs",children:[e.jsx(a.chat,{className:`w-4 h-4 transition-transform duration-300 ${C?"scale-110":""}`}),e.jsx("span",{className:"hidden sm:inline",children:j?"Update":"Rate"})]}),C&&n>0&&e.jsx("div",{className:"absolute -top-1 -right-1 bg-primary text-white text-xs px-2 py-1 rounded-full font-medium shadow-enhanced z-10 min-w-6 text-center animate-scale-in",children:n})]})]}),e.jsx("div",{className:"mt-md flex justify-center",children:e.jsx("button",{onClick:V,className:"text-xs text-foreground/70 hover:text-primary transition-all duration-300 underline hover:no-underline container-px-md container-py-sm rounded-lg hover:bg-content2/50 focus-enhanced hover:scale-105 active:scale-95",children:"Terms & Conditions"})}),!c&&e.jsx(e.Fragment,{children:N?e.jsx("div",{className:"mt-sm text-center",children:e.jsxs("p",{className:"text-xs text-foreground/70",children:["Be the first to rate ",e.jsx("span",{className:"font-medium text-primary",children:s.company_name})," ","and help other traders!"]})}):Q?e.jsx("div",{className:"mt-sm text-center",children:e.jsxs("p",{className:"text-xs text-foreground/70",children:["Help build trust - ",e.jsx("span",{className:"font-medium text-primary",children:s.company_name})," ","needs more community reviews"]})}):e.jsx("div",{className:"mt-sm text-center",children:e.jsxs("p",{className:"text-xs text-foreground/70",children:["Trusted by ",e.jsxs("span",{className:"font-medium text-primary",children:[n.toLocaleString()," traders"]})," ","in our community"]})})}),c&&e.jsx("div",{className:"mt-sm text-center",children:e.jsxs("p",{className:"text-xs text-foreground/70",children:[e.jsx("span",{className:"font-medium text-primary",children:"Sign up"})," to rate companies and help the community!"]})})]}),e.jsx("div",{className:`absolute inset-0 bg-gradient-to-br from-primary/5 to-secondary/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none rounded-2xl ${x?"hidden":""}`})]})};function X(s,m){const[f,c]=i.useState(s);return i.useEffect(()=>{const v=setTimeout(()=>{c(s)},m);return()=>{clearTimeout(v)}},[s,m]),f}export{W as U,X as u};
