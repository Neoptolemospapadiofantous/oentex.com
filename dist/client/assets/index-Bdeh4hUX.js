const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BlXsuAM4.js","assets/heroui-JiUKaMRz.js","assets/react-BLSrs4ew.js","assets/Home-CxUxCIMk.js","assets/useCategoriesQuery-0ABQ9AHS.js","assets/AdUnit-D08rCYKY.js","assets/seoData-CTirrqCc.js","assets/About-DP5XpUcz.js","assets/Button-CblVTRug.js","assets/About--O8PPgEZ.css","assets/Deals-BR4nWU8J.js","assets/useDebounce-BhvfB8js.js","assets/RatingModal-B9-vOiIm.js","assets/useDealsQuery-DN0f-7FY.js","assets/FAQ-D5_rktkM.js","assets/Contact-x96LgbJK.js","assets/Terms-DRavkIlj.js","assets/Privacy-DAMOe8A9.js","assets/Authentication-gi9y3J0A.js","assets/AuthCallback-XWfgbNRf.js","assets/ResetPassword-W1Tb2RJR.js","assets/Unsubscribe-CgMfGXiu.js","assets/Dashboard-B7Ip_2vW.js","assets/Deals-B5hcy_gQ.js","assets/MyDeals-CdSsdiA0.js","assets/Profile-BAA2W5m0.js"])))=>i.map(i=>d[i]);
var Pr=Object.defineProperty;var Cr=(n,e,t)=>e in n?Pr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ue=(n,e,t)=>Cr(n,typeof e!="symbol"?e+"":e,t);import{r as m,j as a,J as er,K as Lr,L as Dr,M as Ur,N as Fr,O as St,P as Mr,Q as Br,S as tr,T as zr,U as Wr,V as kt,W as qr,X as Vr,Y as Kr,Z as Gr,_ as Tt,a0 as Hr,a1 as Nt,a2 as Jr,a3 as Yr,a4 as Xr,a5 as Rt,a6 as Qr,a7 as At,a8 as Zr,a9 as es,aa as ts,ab as rr,ac as rs,ad as ss,ae as ns,af as is,ag as as,ah as os,ai as ls,aj as cs,ak as ds,al as us,am as hs,an as fs,ao as gs,ap as ms,aq as ps,ar as vs,as as bs,at as ws,au as Ot,av as ys,aw as xs,ax as _s,ay as js,az as Es,aA as Ss,aB as ks,aC as Ts,aD as Ns,aE as Rs,aF as As,aG as Os,aH as Is,aI as $s,aJ as Ps,aK as Cs,aL as Ls,aM as Ds,aN as Us,aO as Fs,aP as Ms,aQ as Bs,aR as zs,aS as Ws,aT as qs,aU as Vs,aV as Ks,aW as Gs,aX as Hs,aY as Js,aZ as Ys,a_ as Xs,a$ as Qs,b0 as Zs,b1 as en,b2 as tn,b3 as rn,b4 as sn,b5 as nn,b6 as an,b7 as on,b8 as ln,b9 as cn,ba as dn,bb as un,bc as hn,bd as fn,be as gn,bf as mn,bg as _e,bh as gt,bi as pn,bj as X,bk as mt,bl as $,bm as It,bn as vn,bo as bn,R as wn,bp as yn,bq as xn,br as _n}from"./react-BLSrs4ew.js";import{a as C,b as jn,c as V,m as En,d as Sn,e as kn,f as Tn,h as Nn,i as ke,s as tt,j as Rn,k as An,l as On,n as In,o as je,H as $n}from"./heroui-JiUKaMRz.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const Pn=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>C(async()=>{const{default:r}=await Promise.resolve().then(()=>$e);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)};class pt extends Error{constructor(e,t="FunctionsError",r){super(e),this.name=t,this.context=r}}class Cn extends pt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class $t extends pt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Pt extends pt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var rt;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(rt||(rt={}));var Ln=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(l,c)}u((r=r.apply(n,e||[])).next())})};class Dn{constructor(e,{headers:t={},customFetch:r,region:s=rt.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=Pn(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var r;return Ln(this,void 0,void 0,function*(){try{const{headers:s,method:i,body:o}=t;let l={},{region:c}=t;c||(c=this.region);const u=new URL(`${this.url}/${e}`);c&&c!=="any"&&(l["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let d;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",d=o):typeof o=="string"?(l["Content-Type"]="text/plain",d=o):typeof FormData<"u"&&o instanceof FormData?d=o:(l["Content-Type"]="application/json",d=JSON.stringify(o)));const h=yield this.fetch(u.toString(),{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),s),body:d}).catch(y=>{throw new Cn(y)}),g=h.headers.get("x-relay-error");if(g&&g==="true")throw new $t(h);if(!h.ok)throw new Pt(h);let f=((r=h.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),v;return f==="application/json"?v=yield h.json():f==="application/octet-stream"?v=yield h.blob():f==="text/event-stream"?v=h:f==="multipart/form-data"?v=yield h.formData():v=yield h.text(),{data:v,error:null,response:h}}catch(s){return{data:null,error:s,response:s instanceof Pt||s instanceof $t?s.context:void 0}}})}}var z={},vt={},Be={},Ie={},ze={},We={},Un=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},we=Un();const Fn=we.fetch,sr=we.fetch.bind(we),nr=we.Headers,Mn=we.Request,Bn=we.Response,$e=Object.freeze(Object.defineProperty({__proto__:null,Headers:nr,Request:Mn,Response:Bn,default:sr,fetch:Fn},Symbol.toStringTag,{value:"Module"})),zn=jn($e);var qe={};Object.defineProperty(qe,"__esModule",{value:!0});let Wn=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};qe.default=Wn;var ir=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(We,"__esModule",{value:!0});const qn=ir(zn),Vn=ir(qe);let Kn=class{constructor(e){var t,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=qn.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const r=this.fetch;let s=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var o,l,c,u;let d=null,h=null,g=null,f=i.status,v=i.statusText;if(i.ok){if(this.method!=="HEAD"){const x=await i.text();x===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?h=x:h=JSON.parse(x))}const p=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),b=(c=i.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");p&&b&&b.length>1&&(g=parseInt(b[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(h)&&(h.length>1?(d={code:"PGRST116",details:`Results contain ${h.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},h=null,g=null,f=406,v="Not Acceptable"):h.length===1?h=h[0]:h=null)}else{const p=await i.text();try{d=JSON.parse(p),Array.isArray(d)&&i.status===404&&(h=[],d=null,f=200,v="OK")}catch{i.status===404&&p===""?(f=204,v="No Content"):d={message:p}}if(d&&this.isMaybeSingle&&(!((u=d==null?void 0:d.details)===null||u===void 0)&&u.includes("0 rows"))&&(d=null,f=200,v="OK"),d&&this.shouldThrowOnError)throw new Vn.default(d)}return{error:d,data:h,count:g,status:f,statusText:v}});return this.shouldThrowOnError||(s=s.catch(i=>{var o,l,c;return{error:{message:`${(o=i==null?void 0:i.name)!==null&&o!==void 0?o:"FetchError"}: ${i==null?void 0:i.message}`,details:`${(l=i==null?void 0:i.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=i==null?void 0:i.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};We.default=Kn;var Gn=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ze,"__esModule",{value:!0});const Hn=Gn(We);let Jn=class extends Hn.default{select(e){let t=!1;const r=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:r,foreignTable:s,referencedTable:i=s}={}){const o=i?`${i}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:r=t}={}){const s=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:r,referencedTable:s=r}={}){const i=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:r=!1,buffers:s=!1,wal:i=!1,format:o="text"}={}){var l;const c=[e?"analyze":null,t?"verbose":null,r?"settings":null,s?"buffers":null,i?"wal":null].filter(Boolean).join("|"),u=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};ze.default=Jn;var Yn=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Ie,"__esModule",{value:!0});const Xn=Yn(ze);let Qn=class extends Xn.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const r=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:r,type:s}={}){let i="";s==="plain"?i="pl":s==="phrase"?i="ph":s==="websearch"&&(i="w");const o=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${i}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,r])=>{this.url.searchParams.append(t,`eq.${r}`)}),this}not(e,t,r){return this.url.searchParams.append(e,`not.${t}.${r}`),this}or(e,{foreignTable:t,referencedTable:r=t}={}){const s=r?`${r}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,r){return this.url.searchParams.append(e,`${t}.${r}`),this}};Ie.default=Qn;var Zn=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Be,"__esModule",{value:!0});const Ee=Zn(Ie);let ei=class{constructor(e,{headers:t={},schema:r,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=r,this.fetch=s}select(e,{head:t=!1,count:r}={}){const s=t?"HEAD":"GET";let i=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!i?"":(l==='"'&&(i=!i),l)).join("");return this.url.searchParams.set("select",o),r&&this.headers.append("Prefer",`count=${r}`),new Ee.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:r=!0}={}){var s;const i="POST";if(t&&this.headers.append("Prefer",`count=${t}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new Ee.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:r=!1,count:s,defaultToNull:i=!0}={}){var o;const l="POST";if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),s&&this.headers.append("Prefer",`count=${s}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const c=e.reduce((u,d)=>u.concat(Object.keys(d)),[]);if(c.length>0){const u=[...new Set(c)].map(d=>`"${d}"`);this.url.searchParams.set("columns",u.join(","))}}return new Ee.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(e,{count:t}={}){var r;const s="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Ee.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:e}={}){var t;const r="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Ee.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};Be.default=ei;var ar=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(vt,"__esModule",{value:!0});const ti=ar(Be),ri=ar(Ie);let si=class or{constructor(e,{headers:t={},schema:r,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=r,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new ti.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new or(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:r=!1,get:s=!1,count:i}={}){var o;let l;const c=new URL(`${this.url}/rpc/${e}`);let u;r||s?(l=r?"HEAD":"GET",Object.entries(t).filter(([h,g])=>g!==void 0).map(([h,g])=>[h,Array.isArray(g)?`{${g.join(",")}}`:`${g}`]).forEach(([h,g])=>{c.searchParams.append(h,g)})):(l="POST",u=t);const d=new Headers(this.headers);return i&&d.set("Prefer",`count=${i}`),new ri.default({method:l,url:c,headers:d,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};vt.default=si;var ye=V&&V.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(z,"__esModule",{value:!0});z.PostgrestError=z.PostgrestBuilder=z.PostgrestTransformBuilder=z.PostgrestFilterBuilder=z.PostgrestQueryBuilder=z.PostgrestClient=void 0;const lr=ye(vt);z.PostgrestClient=lr.default;const cr=ye(Be);z.PostgrestQueryBuilder=cr.default;const dr=ye(Ie);z.PostgrestFilterBuilder=dr.default;const ur=ye(ze);z.PostgrestTransformBuilder=ur.default;const hr=ye(We);z.PostgrestBuilder=hr.default;const fr=ye(qe);z.PostgrestError=fr.default;var ni=z.default={PostgrestClient:lr.default,PostgrestQueryBuilder:cr.default,PostgrestFilterBuilder:dr.default,PostgrestTransformBuilder:ur.default,PostgrestBuilder:hr.default,PostgrestError:fr.default};const{PostgrestClient:ii,PostgrestQueryBuilder:Ko,PostgrestFilterBuilder:Go,PostgrestTransformBuilder:Ho,PostgrestBuilder:Jo,PostgrestError:Yo}=ni;class ai{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const r=t.node,s=parseInt(r.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const r=this.getWebSocketConstructor();return new r(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const oi="2.15.5",li=`realtime-js/${oi}`,ci="1.0.0",st=1e4,di=1e3,ui=100;var Te;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(Te||(Te={}));var L;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(L||(L={}));var G;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(G||(G={}));var nt;(function(n){n.websocket="websocket"})(nt||(nt={}));var ce;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(ce||(ce={}));class hi{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,t,r)}_decodeBroadcast(e,t,r){const s=t.getUint8(1),i=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=r.decode(e.slice(o,o+s));o=o+s;const c=r.decode(e.slice(o,o+i));o=o+i;const u=JSON.parse(r.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:c,payload:u}}}class gr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var A;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(A||(A={}));const Ct=(n,e,t={})=>{var r;const s=(r=t.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((i,o)=>(i[o]=fi(o,n,e,s),i),{})},fi=(n,e,t,r)=>{const s=e.find(l=>l.name===n),i=s==null?void 0:s.type,o=t[n];return i&&!r.includes(i)?mr(i,o):it(o)},mr=(n,e)=>{if(n.charAt(0)==="_"){const t=n.slice(1,n.length);return vi(e,t)}switch(n){case A.bool:return gi(e);case A.float4:case A.float8:case A.int2:case A.int4:case A.int8:case A.numeric:case A.oid:return mi(e);case A.json:case A.jsonb:return pi(e);case A.timestamp:return bi(e);case A.abstime:case A.date:case A.daterange:case A.int4range:case A.int8range:case A.money:case A.reltime:case A.text:case A.time:case A.timestamptz:case A.timetz:case A.tsrange:case A.tstzrange:return it(e);default:return it(e)}},it=n=>n,gi=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},mi=n=>{if(typeof n=="string"){const e=parseFloat(n);if(!Number.isNaN(e))return e}return n},pi=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch(e){return console.log(`JSON parse error: ${e}`),n}return n},vi=(n,e)=>{if(typeof n!="string")return n;const t=n.length-1,r=n[t];if(n[0]==="{"&&r==="}"){let i;const o=n.slice(1,t);try{i=JSON.parse("["+o+"]")}catch{i=o?o.split(","):[]}return i.map(l=>mr(e,l))}return n},bi=n=>typeof n=="string"?n.replace(" ","T"):n,pr=n=>{let e=n;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Ge{constructor(e,t,r={},s=st){this.channel=e,this.event=t,this.payload=r,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var r;return this._hasReceived(e)&&t((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Lt;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(Lt||(Lt={}));class Ne{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const r=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},s=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ne.syncState(this.state,s,i,o),this.pendingDiffs.forEach(c=>{this.state=Ne.syncDiff(this.state,c,i,o)}),this.pendingDiffs=[],l()}),this.channel._on(r.diff,{},s=>{const{onJoin:i,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Ne.syncDiff(this.state,s,i,o),l())}),this.onJoin((s,i,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:i,newPresences:o})}),this.onLeave((s,i,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:i,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,r,s){const i=this.cloneDeep(e),o=this.transformState(t),l={},c={};return this.map(i,(u,d)=>{o[u]||(c[u]=d)}),this.map(o,(u,d)=>{const h=i[u];if(h){const g=d.map(p=>p.presence_ref),f=h.map(p=>p.presence_ref),v=d.filter(p=>f.indexOf(p.presence_ref)<0),y=h.filter(p=>g.indexOf(p.presence_ref)<0);v.length>0&&(l[u]=v),y.length>0&&(c[u]=y)}else l[u]=d}),this.syncDiff(i,{joins:l,leaves:c},r,s)}static syncDiff(e,t,r,s){const{joins:i,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return r||(r=()=>{}),s||(s=()=>{}),this.map(i,(l,c)=>{var u;const d=(u=e[l])!==null&&u!==void 0?u:[];if(e[l]=this.cloneDeep(c),d.length>0){const h=e[l].map(f=>f.presence_ref),g=d.filter(f=>h.indexOf(f.presence_ref)<0);e[l].unshift(...g)}r(l,d,c)}),this.map(o,(l,c)=>{let u=e[l];if(!u)return;const d=c.map(h=>h.presence_ref);u=u.filter(h=>d.indexOf(h.presence_ref)<0),e[l]=u,s(l,u,c),u.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(r=>t(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,r)=>{const s=e[r];return"metas"in s?t[r]=s.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):t[r]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Dt;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(Dt||(Dt={}));var Re;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(Re||(Re={}));var Y;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(Y||(Y={}));class bt{constructor(e,t={config:{}},r){this.topic=e,this.params=t,this.socket=r,this.bindings={},this.state=L.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Ge(this,G.join,this.params,this.timeout),this.rejoinTimer=new gr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=L.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=L.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=L.errored,this.rejoinTimer.scheduleTimeout())}),this._on(G.reply,{},(s,i)=>{this._trigger(this._replyEventName(i),s)}),this.presence=new Ne(this),this.broadcastEndpointURL=pr(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var r,s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==L.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,u=(s=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&s!==void 0?s:[],d=!!this.bindings[Re.PRESENCE]&&this.bindings[Re.PRESENCE].length>0||((i=this.params.config.presence)===null||i===void 0?void 0:i.enabled)===!0,h={},g={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:d}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this._onError(f=>e==null?void 0:e(Y.CHANNEL_ERROR,f)),this._onClose(()=>e==null?void 0:e(Y.CLOSED)),this.updateJoinPayload(Object.assign({config:g},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:f})=>{var v;if(this.socket.setAuth(),f===void 0){e==null||e(Y.SUBSCRIBED);return}else{const y=this.bindings.postgres_changes,p=(v=y==null?void 0:y.length)!==null&&v!==void 0?v:0,b=[];for(let x=0;x<p;x++){const w=y[x],{filter:{event:E,schema:S,table:T,filter:U}}=w,Q=f&&f[x];if(Q&&Q.event===E&&Q.schema===S&&Q.table===T&&Q.filter===U)b.push(Object.assign(Object.assign({},w),{id:Q.id}));else{this.unsubscribe(),this.state=L.errored,e==null||e(Y.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=b,e&&e(Y.SUBSCRIBED);return}}).receive("error",f=>{this.state=L.errored,e==null||e(Y.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Y.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,r){return this.state===L.joined&&e===Re.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,r)}async send(e,t={}){var r,s;if(!this._canPush()&&e.type==="broadcast"){const{event:i,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(r=t.timeout)!==null&&r!==void 0?r:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var o,l,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&i("ok"),u.receive("ok",()=>i("ok")),u.receive("error",()=>i("error")),u.receive("timeout",()=>i("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=L.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(G.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(s=>{r=new Ge(this,G.leave,{},e),r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r==null||r.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=L.closed,this.bindings={}}async _fetchWithTimeout(e,t,r){const s=new AbortController,i=setTimeout(()=>s.abort(),r),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(i),o}_push(e,t,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Ge(this,e,t,r);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>ui){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,r){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,r){var s,i;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:u,join:d}=G;if(r&&[l,c,u,d].indexOf(o)>=0&&r!==this._joinRef())return;let g=this._onMessage(o,t,r);if(t&&!g)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(f=>{var v,y,p;return((v=f.filter)===null||v===void 0?void 0:v.event)==="*"||((p=(y=f.filter)===null||y===void 0?void 0:y.event)===null||p===void 0?void 0:p.toLocaleLowerCase())===o}).map(f=>f.callback(g,r)):(i=this.bindings[o])===null||i===void 0||i.filter(f=>{var v,y,p,b,x,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in f){const E=f.id,S=(v=f.filter)===null||v===void 0?void 0:v.event;return E&&((y=t.ids)===null||y===void 0?void 0:y.includes(E))&&(S==="*"||(S==null?void 0:S.toLocaleLowerCase())===((p=t.data)===null||p===void 0?void 0:p.type.toLocaleLowerCase()))}else{const E=(x=(b=f==null?void 0:f.filter)===null||b===void 0?void 0:b.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return E==="*"||E===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===o}).map(f=>{if(typeof g=="object"&&"ids"in g){const v=g.data,{schema:y,table:p,commit_timestamp:b,type:x,errors:w}=v;g=Object.assign(Object.assign({},{schema:y,table:p,commit_timestamp:b,eventType:x,new:{},old:{},errors:w}),this._getPayloadRecords(v))}f.callback(g,r)})}_isClosed(){return this.state===L.closed}_isJoined(){return this.state===L.joined}_isJoining(){return this.state===L.joining}_isLeaving(){return this.state===L.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,r){const s=e.toLocaleLowerCase(),i={type:s,filter:t,callback:r};return this.bindings[s]?this.bindings[s].push(i):this.bindings[s]=[i],this}_off(e,t){const r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(s=>{var i;return!(((i=s.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&bt.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(e[r]!==t[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(G.close,{},e)}_onError(e){this._on(G.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=L.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Ct(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Ct(e.columns,e.old_record)),t}}const He=()=>{},Ce={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},wi=[1e3,2e3,5e3,1e4],yi=1e4,xi=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class _i{constructor(e,t){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=st,this.transport=null,this.heartbeatIntervalMs=Ce.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=He,this.ref=0,this.reconnectTimer=null,this.logger=He,this.conn=null,this.sendBuffer=[],this.serializer=new hi,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let i;return s?i=s:typeof fetch>"u"?i=(...o)=>C(async()=>{const{default:l}=await import("./index-BlXsuAM4.js");return{default:l}},__vite__mapDeps([0,1,2])).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):i=fetch,(...o)=>i(...o)},!(!((r=t==null?void 0:t.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${nt.websocket}`,this.httpEndpoint=pr(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=ai.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:ci}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,r){this.logger(e,t,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Te.connecting:return ce.Connecting;case Te.open:return ce.Open;case Te.closing:return ce.Closing;default:return ce.Closed}}isConnected(){return this.connectionState()===ce.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const r=`realtime:${e}`,s=this.getChannels().find(i=>i.topic===r);if(s)return s;{const i=new bt(`realtime:${e}`,t,this);return this.channels.push(i),i}}push(e){const{topic:t,event:r,payload:s,ref:i}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${r} (${i})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(di,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Ce.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:r,event:s,payload:i,ref:o}=t,l=o?`(${o})`:"",c=i.status||"";this.log("receive",`${c} ${r} ${s} ${l}`.trim(),i),this.channels.filter(u=>u._isMember(r)).forEach(u=>u._trigger(s,i,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(G.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const r=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${r}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const r=new Blob([xi],{type:"application/javascript"});t=URL.createObjectURL(r)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(r=>{const s={access_token:t,version:li};t&&r.updateJoinPayload(s),r.joinedOnce&&r._isJoined()&&r._push(G.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new gr(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Ce.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,r,s,i,o,l,c,u,d;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(r=e==null?void 0:e.timeout)!==null&&r!==void 0?r:st,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Ce.HEARTBEAT_INTERVAL,this.worker=(i=e==null?void 0:e.worker)!==null&&i!==void 0?i:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:He,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:h=>wi[h-1]||yi,this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:(h,g)=>g(JSON.stringify(h)),this.decode=(d=e==null?void 0:e.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class wt extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function D(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}class ji extends wt{constructor(e,t,r){super(e),this.name="StorageApiError",this.status=t,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class at extends wt{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Ei=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(l,c)}u((r=r.apply(n,e||[])).next())})};const vr=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>C(async()=>{const{default:r}=await Promise.resolve().then(()=>$e);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},Si=()=>Ei(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield C(()=>Promise.resolve().then(()=>$e),void 0)).Response:Response}),ot=n=>{if(Array.isArray(n))return n.map(t=>ot(t));if(typeof n=="function"||n!==Object(n))return n;const e={};return Object.entries(n).forEach(([t,r])=>{const s=t.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));e[s]=ot(r)}),e},ki=n=>{if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)};var de=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(l,c)}u((r=r.apply(n,e||[])).next())})};const Je=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Ti=(n,e,t)=>de(void 0,void 0,void 0,function*(){const r=yield Si();n instanceof r&&!(t!=null&&t.noResolveJson)?n.json().then(s=>{const i=n.status||500,o=(s==null?void 0:s.statusCode)||i+"";e(new ji(Je(s),i,o))}).catch(s=>{e(new at(Je(s),s))}):e(new at(Je(n),n))}),Ni=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"||!r?s:(ki(r)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(r)):s.body=r,e!=null&&e.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function Pe(n,e,t,r,s,i){return de(this,void 0,void 0,function*(){return new Promise((o,l)=>{n(t,Ni(e,r,s,i)).then(c=>{if(!c.ok)throw c;return r!=null&&r.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>Ti(c,l,r))})})}function Fe(n,e,t,r){return de(this,void 0,void 0,function*(){return Pe(n,"GET",e,t,r)})}function H(n,e,t,r,s){return de(this,void 0,void 0,function*(){return Pe(n,"POST",e,r,s,t)})}function lt(n,e,t,r,s){return de(this,void 0,void 0,function*(){return Pe(n,"PUT",e,r,s,t)})}function Ri(n,e,t,r){return de(this,void 0,void 0,function*(){return Pe(n,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),r)})}function br(n,e,t,r,s){return de(this,void 0,void 0,function*(){return Pe(n,"DELETE",e,r,s,t)})}var M=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(l,c)}u((r=r.apply(n,e||[])).next())})};const Ai={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ut={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Oi{constructor(e,t={},r,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=r,this.fetch=vr(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,r,s){return M(this,void 0,void 0,function*(){try{let i;const o=Object.assign(Object.assign({},Ut),s);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",o.cacheControl),c&&i.append("metadata",this.encodeMetadata(c))):(i=r,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s!=null&&s.headers&&(l=Object.assign(Object.assign({},l),s.headers));const u=this._removeEmptyFolders(t),d=this._getFinalPath(u),h=yield(e=="PUT"?lt:H)(this.fetch,`${this.url}/object/${d}`,i,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:h.Id,fullPath:h.Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(D(i))return{data:null,error:i};throw i}})}upload(e,t,r){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,r)})}uploadToSignedUrl(e,t,r,s){return M(this,void 0,void 0,function*(){const i=this._removeEmptyFolders(e),o=this._getFinalPath(i),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:Ut.upsert},s),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&r instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",r)):typeof FormData<"u"&&r instanceof FormData?(c=r,c.append("cacheControl",u.cacheControl)):(c=r,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const h=yield lt(this.fetch,l.toString(),c,{headers:d});return{data:{path:i,fullPath:h.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(D(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return M(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const i=yield H(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:s}),o=new URL(this.url+i.url),l=o.searchParams.get("token");if(!l)throw new wt("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(D(r))return{data:null,error:r};throw r}})}update(e,t,r){return M(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,r)})}move(e,t,r){return M(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(D(s))return{data:null,error:s};throw s}})}copy(e,t,r){return M(this,void 0,void 0,function*(){try{return{data:{path:(yield H(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:r==null?void 0:r.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(D(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,r){return M(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),i=yield H(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},r!=null&&r.transform?{transform:r.transform}:{}),{headers:this.headers});const o=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${o}`)},{data:i,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(D(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,r){return M(this,void 0,void 0,function*(){try{const s=yield H(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=r!=null&&r.download?`&download=${r.download===!0?"":r.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${i}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(D(s))return{data:null,error:s};throw s}})}download(e,t){return M(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=i?`?${i}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield Fe(this.fetch,`${this.url}/${s}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(D(l))return{data:null,error:l};throw l}})}info(e){return M(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const r=yield Fe(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:ot(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(D(r))return{data:null,error:r};throw r}})}exists(e){return M(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ri(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(D(r)&&r instanceof at){const s=r.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,t){const r=this._getFinalPath(e),s=[],i=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";i!==""&&s.push(i);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&s.push(c);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${r}${u}`)}}}remove(e){return M(this,void 0,void 0,function*(){try{return{data:yield br(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(D(t))return{data:null,error:t};throw t}})}list(e,t,r){return M(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},Ai),t),{prefix:e||""});return{data:yield H(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},r),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(D(s))return{data:null,error:s};throw s}})}listV2(e,t){return M(this,void 0,void 0,function*(){try{const r=Object.assign({},e);return{data:yield H(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},t),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(D(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Ii="2.12.1",$i={"X-Client-Info":`storage-js/${Ii}`};var he=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(l,c)}u((r=r.apply(n,e||[])).next())})};class Pi{constructor(e,t={},r,s){this.shouldThrowOnError=!1;const i=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href,this.headers=Object.assign(Object.assign({},$i),t),this.fetch=vr(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return he(this,void 0,void 0,function*(){try{return{data:yield Fe(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(D(e))return{data:null,error:e};throw e}})}getBucket(e){return he(this,void 0,void 0,function*(){try{return{data:yield Fe(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(D(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return he(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(D(r))return{data:null,error:r};throw r}})}updateBucket(e,t){return he(this,void 0,void 0,function*(){try{return{data:yield lt(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(D(r))return{data:null,error:r};throw r}})}emptyBucket(e){return he(this,void 0,void 0,function*(){try{return{data:yield H(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(D(t))return{data:null,error:t};throw t}})}deleteBucket(e){return he(this,void 0,void 0,function*(){try{return{data:yield br(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(D(t))return{data:null,error:t};throw t}})}}class Ci extends Pi{constructor(e,t={},r,s){super(e,t,r,s)}from(e){return new Oi(this.url,this.headers,e,this.fetch)}}const Li="2.57.4";let Se="";typeof Deno<"u"?Se="deno":typeof document<"u"?Se="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Se="react-native":Se="node";const Di={"X-Client-Info":`supabase-js-${Se}/${Li}`},Ui={headers:Di},Fi={schema:"public"},Mi={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Bi={};var zi=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(l,c)}u((r=r.apply(n,e||[])).next())})};const Wi=n=>{let e;return n?e=n:typeof fetch>"u"?e=sr:e=fetch,(...t)=>e(...t)},qi=()=>typeof Headers>"u"?nr:Headers,Vi=(n,e,t)=>{const r=Wi(t),s=qi();return(i,o)=>zi(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:n;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",n),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),r(i,Object.assign(Object.assign({},o),{headers:u}))})};var Ki=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(l,c)}u((r=r.apply(n,e||[])).next())})};function Gi(n){return n.endsWith("/")?n:n+"/"}function Hi(n,e){var t,r;const{db:s,auth:i,realtime:o,global:l}=n,{db:c,auth:u,realtime:d,global:h}=e,g={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},u),i),realtime:Object.assign(Object.assign({},d),o),storage:{},global:Object.assign(Object.assign(Object.assign({},h),l),{headers:Object.assign(Object.assign({},(t=h==null?void 0:h.headers)!==null&&t!==void 0?t:{}),(r=l==null?void 0:l.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>Ki(this,void 0,void 0,function*(){return""})};return n.accessToken?g.accessToken=n.accessToken:delete g.accessToken,g}function Ji(n){const e=n==null?void 0:n.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(Gi(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const wr="2.71.1",ve=30*1e3,ct=3,Ye=ct*ve,Yi="http://localhost:9999",Xi="supabase.auth.token",Qi={"X-Client-Info":`gotrue-js/${wr}`},dt="X-Supabase-Api-Version",yr={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},Zi=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,ea=10*60*1e3;class yt extends Error{constructor(e,t,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=r}}function j(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class ta extends yt{constructor(e,t,r){super(e,t,r),this.name="AuthApiError",this.status=t,this.code=r}}function ra(n){return j(n)&&n.name==="AuthApiError"}class xr extends yt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ne extends yt{constructor(e,t,r,s){super(e,r,s),this.name=t,this.status=r}}class re extends ne{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function sa(n){return j(n)&&n.name==="AuthSessionMissingError"}class Le extends ne{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class De extends ne{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Ue extends ne{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function na(n){return j(n)&&n.name==="AuthImplicitGrantRedirectError"}class Ft extends ne{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class ut extends ne{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Xe(n){return j(n)&&n.name==="AuthRetryableFetchError"}class Mt extends ne{constructor(e,t,r){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=r}}class ht extends ne{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const Me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Bt=` 	
\r=`.split(""),ia=(()=>{const n=new Array(128);for(let e=0;e<n.length;e+=1)n[e]=-1;for(let e=0;e<Bt.length;e+=1)n[Bt[e].charCodeAt(0)]=-2;for(let e=0;e<Me.length;e+=1)n[Me[e].charCodeAt(0)]=e;return n})();function zt(n,e,t){if(n!==null)for(e.queue=e.queue<<8|n,e.queuedBits+=8;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Me[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const r=e.queue>>e.queuedBits-6&63;t(Me[r]),e.queuedBits-=6}}function _r(n,e,t){const r=ia[n];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function Wt(n){const e=[],t=o=>{e.push(String.fromCodePoint(o))},r={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},i=o=>{la(o,r,t)};for(let o=0;o<n.length;o+=1)_r(n.charCodeAt(o),s,i);return e.join("")}function aa(n,e){if(n<=127){e(n);return}else if(n<=2047){e(192|n>>6),e(128|n&63);return}else if(n<=65535){e(224|n>>12),e(128|n>>6&63),e(128|n&63);return}else if(n<=1114111){e(240|n>>18),e(128|n>>12&63),e(128|n>>6&63),e(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function oa(n,e){for(let t=0;t<n.length;t+=1){let r=n.charCodeAt(t);if(r>55295&&r<=56319){const s=(r-55296)*1024&65535;r=(n.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}aa(r,e)}}function la(n,e,t){if(e.utf8seq===0){if(n<=127){t(n);return}for(let r=1;r<6;r+=1)if(!(n>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=n&31;else if(e.utf8seq===3)e.codepoint=n&15;else if(e.utf8seq===4)e.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|n&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ca(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};for(let s=0;s<n.length;s+=1)_r(n.charCodeAt(s),t,r);return new Uint8Array(e)}function da(n){const e=[];return oa(n,t=>e.push(t)),new Uint8Array(e)}function ua(n){const e=[],t={queue:0,queuedBits:0},r=s=>{e.push(s)};return n.forEach(s=>zt(s,t,r)),zt(null,t,r),e.join("")}function ha(n){return Math.round(Date.now()/1e3)+n}function fa(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){const e=Math.random()*16|0;return(n=="x"?e:e&3|8).toString(16)})}const K=()=>typeof window<"u"&&typeof document<"u",ae={tested:!1,writable:!1},jr=()=>{if(!K())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ae.tested)return ae.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),ae.tested=!0,ae.writable=!0}catch{ae.tested=!0,ae.writable=!1}return ae.writable};function ga(n){const e={},t=new URL(n);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,i)=>{e[i]=s})}catch{}return t.searchParams.forEach((r,s)=>{e[s]=r}),e}const Er=n=>{let e;return n?e=n:typeof fetch>"u"?e=(...t)=>C(async()=>{const{default:r}=await Promise.resolve().then(()=>$e);return{default:r}},void 0).then(({default:r})=>r(...t)):e=fetch,(...t)=>e(...t)},ma=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",be=async(n,e,t)=>{await n.setItem(e,JSON.stringify(t))},oe=async(n,e)=>{const t=await n.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},ee=async(n,e)=>{await n.removeItem(e)};class Ve{constructor(){this.promise=new Ve.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ve.promiseConstructor=Promise;function Qe(n){const e=n.split(".");if(e.length!==3)throw new ht("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!Zi.test(e[r]))throw new ht("JWT not in base64url format");return{header:JSON.parse(Wt(e[0])),payload:JSON.parse(Wt(e[1])),signature:ca(e[2]),raw:{header:e[0],payload:e[1]}}}async function pa(n){return await new Promise(e=>{setTimeout(()=>e(null),n)})}function va(n,e){return new Promise((r,s)=>{(async()=>{for(let i=0;i<1/0;i++)try{const o=await n(i);if(!e(i,null,o)){r(o);return}}catch(o){if(!e(i,o)){s(o);return}}})()})}function ba(n){return("0"+n.toString(16)).substr(-2)}function wa(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=t.length;let s="";for(let i=0;i<56;i++)s+=t.charAt(Math.floor(Math.random()*r));return s}return crypto.getRandomValues(e),Array.from(e,ba).join("")}async function ya(n){const t=new TextEncoder().encode(n),r=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(r);return Array.from(s).map(i=>String.fromCharCode(i)).join("")}async function xa(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const t=await ya(n);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function fe(n,e,t=!1){const r=wa();let s=r;t&&(s+="/PASSWORD_RECOVERY"),await be(n,`${e}-code-verifier`,s);const i=await xa(r);return[i,r===i?"plain":"s256"]}const _a=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function ja(n){const e=n.headers.get(dt);if(!e||!e.match(_a))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Ea(n){if(!n)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(n<=e)throw new Error("JWT has expired")}function Sa(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ka=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function ge(n){if(!ka.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Ze(){const n={};return new Proxy(n,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const r=t.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function qt(n){return JSON.parse(JSON.stringify(n))}var Ta=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};const le=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),Na=[502,503,504];async function Vt(n){var e;if(!ma(n))throw new ut(le(n),0);if(Na.includes(n.status))throw new ut(le(n),n.status);let t;try{t=await n.json()}catch(i){throw new xr(le(i),i)}let r;const s=ja(n);if(s&&s.getTime()>=yr["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?r=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(r=t.error_code),r){if(r==="weak_password")throw new Mt(le(t),n.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new re}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((i,o)=>i&&typeof o=="string",!0))throw new Mt(le(t),n.status,t.weak_password.reasons);throw new ta(le(t),n.status||500,r)}const Ra=(n,e,t,r)=>{const s={method:n,headers:(e==null?void 0:e.headers)||{}};return n==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(r),Object.assign(Object.assign({},s),t))};async function k(n,e,t,r){var s;const i=Object.assign({},r==null?void 0:r.headers);i[dt]||(i[dt]=yr["2024-01-01"].name),r!=null&&r.jwt&&(i.Authorization=`Bearer ${r.jwt}`);const o=(s=r==null?void 0:r.query)!==null&&s!==void 0?s:{};r!=null&&r.redirectTo&&(o.redirect_to=r.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await Aa(n,e,t+l,{headers:i,noResolveJson:r==null?void 0:r.noResolveJson},{},r==null?void 0:r.body);return r!=null&&r.xform?r==null?void 0:r.xform(c):{data:Object.assign({},c),error:null}}async function Aa(n,e,t,r,s,i){const o=Ra(e,r,s,i);let l;try{l=await n(t,Object.assign({},o))}catch(c){throw console.error(c),new ut(le(c),0)}if(l.ok||await Vt(l),r!=null&&r.noResolveJson)return l;try{return await l.json()}catch(c){await Vt(c)}}function J(n){var e;let t=null;Pa(n)&&(t=Object.assign({},n),n.expires_at||(t.expires_at=ha(n.expires_in)));const r=(e=n.user)!==null&&e!==void 0?e:n;return{data:{session:t,user:r},error:null}}function Kt(n){const e=J(n);return!e.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((t,r)=>t&&typeof r=="string",!0)&&(e.data.weak_password=n.weak_password),e}function se(n){var e;return{data:{user:(e=n.user)!==null&&e!==void 0?e:n},error:null}}function Oa(n){return{data:n,error:null}}function Ia(n){const{action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i}=n,o=Ta(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:r,redirect_to:s,verification_type:i},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function $a(n){return n}function Pa(n){return n.access_token&&n.refresh_token&&n.expires_in}const et=["global","local","others"];var Ca=function(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(n);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(n,r[s])&&(t[r[s]]=n[r[s]]);return t};class La{constructor({url:e="",headers:t={},fetch:r}){this.url=e,this.headers=t,this.fetch=Er(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=et[0]){if(et.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${et.join(", ")}`);try{return await k(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(j(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,t={}){try{return await k(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:se})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{const{options:t}=e,r=Ca(e,["options"]),s=Object.assign(Object.assign({},r),t);return"newEmail"in r&&(s.new_email=r==null?void 0:r.newEmail,delete s.newEmail),await k(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:Ia,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(j(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await k(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:se})}catch(t){if(j(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,r,s,i,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},d=await k(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:"",per_page:(i=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&i!==void 0?i:""},xform:$a});if(d.error)throw d.error;const h=await d.json(),g=(o=d.headers.get("x-total-count"))!==null&&o!==void 0?o:0,f=(c=(l=d.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return f.length>0&&(f.forEach(v=>{const y=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),p=JSON.parse(v.split(";")[1].split("=")[1]);u[`${p}Page`]=y}),u.total=parseInt(g)),{data:Object.assign(Object.assign({},h),u),error:null}}catch(u){if(j(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){ge(e);try{return await k(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:se})}catch(t){if(j(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){ge(e);try{return await k(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:se})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,t=!1){ge(e);try{return await k(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:se})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){ge(e.userId);try{const{data:t,error:r}=await k(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:r}}catch(t){if(j(t))return{data:null,error:t};throw t}}async _deleteFactor(e){ge(e.userId),ge(e.id);try{return{data:await k(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(j(t))return{data:null,error:t};throw t}}}function Gt(n={}){return{getItem:e=>n[e]||null,setItem:(e,t)=>{n[e]=t},removeItem:e=>{delete n[e]}}}function Da(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const me={debug:!!(globalThis&&jr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class Sr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Ua extends Sr{}async function Fa(n,e,t){me.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,e);const r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),me.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async s=>{if(s){me.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,s.name);try{return await t()}finally{me.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,s.name)}}else{if(e===0)throw me.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new Ua(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(me.debug)try{const i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Da();const Ma={url:Yi,storageKey:Xi,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Qi,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Ht(n,e,t){return await t()}const pe={};class Oe{constructor(e){var t,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=Oe.nextInstanceID,Oe.nextInstanceID+=1,this.instanceID>0&&K()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},Ma),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new La({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=Er(s.fetch),this.lock=s.lock||Ht,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:K()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=Fa:this.lock=Ht,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:jr()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Gt(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=Gt(this.memoryStorage)),K()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(i){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",i)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async i=>{this._debug("received broadcast notification from other tab or client",i),await this._notifyAllSubscribers(i.data.event,i.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=pe[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){pe[this.storageKey]=Object.assign(Object.assign({},pe[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=pe[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){pe[this.storageKey]=Object.assign(Object.assign({},pe[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${wr}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=ga(window.location.href);let r="none";if(this._isImplicitGrantCallback(t)?r="implicit":await this._isPKCECallback(t)&&(r="pkce"),K()&&this.detectSessionInUrl&&r!=="none"){const{data:s,error:i}=await this._getSessionFromURL(t,r);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),na(i)){const c=(e=i.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:i}}return await this._removeSession(),{error:i}}const{session:o,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return j(t)?{error:t}:{error:new xr("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,r,s;try{const i=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:J}),{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(j(i))return{data:{user:null,session:null},error:i};throw i}}async signUp(e){var t,r,s;try{let i;if("email"in e){const{email:d,password:h,options:g}=e;let f=null,v=null;this.flowType==="pkce"&&([f,v]=await fe(this.storage,this.storageKey)),i=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:g==null?void 0:g.emailRedirectTo,body:{email:d,password:h,data:(t=g==null?void 0:g.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken},code_challenge:f,code_challenge_method:v},xform:J})}else if("phone"in e){const{phone:d,password:h,options:g}=e;i=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:h,data:(r=g==null?void 0:g.data)!==null&&r!==void 0?r:{},channel:(s=g==null?void 0:g.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:g==null?void 0:g.captchaToken}},xform:J})}else throw new De("You must provide either an email or phone number and a password");const{data:o,error:l}=i;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(j(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithPassword(e){try{let t;if("email"in e){const{email:i,password:o,options:l}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Kt})}else if("phone"in e){const{phone:i,password:o,options:l}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:i,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:Kt})}else throw new De("You must provide either an email or phone number and a password");const{data:r,error:s}=t;return s?{data:{user:null,session:null},error:s}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Le}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:s})}catch(t){if(j(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,r,s,i;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(i=e.options)===null||i===void 0?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,r,s,i,o,l,c,u,d,h,g,f;let v,y;if("message"in e)v=e.message,y=e.signature;else{const{chain:p,wallet:b,statement:x,options:w}=e;let E;if(K())if(typeof b=="object")E=b;else{const T=window;if("solana"in T&&typeof T.solana=="object"&&("signIn"in T.solana&&typeof T.solana.signIn=="function"||"signMessage"in T.solana&&typeof T.solana.signMessage=="function"))E=T.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof b!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=b}const S=new URL((t=w==null?void 0:w.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const T=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:S.host,uri:S.href}),x?{statement:x}:null));let U;if(Array.isArray(T)&&T[0]&&typeof T[0]=="object")U=T[0];else if(T&&typeof T=="object"&&"signedMessage"in T&&"signature"in T)U=T;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in U&&"signature"in U&&(typeof U.signedMessage=="string"||U.signedMessage instanceof Uint8Array)&&U.signature instanceof Uint8Array)v=typeof U.signedMessage=="string"?U.signedMessage:new TextDecoder().decode(U.signedMessage),y=U.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${S.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...x?["",x,""]:[""],"Version: 1",`URI: ${S.href}`,`Issued At: ${(s=(r=w==null?void 0:w.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((i=w==null?void 0:w.signInWithSolana)===null||i===void 0)&&i.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((h=(d=w==null?void 0:w.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||h===void 0)&&h.length?["Resources",...w.signInWithSolana.resources.map(U=>`- ${U}`)]:[]].join(`
`);const T=await E.signMessage(new TextEncoder().encode(v),"utf8");if(!T||!(T instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");y=T}}try{const{data:p,error:b}=await k(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:ua(y)},!((g=e.options)===null||g===void 0)&&g.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:J});if(b)throw b;return!p||!p.session||!p.user?{data:{user:null,session:null},error:new Le}:(p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),{data:Object.assign({},p),error:b})}catch(p){if(j(p))return{data:{user:null,session:null},error:p};throw p}}async _exchangeCodeForSession(e){const t=await oe(this.storage,`${this.storageKey}-code-verifier`),[r,s]=(t??"").split("/");try{const{data:i,error:o}=await k(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:J});if(await ee(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!i||!i.session||!i.user?{data:{user:null,session:null,redirectType:null},error:new Le}:(i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",i.session)),{data:Object.assign(Object.assign({},i),{redirectType:s??null}),error:o})}catch(i){if(j(i))return{data:{user:null,session:null,redirectType:null},error:i};throw i}}async signInWithIdToken(e){try{const{options:t,provider:r,token:s,access_token:i,nonce:o}=e,l=await k(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:s,access_token:i,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:J}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Le}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(j(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,r,s,i,o;try{if("email"in e){const{email:l,options:c}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await fe(this.storage,this.storageKey));const{error:h}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in e){const{phone:l,options:c}=e,{data:u,error:d}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(i=c==null?void 0:c.shouldCreateUser)!==null&&i!==void 0?i:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:d}}throw new De("You must provide either an email or phone number.")}catch(l){if(j(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,r;try{let s,i;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,i=(r=e.options)===null||r===void 0?void 0:r.captchaToken);const{data:o,error:l}=await k(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:s,xform:J});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(j(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,r,s;try{let i=null,o=null;return this.flowType==="pkce"&&([i,o]=await fe(this.storage,this.storageKey)),await k(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&r!==void 0?r:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:o}),headers:this.headers,xform:Oa})}catch(i){if(j(i))return{data:null,error:i};throw i}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:r}=e;if(r)throw r;if(!t)throw new re;const{error:s}=await k(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(j(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:r,type:s,options:i}=e,{error:o}=await k(this.fetch,"POST",t,{headers:this.headers,body:{email:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}},redirectTo:i==null?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:r,type:s,options:i}=e,{data:o,error:l}=await k(this.fetch,"POST",t,{headers:this.headers,body:{phone:r,type:s,gotrue_meta_security:{captcha_token:i==null?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new De("You must provide either an email or phone number and a type")}catch(t){if(j(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await r,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const r=t();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await oe(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const r=e.expires_at?e.expires_at*1e3-Date.now()<Ye:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){const o=await oe(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=Ze()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{session:null},error:i}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:se}):await this._useSession(async t=>{var r,s,i;const{data:o,error:l}=t;if(l)throw l;return!(!((r=o.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new re}:await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(i=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0,xform:se})})}catch(t){if(j(t))return sa(t)&&(await this._removeSession(),await ee(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async r=>{const{data:s,error:i}=r;if(i)throw i;if(!s.session)throw new re;const o=s.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await fe(this.storage,this.storageKey));const{data:u,error:d}=await k(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:se});if(d)throw d;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(r){if(j(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new re;const t=Date.now()/1e3;let r=t,s=!0,i=null;const{payload:o}=Qe(e.access_token);if(o.exp&&(r=o.exp,s=r<=t),s){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};i=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;i={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:r-t,expires_at:r},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(t){if(j(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var r;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(r=o.session)!==null&&r!==void 0?r:void 0}if(!(e!=null&&e.refresh_token))throw new re;const{session:s,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(j(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!K())throw new Ue("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ue(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Ft("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ue("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ft("No code detected.");const{data:x,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:x.session,redirectType:null},error:null}}const{provider_token:r,provider_refresh_token:s,access_token:i,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=e;if(!i||!l||!o||!u)throw new Ue("No session defined in URL");const d=Math.round(Date.now()/1e3),h=parseInt(l);let g=d+h;c&&(g=parseInt(c));const f=g-d;f*1e3<=ve&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${h}s`);const v=g-h;d-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,g,d):d-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,g,d);const{data:y,error:p}=await this._getUser(i);if(p)throw p;const b={provider_token:r,provider_refresh_token:s,access_token:i,expires_in:h,expires_at:g,refresh_token:o,token_type:u,user:y.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(r){if(j(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await oe(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{error:i};const o=(r=s.session)===null||r===void 0?void 0:r.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(ra(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await ee(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=fa(),r={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async t=>{var r,s;try{const{data:{session:i},error:o}=t;if(o)throw o;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",i)),this._debug("INITIAL_SESSION","callback id",e,"session",i)}catch(i){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",i),console.error(i)}})}async resetPasswordForEmail(e,t={}){let r=null,s=null;this.flowType==="pkce"&&([r,s]=await fe(this.storage,this.storageKey,!0));try{return await k(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(i){if(j(i))return{data:null,error:i};throw i}}async getUserIdentities(){var e;try{const{data:t,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(j(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:r,error:s}=await this._useSession(async i=>{var o,l,c,u,d;const{data:h,error:g}=i;if(g)throw g;const f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await k(this.fetch,"GET",f,{headers:this.headers,jwt:(d=(u=h.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(s)throw s;return K()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(r==null?void 0:r.url),{data:{provider:e.provider,url:r==null?void 0:r.url},error:null}}catch(r){if(j(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)throw o;return await k(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(r=i.session)===null||r===void 0?void 0:r.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(j(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const r=Date.now();return await va(async s=>(s>0&&await pa(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await k(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:J})),(s,i)=>{const o=200*Math.pow(2,s);return i&&Xe(i)&&Date.now()+o-r<ve})}catch(r){if(this._debug(t,"error",r),j(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",r),K()&&!t.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,t;const r="#_recoverAndRefresh()";this._debug(r,"begin");try{const s=await oe(this.storage,this.storageKey);if(s&&this.userStorage){let o=await oe(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await be(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:Ze()}else if(s&&!s.user&&!s.user){const o=await oe(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await ee(this.storage,this.storageKey+"-user"),await be(this.storage,this.storageKey,s)):s.user=Ze()}if(this._debug(r,"session from storage",s),!this._isValidSession(s)){this._debug(r,"session is not valid"),s!==null&&await this._removeSession();return}const i=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Ye;if(this._debug(r,`session has${i?"":" not"} expired with margin of ${Ye}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),Xe(o)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(s.access_token);!l&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(r,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(r,"error",s),console.error(s);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var t,r;if(!e)throw new re;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new Ve;const{data:i,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!i.session)throw new re;await this._saveSession(i.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",i.session);const l={session:i.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(i){if(this._debug(s,"error",i),j(i)){const o={session:null,error:i};return Xe(i)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(i),i}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,r=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:t});const i=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){i.push(c)}});if(await Promise.all(o),i.length>0){for(let l=0;l<i.length;l+=1)console.error(i[l]);throw i[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),r=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&t.user&&await be(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const i=qt(s);await be(this.storage,this.storageKey,i)}else{const s=qt(t);await be(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await ee(this.storage,this.storageKey),await ee(this.storage,this.storageKey+"-code-verifier"),await ee(this.storage,this.storageKey+"-user"),this.userStorage&&await ee(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&K()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ve);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:r}}=t;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((r.expires_at*1e3-e)/ve);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${ve}ms, refresh threshold is ${ct} ticks`),s<=ct&&await this._callRefreshToken(r.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Sr)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!K()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,r){const s=[`provider=${encodeURIComponent(t)}`];if(r!=null&&r.redirectTo&&s.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r!=null&&r.scopes&&s.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){const[i,o]=await fe(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(i)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(l.toString())}if(r!=null&&r.queryParams){const i=new URLSearchParams(r.queryParams);s.push(i.toString())}return r!=null&&r.skipBrowserRedirect&&s.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await k(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(j(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var r,s;const{data:i,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await k(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(r=i==null?void 0:i.session)===null||r===void 0?void 0:r.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((s=c==null?void 0:c.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(j(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;if(i)return{data:null,error:i};const{data:o,error:l}=await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(j(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var r;const{data:s,error:i}=t;return i?{data:null,error:i}:await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=s==null?void 0:s.session)===null||r===void 0?void 0:r.access_token})})}catch(t){if(j(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const r=(e==null?void 0:e.factors)||[],s=r.filter(o=>o.factor_type==="totp"&&o.status==="verified"),i=r.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:r,totp:s,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,r;const{data:{session:s},error:i}=e;if(i)return{data:null,error:i};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Qe(s.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((r=(t=s.user.factors)===null||t===void 0?void 0:t.filter(h=>h.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(c="aal2");const d=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let r=t.keys.find(l=>l.kid===e);if(r)return r;const s=Date.now();if(r=this.jwks.keys.find(l=>l.kid===e),r&&this.jwks_cached_at+ea>s)return r;const{data:i,error:o}=await k(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!i.keys||i.keys.length===0||(this.jwks=i,this.jwks_cached_at=s,r=i.keys.find(l=>l.kid===e),!r)?null:r}async getClaims(e,t={}){try{let r=e;if(!r){const{data:f,error:v}=await this.getSession();if(v||!f.session)return{data:null,error:v};r=f.session.access_token}const{header:s,payload:i,signature:o,raw:{header:l,payload:c}}=Qe(r);t!=null&&t.allowExpired||Ea(i.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:i,header:s,signature:o},error:null}}const d=Sa(s.alg),h=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,h,o,da(`${l}.${c}`)))throw new ht("Invalid JWT signature");return{data:{claims:i,header:s,signature:o},error:null}}catch(r){if(j(r))return{data:null,error:r};throw r}}}Oe.nextInstanceID=0;const Ba=Oe;class za extends Ba{constructor(e){super(e)}}var Wa=function(n,e,t,r){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function l(d){try{u(r.next(d))}catch(h){o(h)}}function c(d){try{u(r.throw(d))}catch(h){o(h)}}function u(d){d.done?i(d.value):s(d.value).then(l,c)}u((r=r.apply(n,e||[])).next())})};class qa{constructor(e,t,r){var s,i,o;this.supabaseUrl=e,this.supabaseKey=t;const l=Ji(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:Fi,realtime:Bi,auth:Object.assign(Object.assign({},Mi),{storageKey:c}),global:Ui},d=Hi(r??{},u);this.storageKey=(s=d.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(i=d.global.headers)!==null&&i!==void 0?i:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(h,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=d.auth)!==null&&o!==void 0?o:{},this.headers,d.global.fetch),this.fetch=Vi(t,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new ii(new URL("rest/v1",l).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new Ci(this.storageUrl.href,this.headers,this.fetch,r==null?void 0:r.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new Dn(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},r={}){return this.rest.rpc(e,t,r)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return Wa(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:r}=yield this.auth.getSession();return(t=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:i,storageKey:o,flowType:l,lock:c,debug:u},d,h){const g={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new za({url:this.authUrl.href,headers:Object.assign(Object.assign({},g),d),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:r,storage:s,userStorage:i,flowType:l,lock:c,debug:u,fetch:h,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new _i(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,r)=>{this._handleTokenChanged(t,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(e,t,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Va=(n,e,t)=>new qa(n,e,t);function Ka(){if(typeof window<"u"||typeof process>"u")return!1;const n=process.version;if(n==null)return!1;const e=n.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}Ka()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Ga="https://cxagskqlaibqteesaopc.supabase.co",Ha="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4YWdza3FsYWlicXRlZXNhb3BjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3OTYzMzgsImV4cCI6MjA2NzM3MjMzOH0.p6nsXwx60OnxXIKDoxuTeXFHOR37E00G6YcWIJTvDhk",B=Va(Ga,Ha,{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0}}),ft={VITE_SUPABASE_URL:"https://cxagskqlaibqteesaopc.supabase.co",VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN4YWdza3FsYWlicXRlZXNhb3BjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3OTYzMzgsImV4cCI6MjA2NzM3MjMzOH0.p6nsXwx60OnxXIKDoxuTeXFHOR37E00G6YcWIJTvDhk"},kr={VITE_BASE_URL:"http://localhost:5173",VITE_ENVIRONMENT:"development"};for(const[n,e]of Object.entries(ft))if(!e)throw new Error(`Missing required environment variable: ${n}`);const Jt={development:{baseUrl:"http://localhost:5173",redirectPath:"/dashboard"},staging:{baseUrl:"https://staging-oentex.vercel.app",redirectPath:"/dashboard"},production:{baseUrl:"https://oentex.com",redirectPath:"/dashboard"}},Tr=()=>kr.VITE_ENVIRONMENT,Ja=()=>{const n=Tr(),e=Jt[n];return e||(console.warn(`Unknown environment: ${n}, falling back to development`),Jt.development)},Ya=()=>kr.VITE_BASE_URL,Xa=Tr(),Qa=Ja(),P={baseUrl:Ya(),supabase:{url:ft.VITE_SUPABASE_URL,anonKey:ft.VITE_SUPABASE_ANON_KEY},auth:{redirectPath:Qa.redirectPath,maxRetries:3,retryDelay:1e3},environment:Xa};console.log("🔧 OAuth Config Debug:",{environment:P.environment,baseUrl:P.baseUrl,redirectUrl:`${P.baseUrl}/auth/callback`,redirectPath:P.auth.redirectPath,hostname:typeof window<"u"?window.location.hostname:"server",origin:typeof window<"u"?window.location.origin:"server",hasBaseUrlEnv:!0,hasEnvironmentEnv:!0});if(typeof window<"u"){const n=`${P.baseUrl}/auth/callback`;console.log("🔧 Expected OAuth redirect URL:",n),console.log("🔧 Make sure BOTH of these URLs are in Supabase Additional Redirect URLs:"),console.log("   - https://oentex.com/auth/callback"),console.log("   - https://www.oentex.com/auth/callback"),window.location.hostname==="www.oentex.com"&&console.warn("🔧 ⚠️  You are on www.oentex.com - make sure this URL is in Supabase!")}var R=(n=>(n.INVALID_EMAIL="INVALID_EMAIL",n.WEAK_PASSWORD="WEAK_PASSWORD",n.USER_ALREADY_EXISTS="USER_ALREADY_EXISTS",n.INVALID_CREDENTIALS="INVALID_CREDENTIALS",n.EMAIL_NOT_CONFIRMED="EMAIL_NOT_CONFIRMED",n.RATE_LIMIT_EXCEEDED="RATE_LIMIT_EXCEEDED",n.SESSION_EXPIRED="SESSION_EXPIRED",n.PROVIDER_DISABLED="PROVIDER_DISABLED",n.NETWORK_ERROR="NETWORK_ERROR",n.UNKNOWN_ERROR="UNKNOWN_ERROR",n))(R||{});class Za{constructor(){ue(this,"MAX_RETRIES",3);ue(this,"RETRY_DELAY",1e3);ue(this,"profileCreationCache",new Map)}async signInWithGoogle(){try{const e=`${P.baseUrl}/auth/callback`;console.log("🔧 Google OAuth Configuration (Official Supabase):",{environment:P.environment,baseUrl:P.baseUrl,redirectUrl:e,supabaseProjectUrl:P.supabase.url,currentOrigin:typeof window<"u"?window.location.origin:"server"});const{error:t}=await B.auth.signInWithOAuth({provider:"google",options:{redirectTo:e,queryParams:{access_type:"offline",prompt:"consent"}}});return t?(console.error("🔧 Google OAuth error:",t),{error:this.handleAuthError(t),redirectUrl:e}):(console.log("🔧 Google OAuth Flow Started:"),console.log("  1. User → Google Auth ✅"),console.log("  2. Google → Supabase:",`${P.supabase.url}/auth/v1/callback`),console.log("  3. Supabase → Your App:",e),console.log("  ⚠️  Make sure step 3 URL is in Supabase Additional Redirect URLs!"),{error:null,redirectUrl:e})}catch(e){return console.error("🔧 Google OAuth exception:",e),{error:this.handleAuthError(e)}}}async signInWithMicrosoft(){try{const e=`${P.baseUrl}/auth/callback`;console.log("🔧 Microsoft OAuth Configuration (WITH EMAIL SCOPE):",{environment:P.environment,baseUrl:P.baseUrl,redirectUrl:e,supabaseProjectUrl:P.supabase.url});const{error:t}=await B.auth.signInWithOAuth({provider:"azure",options:{redirectTo:e,queryParams:{prompt:"select_account",scope:"openid email profile User.Read"}}});return t?(console.error("🔧 Microsoft OAuth error:",t),{error:this.handleAuthError(t),redirectUrl:e}):(console.log("🔧 Microsoft OAuth initiated successfully"),{error:null,redirectUrl:e})}catch(e){return console.error("🔧 Microsoft OAuth exception:",e),{error:this.handleAuthError(e)}}}async signOut(){try{this.profileCreationCache.clear();const{error:e}=await B.auth.signOut();return e?{error:this.handleAuthError(e)}:{error:null}}catch(e){return{error:this.handleAuthError(e)}}}async getSession(){try{const{data:e,error:t}=await B.auth.getSession();return t?(console.error("Session error:",t),{session:null,error:t}):{session:e.session,error:null}}catch(e){return console.error("Session exception:",e),{session:null,error:e}}}async updatePassword(e){try{const{data:t,error:r}=await B.auth.updateUser({password:e});return r?{error:r}:{error:null,data:t}}catch(t){return{error:t}}}async exchangeCodeForSession(e){var t,r,s;try{const{data:i,error:o}=await B.auth.exchangeCodeForSession(e);return o?(console.error("Code exchange error:",o),{data:null,error:o}):(console.log("🔧 Code exchange successful:",{userId:(t=i.user)==null?void 0:t.id,email:(r=i.user)==null?void 0:r.email,expiresAt:(s=i.session)==null?void 0:s.expires_at}),{data:i,error:null})}catch(i){return console.error("Code exchange exception:",i),{data:null,error:i}}}async validateOAuthConfig(){const e=[],t=[];try{const r=`${P.baseUrl}/auth/callback`;if(typeof window<"u"){const o=window.location.origin,l=P.baseUrl;o!==l&&(e.push(`Origin mismatch: current=${o}, config=${l}`),t.push("Check environment detection in config"))}const{data:s,error:i}=await B.auth.getSession();return i&&(e.push(`Supabase auth connection issue: ${i.message}`),t.push("Check Supabase URL and anon key")),console.log("🔧 OAuth Validation:",{environment:P.environment,baseUrl:P.baseUrl,redirectUrl:r,supabaseUrl:P.supabase.url,hasSession:!!(s!=null&&s.session)}),{isValid:e.length===0,issues:e,recommendations:[...t,`Add "${r}" to Supabase Additional Redirect URLs`,"Use wildcard patterns: https://oentex.com/** and https://www.oentex.com/**","Verify Google OAuth redirect points to Supabase: "+P.supabase.url+"/auth/v1/callback","Check console logs for detailed OAuth flow"]}}catch(r){return{isValid:!1,issues:[`Validation failed: ${r}`],recommendations:["Check console for errors"]}}}async createUserProfile(e){if(this.profileCreationCache.has(e.id))return this.profileCreationCache.get(e.id);const t=this.performProfileCreation(e);this.profileCreationCache.set(e.id,t);try{const r=await t;return setTimeout(()=>{this.profileCreationCache.delete(e.id)},5*60*1e3),r}catch(r){throw this.profileCreationCache.delete(e.id),r}}async performProfileCreation(e,t=0){var r,s;try{const{data:i,error:o}=await B.from("user_profiles").select("id").eq("id",e.id).maybeSingle();if(o)return t<this.MAX_RETRIES?(await this.delay(this.RETRY_DELAY*(t+1)),this.performProfileCreation(e,t+1)):{success:!1,error:"Failed to check existing profile"};if(i)return{success:!0};const l={id:e.id,email:e.email||"",full_name:this.extractFullName(e),avatar_url:((r=e.user_metadata)==null?void 0:r.avatar_url)||null,provider:((s=e.app_metadata)==null?void 0:s.provider)||"unknown",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},{error:c}=await B.from("user_profiles").insert([l]);return c?c.code==="23505"?{success:!0}:t<this.MAX_RETRIES?(await this.delay(this.RETRY_DELAY*(t+1)),this.performProfileCreation(e,t+1)):{success:!1,error:"Failed to create user profile"}:{success:!0}}catch{return t<this.MAX_RETRIES?(await this.delay(this.RETRY_DELAY*(t+1)),this.performProfileCreation(e,t+1)):{success:!1,error:"Unexpected error creating user profile"}}}extractFullName(e){var t,r,s;return((t=e.user_metadata)==null?void 0:t.full_name)||((r=e.user_metadata)==null?void 0:r.name)||((s=e.email)==null?void 0:s.split("@")[0])||"User"}async signUpWithEmail(e,t,r){var s,i;try{if(console.log("🔧 Starting email signup:",{email:e,hasPassword:!!t,passwordLength:t==null?void 0:t.length,metadata:r}),!e||!t)return{error:this.createError(R.INVALID_CREDENTIALS,"Email and password are required")};if(t.length<12)return{error:this.createError(R.INVALID_CREDENTIALS,"Password must be at least 12 characters long")};if(!B)return console.error("🔧 Supabase client not initialized"),{error:this.createError(R.UNKNOWN_ERROR,"Authentication service not available. Please try again later.")};const{data:o,error:l}=await B.auth.signUp({email:e,password:t,options:{data:r||{}}});if(console.log("🔧 Supabase signup response:",{data:o,error:l}),l){console.error("🔧 Email signup error:",{code:l.code,message:l.message,status:l.status,fullError:l});const c=this.handleAuthError(l);return console.log("🔧 Custom error created:",c),{error:c}}return console.log("🔧 Email signup success:",{email:e,userId:(s=o.user)==null?void 0:s.id,userConfirmed:(i=o.user)==null?void 0:i.email_confirmed_at,session:!!o.session}),{error:null}}catch(o){return console.error("🔧 Email signup exception:",o),{error:this.handleAuthError(o)}}}handleAuthError(e){if(e&&typeof e=="object"&&"code"in e){const t=e;switch(t.code){case"email_address_invalid":return this.createError(R.INVALID_EMAIL,"Please enter a valid email address");case"invalid_credentials":return this.createError(R.INVALID_CREDENTIALS,"Invalid credentials. Please try again");case"email_not_confirmed":return this.createError(R.EMAIL_NOT_CONFIRMED,"Please check your email and click the confirmation link");case"too_many_requests":return this.createError(R.RATE_LIMIT_EXCEEDED,"Too many attempts. Please wait a moment and try again");case"user_already_exists":return this.createError(R.USER_ALREADY_EXISTS,"An account with this email already exists");case"session_not_found":return this.createError(R.SESSION_EXPIRED,"Your session has expired. Please sign in again");case"provider_disabled":return this.createError(R.PROVIDER_DISABLED,"This sign-in method is not available");case"user_not_found":return this.createError(R.INVALID_CREDENTIALS,"User not found. Please try again");case"signup_disabled":return this.createError(R.PROVIDER_DISABLED,"Account creation is temporarily disabled");case"email_address_not_authorized":return this.createError(R.INVALID_CREDENTIALS,"This email address is not authorized");case"weak_password":return this.createError(R.INVALID_CREDENTIALS,"Password must be at least 12 characters long");case"password_too_short":return this.createError(R.INVALID_CREDENTIALS,"Password must be at least 12 characters long");case"invalid_email":return this.createError(R.INVALID_EMAIL,"Please enter a valid email address");case"signup_not_allowed":return this.createError(R.PROVIDER_DISABLED,"Email signup is not enabled. Please contact support");case"email_rate_limit_exceeded":return this.createError(R.RATE_LIMIT_EXCEEDED,"Too many signup attempts. Please wait before trying again");case"email_provider_disabled":return this.createError(R.PROVIDER_DISABLED,"Email signups are currently disabled. Please contact support or use social login.");default:return console.warn("🔧 Unhandled auth error code:",t.code,t.message),this.createError(R.UNKNOWN_ERROR,t.message||"An unexpected error occurred. Please try again")}}if(e instanceof Error){const t=e.message.toLowerCase();return t.includes("user already registered")?this.createError(R.USER_ALREADY_EXISTS,"An account with this provider already exists. Please sign in instead"):t.includes("invalid login credentials")?this.createError(R.INVALID_CREDENTIALS,"Invalid credentials. Please try again"):t.includes("too many requests")?this.createError(R.RATE_LIMIT_EXCEEDED,"Too many attempts. Please wait a moment and try again"):t.includes("session")||t.includes("jwt")?this.createError(R.SESSION_EXPIRED,"Your session has expired. Please sign in again"):t.includes("network")||t.includes("fetch")?this.createError(R.NETWORK_ERROR,"Network error. Please check your connection and try again"):this.createError(R.UNKNOWN_ERROR,e.message)}return this.createError(R.UNKNOWN_ERROR,"An unexpected error occurred. Please try again")}createError(e,t){return{type:e,message:t,timestamp:new Date().toISOString(),details:null}}delay(e){return new Promise(t=>setTimeout(t,e))}}const te=new Za;class eo{info(){}warn(){}error(e,...t){console.error(e,...t)}debug(){}}const W=new eo,Nr={user:null,session:null,loading:!0,error:null,initialized:!1},to=(n,e)=>{switch(e.type){case"SET_LOADING":return{...n,loading:e.payload};case"SET_USER":return{...n,user:e.payload};case"SET_SESSION":return{...n,session:e.payload};case"SET_ERROR":return{...n,error:e.payload};case"SET_INITIALIZED":return{...n,initialized:e.payload};case"RESET_STATE":return{...Nr,loading:!1,initialized:!0};case"FORCE_READY":return{...n,loading:!1,initialized:!0,error:null};default:return n}},Rr=m.createContext(void 0),xe=()=>{const n=m.useContext(Rr);if(n===void 0)throw new Error("useAuth must be used within an AuthProvider");return n},ro=({children:n})=>{var jt;const[e,t]=m.useReducer(to,Nr),r=m.useRef(null),s=m.useRef(),i=m.useRef(!0),o=m.useRef(0),l=m.useRef(),c=3,u=1e4,d=15e3,h=m.useMemo(()=>e.initialized&&!e.loading,[e.initialized,e.loading]),g=m.useCallback(_=>{const I=te.handleAuthError(_);return i.current&&t({type:"SET_ERROR",payload:I}),I},[]),f=m.useCallback(()=>{i.current&&t({type:"SET_ERROR",payload:null})},[]),v=m.useCallback(()=>{W.warn("Forcing auth ready state to prevent infinite loop"),i.current&&t({type:"FORCE_READY"})},[]),y=m.useCallback(async _=>{if(!_)return!0;try{const I=Date.now(),F=(_.expires_at||0)*1e3;if(I>=F-6e4){W.info("Session expiring soon, attempting refresh...");const O=B.auth.refreshSession(),Z=new Promise((Do,$r)=>{setTimeout(()=>$r(new Error("Session refresh timeout")),5e3)}),{data:{session:ie},error:Et}=await Promise.race([O,Z]);if(Et)return W.error("Session refresh failed:",Et),!1;ie&&i.current&&(t({type:"SET_SESSION",payload:ie}),t({type:"SET_USER",payload:ie.user}))}return!0}catch(I){return W.error("Session validation failed:",I),!1}},[]),p=m.useCallback(async()=>{if(r.current)return r.current;if(o.current>=c){W.error("Max auth initialization attempts reached, forcing ready state"),v();return}return r.current=(async()=>{try{if(!i.current)return;o.current++,W.info(`Initializing auth state (attempt ${o.current}/${c})...`),t({type:"SET_LOADING",payload:!0}),t({type:"SET_ERROR",payload:null});const _=new Promise((Z,ie)=>{setTimeout(()=>ie(new Error("Auth initialization timeout")),u)}),I=B.auth.getSession(),{data:{session:F},error:O}=await Promise.race([I,_]);if(!i.current)return;O?(W.error("Failed to get session:",O),g(O)):await y(F)?(t({type:"SET_SESSION",payload:F}),t({type:"SET_USER",payload:(F==null?void 0:F.user)??null}),F!=null&&F.user&&te.createUserProfile(F.user).catch(ie=>{W.error("Failed to create user profile:",ie)})):(t({type:"SET_SESSION",payload:null}),t({type:"SET_USER",payload:null})),o.current=0}catch(_){W.error("Auth initialization failed:",_),i.current&&(g(_),t({type:"SET_SESSION",payload:null}),t({type:"SET_USER",payload:null}))}finally{i.current&&(t({type:"SET_LOADING",payload:!1}),t({type:"SET_INITIALIZED",payload:!0})),r.current=null}})(),r.current},[g,y,v]),b=m.useCallback(async()=>{W.info("Retrying auth initialization..."),f(),o.current=0,r.current=null,t({type:"SET_INITIALIZED",payload:!1}),t({type:"SET_LOADING",payload:!0}),await p()},[f,p]),x=m.useCallback(async()=>{try{const{data:{session:_},error:I}=await B.auth.refreshSession();I?g(I):i.current&&(t({type:"SET_SESSION",payload:_}),t({type:"SET_USER",payload:(_==null?void 0:_.user)??null}))}catch(_){g(_)}},[g]),w=m.useCallback(async _=>{try{const I=await te.updatePassword(_);return I.error?{error:g(I.error)}:(await x(),{error:null})}catch(I){return{error:g(I)}}},[g,x]);m.useEffect(()=>{i.current=!0,l.current=setTimeout(v,d),(async()=>{i.current&&await p()})();const{data:{subscription:I}}=B.auth.onAuthStateChange(async(F,O)=>{i.current&&(W.info("Auth event:",F),l.current&&clearTimeout(l.current),t({type:"SET_ERROR",payload:null}),t({type:"SET_SESSION",payload:O}),t({type:"SET_USER",payload:(O==null?void 0:O.user)??null}),F==="SIGNED_IN"&&(O!=null&&O.user)&&te.createUserProfile(O.user).catch(Z=>{W.error("Failed to create user profile on sign in:",Z)}),t({type:"SET_LOADING",payload:!1}),t({type:"SET_INITIALIZED",payload:!0}))});return()=>{i.current=!1,I.unsubscribe(),s.current&&clearTimeout(s.current),l.current&&clearTimeout(l.current),r.current=null}},[p,v]),m.useEffect(()=>{var Z;if(!((Z=e.session)!=null&&Z.expires_at))return;const _=new Date(e.session.expires_at*1e3),I=new Date,F=_.getTime()-I.getTime(),O=Math.max(F-5*60*1e3,0);return O>0&&O<24*60*60*1e3&&(s.current=setTimeout(x,O)),()=>{s.current&&clearTimeout(s.current)}},[(jt=e.session)==null?void 0:jt.expires_at,x]);const E=m.useCallback(async()=>{t({type:"SET_LOADING",payload:!0}),f();try{console.log("🔍 AuthContext: Starting Google OAuth...");const _=await te.signInWithGoogle();return _.error?console.error("🔍 AuthContext: Google OAuth error:",_.error):console.log("🔍 AuthContext: Google OAuth initiated successfully"),_}catch(_){return console.error("🔍 AuthContext: Google OAuth exception:",_),{error:g(_)}}finally{t({type:"SET_LOADING",payload:!1})}},[f,g]),S=m.useCallback(async()=>{t({type:"SET_LOADING",payload:!0}),f();try{console.log("🔍 AuthContext: Starting Microsoft OAuth...");const _=await te.signInWithMicrosoft();return _.error?console.error("🔍 AuthContext: Microsoft OAuth error:",_.error):console.log("🔍 AuthContext: Microsoft OAuth initiated successfully"),_}catch(_){return console.error("🔍 AuthContext: Microsoft OAuth exception:",_),{error:g(_)}}finally{t({type:"SET_LOADING",payload:!1})}},[f,g]),T=m.useCallback(async(_,I,F)=>{t({type:"SET_LOADING",payload:!0}),f();try{console.log("🔍 AuthContext: Starting email signup...");const O=await te.signUpWithEmail(_,I,F);return O.error?console.error("🔍 AuthContext: Email signup error:",O.error):console.log("🔍 AuthContext: Email signup initiated successfully"),O}catch(O){return console.error("🔍 AuthContext: Email signup exception:",O),{error:g(O)}}finally{t({type:"SET_LOADING",payload:!1})}},[f,g]),U=m.useCallback(async()=>{t({type:"SET_LOADING",payload:!0}),f();try{console.log("🔍 AuthContext: Signing out..."),sessionStorage.clear();const _=await te.signOut();return _.error?console.error("🔍 AuthContext: Sign out error:",_.error):(t({type:"RESET_STATE"}),console.log("🔍 AuthContext: Sign out successful")),_}catch(_){return console.error("🔍 AuthContext: Sign out exception:",_),{error:g(_)}}finally{t({type:"SET_LOADING",payload:!1})}},[f,g]),Q=m.useMemo(()=>({...e,isFullyReady:h,signInWithGoogle:E,signInWithMicrosoft:S,signUpWithEmail:T,signOut:U,clearError:f,retryAuth:b,refreshSession:x,updatePassword:w}),[e,h,E,S,T,U,f,b,x,w]);return a.jsx(Rr.Provider,{value:Q,children:n})},so=()=>{const{pathname:n}=er();return m.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"smooth"})},[n]),null},Xo=({size:n="md",variant:e="default",className:t="",text:r,showIcon:s=!0})=>{const i={sm:"w-4 h-4 text-sm",md:"w-6 h-6 text-base",lg:"w-8 h-8 text-lg",xl:"w-12 h-12 text-2xl"},o={sm:"text-xs",md:"text-sm",lg:"text-base",xl:"text-lg"},l=()=>{switch(e){case"primary":return"text-blue-600";case"secondary":return"text-emerald-600";case"auth":return"text-blue-600";case"deals":return"text-green-600";default:return"text-gray-600"}},c=()=>{const u=`${i[n]} flex items-center justify-center`;switch(e){case"auth":return a.jsx("div",{className:`${u} animate-pulse`,children:"🔐"});case"deals":return a.jsx("div",{className:`${u} animate-pulse`,children:"💰"});case"primary":return a.jsx("div",{className:`${u} animate-pulse`,children:"⚡"});default:return a.jsx("div",{className:`${i[n]} animate-spin rounded-full border-2 border-current border-t-transparent`})}};return a.jsx("div",{className:`flex items-center justify-center ${t}`,children:a.jsxs("div",{className:`flex items-center gap-2 ${l()}`,children:[s&&c(),r&&a.jsx("span",{className:`${o[n]} font-medium`,children:r})]})})},Ke=({message:n="Loading...",variant:e="default"})=>a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})}),Qo=()=>a.jsx("div",{className:"min-h-screen bg-background",children:a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:[a.jsx("div",{className:"text-center mb-12",children:a.jsxs("div",{className:"animate-pulse",children:[a.jsx("div",{className:"h-12 bg-content2/50 rounded-2xl w-96 mx-auto mb-6"}),a.jsx("div",{className:"h-6 bg-content2/30 rounded-xl w-128 mx-auto mb-3"}),a.jsx("div",{className:"h-4 bg-content2/20 rounded-lg w-64 mx-auto"})]})}),a.jsx("div",{className:"bg-content1/90 backdrop-blur-xl rounded-2xl border border-divider/40 mb-8 shadow-2xl",children:a.jsxs("div",{className:"p-8",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[a.jsx("div",{className:"relative",children:a.jsx("div",{className:"h-12 bg-content2/50 rounded-xl w-full"})}),a.jsx("div",{className:"h-12 bg-content2/50 rounded-xl w-full"}),a.jsx("div",{className:"h-12 bg-content2/50 rounded-xl w-full"})]}),a.jsx("div",{className:"flex flex-wrap gap-4 py-4",children:[1,2,3,4,5,6,7].map(n=>a.jsx("div",{className:"animate-pulse",children:a.jsx("div",{className:"h-12 bg-content2/50 rounded-lg w-32"})},n))})]})}),a.jsxs("div",{className:"flex items-center justify-between mb-8",children:[a.jsx("div",{className:"animate-pulse",children:a.jsx("div",{className:"h-5 bg-content2/50 rounded-lg w-40"})}),a.jsx("div",{className:"animate-pulse",children:a.jsx("div",{className:"h-5 bg-content2/50 rounded-lg w-32"})})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12",children:[1,2,3,4,5,6].map(n=>a.jsx("div",{className:"bg-content1/80 backdrop-blur-xl rounded-2xl border border-divider/40 p-6 shadow-lg",children:a.jsxs("div",{className:"animate-pulse",children:[a.jsxs("div",{className:"flex items-start justify-between mb-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"w-16 h-16 bg-content2/50 rounded-xl"}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"h-4 bg-content2/50 rounded w-24"}),a.jsx("div",{className:"h-3 bg-content2/30 rounded w-16"})]})]}),a.jsx("div",{className:"w-20 h-6 bg-content2/50 rounded-full"})]}),a.jsx("div",{className:"my-4 p-3 bg-content2/50 rounded-xl",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("div",{className:"h-4 bg-content2/30 rounded w-24"}),a.jsx("div",{className:"h-3 bg-content2/30 rounded w-12"})]})}),a.jsxs("div",{className:"my-4",children:[a.jsx("div",{className:"h-5 bg-content2/50 rounded w-3/4 mb-2"}),a.jsx("div",{className:"h-4 bg-content2/30 rounded w-1/2"})]}),a.jsxs("div",{className:"my-4 space-y-2",children:[a.jsx("div",{className:"h-3 bg-content2/30 rounded w-full"}),a.jsx("div",{className:"h-3 bg-content2/30 rounded w-5/6"}),a.jsx("div",{className:"h-3 bg-content2/30 rounded w-4/6"})]}),a.jsx("div",{className:"my-4",children:a.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.jsx("div",{className:"h-6 bg-content2/30 rounded-full w-16"}),a.jsx("div",{className:"h-6 bg-content2/30 rounded-full w-20"}),a.jsx("div",{className:"h-6 bg-content2/30 rounded-full w-14"})]})}),a.jsxs("div",{className:"flex gap-3 mt-6",children:[a.jsx("div",{className:"h-10 bg-content2/50 rounded-lg flex-1"}),a.jsx("div",{className:"h-10 bg-content2/50 rounded-lg w-20"})]})]})},n))}),a.jsxs("div",{className:"flex items-center justify-center gap-4 mb-12",children:[a.jsx("div",{className:"animate-pulse",children:a.jsx("div",{className:"h-10 bg-content2/50 rounded-lg w-24"})}),a.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(n=>a.jsx("div",{className:"animate-pulse",children:a.jsx("div",{className:"h-10 bg-content2/50 rounded-lg w-10"})},n))}),a.jsx("div",{className:"animate-pulse",children:a.jsx("div",{className:"h-10 bg-content2/50 rounded-lg w-24"})})]})]})}),Yt=({stage:n="initializing"})=>a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsx("div",{className:"w-8 h-8 border-2 border-primary border-t-transparent rounded-full animate-spin"})}),Xt=({name:n,className:e="",size:t="md",color:r="default"})=>{const s=N[n];if(!s)return console.warn(`Icon "${n}" not found`),null;const i={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"},o={default:"text-gray-600 dark:text-gray-400",primary:"text-blue-600 dark:text-blue-400",secondary:"text-emerald-600 dark:text-emerald-400",success:"text-green-600 dark:text-green-400",warning:"text-amber-600 dark:text-amber-400",danger:"text-red-600 dark:text-red-400"};return a.jsx(s,{className:`${i[t]} ${o[r]} ${e}`})},N={menu:mn,close:gs,chevronDown:Vr,chevronUp:qr,chevronLeft:hs,chevronRight:fs,arrowRight:rs,arrowLeft:es,arrowUp:gn,arrowDown:fn,externalLink:zr,download:ys,refresh:rr,user:Rt,userCircle:hn,userCheck:Rt,logout:un,login:dn,lock:Qr,key:os,eye:Zr,eyeOff:At,eyeSlash:At,mail:Wr,chat:St,chatBubble:St,phone:Hr,send:Nt,paperAirplane:Nt,chart:ss,dollar:ws,money:cn,card:ln,arrowTrendingUp:Ur,arrowTrendingDown:on,shield:Kr,shieldWarning:an,warning:tr,success:Br,error:nn,mobile:ds,desktop:ps,tablet:sn,wifi:vs,server:rn,chip:tn,document:Jr,file:en,image:Zs,video:Qs,volume:Xs,mute:Ys,search:Mr,filter:is,settings:bs,tools:Js,edit:as,delete:Ot,trash:Ot,add:ns,remove:Hs,info:Gs,alert:Ks,check:Xr,time:Gr,calendar:Yr,star:Dr,heart:Vs,gift:ts,users:Lr,team:qs,share:Ws,link:zs,globe:ms,home:Bs,location:Tt,mapPin:Tt,building:cs,store:Ms,sparkles:us,trophy:Fr,bolt:ls,fire:Fs,sun:Us,moon:Ds,cloud:Ls,cloudUpload:Cs,cloudDownload:Ps,database:kt,tag:$s,bookmark:Is,flag:Os,bell:As,bellOff:Rs,megaphone:Ns,mic:Ts,camera:ks,play:Ss,pause:Es,stop:js,forward:_s,backward:xs,cookie:kt},no=({isOpen:n,onClose:e,mode:t,onModeChange:r})=>{const[s,i]=m.useState({isLoading:!1,loadingProvider:null,success:!1,error:null}),{signInWithGoogle:o,signInWithMicrosoft:l}=xe(),c=m.useRef(null),u=m.useRef(null),d=m.useCallback(p=>{i(b=>({...b,...p}))},[]),h=m.useCallback(()=>{d({error:null})},[d]),g=m.useCallback(()=>{i({isLoading:!1,loadingProvider:null,success:!1,error:null})},[]);m.useEffect(()=>{n&&(g(),setTimeout(()=>{var p;(p=u.current)==null||p.focus()},100))},[n,g]),m.useEffect(()=>{const p=b=>{b.key==="Escape"&&n&&!s.isLoading&&e()};if(n)return document.addEventListener("keydown",p),()=>document.removeEventListener("keydown",p)},[n,e,s.isLoading]),m.useEffect(()=>{if(!n)return;const p=c.current;if(!p)return;const b=p.querySelectorAll('button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'),x=b[0],w=b[b.length-1],E=S=>{S.key==="Tab"&&(S.shiftKey?document.activeElement===x&&(S.preventDefault(),w==null||w.focus()):document.activeElement===w&&(S.preventDefault(),x==null||x.focus()))};return p.addEventListener("keydown",E),()=>p.removeEventListener("keydown",E)},[n,s.success,s.error]);const f=m.useCallback(async p=>{if(!s.isLoading){h(),d({isLoading:!0,loadingProvider:p});try{const b=p==="google"?await o():await l();b.error?d({isLoading:!1,loadingProvider:null,error:b.error.message||`Failed to sign in with ${p}. Please try again.`}):(d({isLoading:!1,loadingProvider:null,success:!0}),setTimeout(e,1500))}catch(b){const x=b instanceof Error?b.message:`Failed to sign in with ${p}. Please try again.`;d({isLoading:!1,loadingProvider:null,error:x})}}},[s.isLoading,h,d,o,l,e]),v=()=>a.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 21 21",fill:"none","aria-hidden":"true",children:[a.jsx("path",{d:"M10 1H1v9h9V1z",fill:"#f25022"}),a.jsx("path",{d:"M20 1h-9v9h9V1z",fill:"#7fba00"}),a.jsx("path",{d:"M10 11H1v9h9v-9z",fill:"#00a4ef"}),a.jsx("path",{d:"M20 11h-9v9h9v-9z",fill:"#ffb900"})]}),y=({provider:p,icon:b,label:x,variant:w,color:E})=>{const S=s.loadingProvider===p,T=s.isLoading;return a.jsx(ke,{onPress:()=>f(p),isDisabled:T,variant:w,color:E,size:"lg",className:"w-full font-medium",startContent:S?a.jsx(tt,{size:"sm"}):b,isLoading:S,classNames:{base:"h-12",startContent:"flex items-center justify-center w-5 h-5"},children:S?"Connecting...":x})};return a.jsx(En,{isOpen:n,onClose:e,size:"md",isDismissable:!s.isLoading,hideCloseButton:s.isLoading,classNames:{base:"bg-background text-foreground shadow-2xl border border-divider",header:"border-b border-divider px-6 py-4 bg-gradient-to-r from-background to-default-50",body:"px-6 py-6 bg-background",footer:"border-t border-divider px-6 py-4 bg-gradient-to-r from-default-50 to-background"},children:a.jsx(Sn,{children:()=>a.jsxs(a.Fragment,{children:[a.jsxs(kn,{className:"flex flex-col gap-1",children:[a.jsx("h2",{className:"text-xl font-bold text-foreground",children:t==="login"?"Welcome Back":"Join Oentex"}),a.jsx("p",{className:"text-sm text-foreground-500",children:t==="login"?"Sign in to access your trading dashboard":"Start discovering the best trading platforms"})]}),a.jsx(Tn,{children:s.success?a.jsxs("div",{className:"text-center py-16 px-8 bg-gradient-to-br from-success-50 to-success-100 rounded-2xl border border-success-200",role:"alert","aria-live":"polite",children:[a.jsx("div",{className:"w-24 h-24 bg-success-200 rounded-full flex items-center justify-center mx-auto mb-10 shadow-lg",children:a.jsx(N.success,{className:"w-12 h-12 text-success"})}),a.jsx("h3",{className:"text-3xl font-bold text-foreground mb-6",children:"Success!"}),a.jsx("p",{className:"text-foreground-600 text-xl mb-8",children:"Redirecting you to your dashboard..."}),a.jsx("div",{className:"mt-10",children:a.jsx("div",{className:"w-48 h-2 bg-success-200 rounded-full mx-auto overflow-hidden shadow-inner",children:a.jsx("div",{className:"w-full h-full bg-success animate-pulse rounded-full"})})})]}):a.jsxs("div",{className:"space-y-10 py-4",children:[s.error&&a.jsx("div",{className:"bg-gradient-to-r from-danger-50 to-danger-100 border-2 border-danger-200 rounded-2xl p-8 shadow-lg",role:"alert","aria-live":"assertive",children:a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsx("div",{className:"w-10 h-10 bg-danger-200 rounded-full flex items-center justify-center",children:a.jsx(N.warning,{className:"w-6 h-6 text-danger flex-shrink-0"})}),a.jsx("p",{className:"text-danger text-base font-medium",children:s.error})]})}),a.jsxs("div",{className:"space-y-4 py-2",children:[a.jsx(y,{provider:"google",icon:a.jsx(N.globe,{className:"w-5 h-5 flex-shrink-0"}),label:"Continue with Google",variant:"bordered",color:"default"}),a.jsx(y,{provider:"microsoft",icon:a.jsx("div",{className:"w-5 h-5 flex-shrink-0",children:a.jsx(v,{})}),label:"Continue with Microsoft",variant:"solid",color:"primary"})]})]})}),!s.success&&a.jsxs(Nn,{className:"flex flex-col gap-10 py-4",children:[a.jsx("div",{className:"text-center text-base text-foreground-500 border-t-2 border-divider pt-10 w-full bg-gradient-to-r from-default-50 to-transparent rounded-t-2xl -mx-8 px-8",children:t==="login"?a.jsxs(a.Fragment,{children:["New to trading affiliate deals?"," ",a.jsx(ke,{variant:"light",color:"primary",size:"sm",onPress:()=>r("register"),isDisabled:s.isLoading,className:"text-primary font-medium p-0 h-auto min-w-0",children:"Create account"})]}):a.jsxs(a.Fragment,{children:["Already have an account?"," ",a.jsx(ke,{variant:"light",color:"primary",size:"sm",onPress:()=>r("login"),isDisabled:s.isLoading,className:"text-primary font-medium p-0 h-auto min-w-0",children:"Sign in"})]})}),a.jsx("div",{className:"text-center w-full space-y-4 bg-gradient-to-r from-default-100 to-default-50 rounded-2xl p-6 border border-default-200",children:a.jsxs("p",{className:"text-sm text-foreground-400",children:["By continuing, you agree to our"," ",a.jsx("a",{href:"/terms",className:"underline hover:text-foreground-600 focus:outline-none focus:text-foreground-600 font-medium",children:"Terms"})," ","and"," ",a.jsx("a",{href:"/privacy",className:"underline hover:text-foreground-600 focus:outline-none focus:text-foreground-600 font-medium",children:"Privacy Policy"})]})})]})]})})})},Ar=({message:n,type:e="success",duration:t=4e3,icon:r,title:s,details:i,action:o})=>{const l=()=>{if(r)return r;switch(e){case"success":return a.jsx(N.success,{className:"w-5 h-5"});case"error":return a.jsx(N.error,{className:"w-5 h-5"});case"warning":return a.jsx(N.warning,{className:"w-5 h-5"});case"info":return a.jsx(N.info,{className:"w-5 h-5"});default:return a.jsx(N.success,{className:"w-5 h-5"})}},c=a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0 mt-0.5",children:l()}),a.jsxs("div",{className:"flex-1 min-w-0",children:[s&&a.jsx("div",{className:"font-semibold text-sm mb-1",children:s}),a.jsx("div",{className:`${s?"text-sm":"text-sm font-medium"}`,children:n}),i&&a.jsx("div",{className:"text-xs opacity-75 mt-1 text-foreground/60",children:i}),o&&a.jsx("button",{onClick:o.onClick,className:"mt-2 text-xs font-medium underline hover:no-underline transition-all duration-200",children:o.label})]})]}),d=(()=>{const h={borderRadius:"0.75rem",padding:"1rem",fontWeight:"500",backdropFilter:"blur(16px)"};switch(e){case"success":return{duration:t,position:"top-right",style:{...h,background:"hsl(var(--heroui-success) / 0.1)",color:"hsl(var(--heroui-success))",border:"1px solid hsl(var(--heroui-success) / 0.2)",boxShadow:"0 10px 40px hsl(var(--heroui-success) / 0.15), 0 4px 16px hsl(var(--heroui-success) / 0.08)"},icon:null};case"error":return{duration:t||6e3,position:"top-right",style:{...h,background:"hsl(var(--heroui-danger) / 0.1)",color:"hsl(var(--heroui-danger))",border:"1px solid hsl(var(--heroui-danger) / 0.2)",boxShadow:"0 10px 40px hsl(var(--heroui-danger) / 0.15), 0 4px 16px hsl(var(--heroui-danger) / 0.08)",maxWidth:"400px",minWidth:"300px"},icon:null};case"warning":return{duration:t,position:"top-right",style:{...h,background:"hsl(var(--heroui-warning) / 0.1)",color:"hsl(var(--heroui-warning))",border:"1px solid hsl(var(--heroui-warning) / 0.2)",boxShadow:"0 10px 40px hsl(var(--heroui-warning) / 0.15), 0 4px 16px hsl(var(--heroui-warning) / 0.08)"},icon:null};case"info":return{duration:t,position:"top-right",style:{...h,background:"hsl(var(--heroui-primary) / 0.1)",color:"hsl(var(--heroui-primary))",border:"1px solid hsl(var(--heroui-primary) / 0.2)",boxShadow:"0 10px 40px hsl(var(--heroui-primary) / 0.15), 0 4px 16px hsl(var(--heroui-primary) / 0.08)"},icon:null};default:return{duration:t,position:"top-right",style:{...h,background:"hsl(var(--heroui-success) / 0.1)",color:"hsl(var(--heroui-success))",border:"1px solid hsl(var(--heroui-success) / 0.2)",boxShadow:"0 10px 40px hsl(var(--heroui-success) / 0.15), 0 4px 16px hsl(var(--heroui-success) / 0.08)"},icon:null}}})();switch(console.log("🔍 AppToast rendering:",{type:e,message:n,title:s,duration:t}),e){case"success":return _e.success(c,d);case"error":return console.log("🔍 Calling toast.error with:",{toastContent:c,toastOptions:d}),_e.error(c,d);case"warning":return _e(c,{...d,icon:"⚠️"});case"info":return _e(c,{...d,icon:"ℹ️"});default:return _e.success(c,d)}},Or=(n,e,t)=>Ar({message:n,type:"success",title:e,duration:t}),Qt=(n,e,t,r,s)=>(console.log("🔍 showErrorToast called with:",{message:n,title:e,duration:t,details:r,action:s}),Ar({message:n,type:"error",title:e,duration:t,details:r,action:s})),io=({error:n,onRetry:e,showReturnHome:t=!0})=>{const{retryAuth:r,clearError:s,user:i}=xe(),o=gt(),[l,c]=m.useState(!1),[u,d]=m.useState("login"),[h,g]=m.useState(!1),[f,v]=m.useState(0),y=3,p=m.useCallback(()=>{switch(n.type){case"SESSION_EXPIRED":return{title:"Session Expired",message:"Your session has expired. Please sign in again to continue.",icon:a.jsx(N.shield,{className:"w-12 h-12 text-amber-600"}),showAuthButton:!0,showRetryButton:!1,bgColor:"bg-amber-50",borderColor:"border-amber-200",textColor:"text-amber-800"};case"INVALID_CREDENTIALS":return{title:"Authentication Failed",message:"Invalid credentials provided. Please check your email and password.",icon:a.jsx(N.warning,{className:"w-12 h-12 text-red-600"}),showAuthButton:!0,showRetryButton:!1,bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800"};case"NETWORK_ERROR":return{title:"Connection Error",message:"Unable to connect to the server. Please check your internet connection.",icon:a.jsx(N.wifi,{className:"w-12 h-12 text-orange-600"}),showAuthButton:!1,showRetryButton:!0,bgColor:"bg-orange-50",borderColor:"border-orange-200",textColor:"text-orange-800"};default:return{title:"Authentication Error",message:n.message||"An unexpected error occurred. Please try again.",icon:a.jsx(N.warning,{className:"w-12 h-12 text-red-600"}),showAuthButton:!0,showRetryButton:!0,bgColor:"bg-red-50",borderColor:"border-red-200",textColor:"text-red-800"}}},[n]),b=m.useCallback(async()=>{if(f>=y){Qt("Maximum retry attempts reached. Please refresh the page.");return}g(!0),v(T=>T+1);try{s(),await r(),e&&await e(),Or("Authentication retry successful!")}catch(T){console.error("Auth retry failed:",T),Qt("Retry failed. Please try again.")}finally{g(!1)}},[f,s,r,e]),x=m.useCallback(()=>{d("login"),c(!0)},[]),w=m.useCallback(()=>{s(),o("/")},[s,o]),E=m.useCallback(()=>{window.location.reload()},[]),S=p();return a.jsxs("div",{className:"min-h-screen bg-background pt-20",children:[a.jsx("div",{className:"max-w-2xl mx-auto px-4 py-8",children:a.jsxs("div",{className:`${S.bgColor} border ${S.borderColor} rounded-xl p-8 text-center`,children:[a.jsx("div",{className:"flex justify-center mb-6",children:S.icon}),a.jsx("h2",{className:`text-2xl font-bold ${S.textColor} mb-4`,children:S.title}),a.jsx("p",{className:`${S.textColor} mb-6 leading-relaxed`,children:S.message}),n.details&&a.jsxs("details",{className:"mb-6 text-left",children:[a.jsx("summary",{className:`${S.textColor} cursor-pointer text-sm font-medium`,children:"Technical Details"}),a.jsx("pre",{className:`${S.textColor} text-xs mt-2 p-3 bg-white rounded border overflow-x-auto`,children:JSON.stringify(n.details,null,2)})]}),i&&a.jsxs("div",{className:`${S.textColor} text-sm mb-6 p-3 bg-white rounded border`,children:[a.jsxs("p",{children:["Currently signed in as: ",a.jsx("strong",{children:i.email})]}),a.jsxs("p",{children:["User ID: ",a.jsx("code",{className:"text-xs",children:i.id})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[S.showRetryButton&&a.jsxs("button",{onClick:b,disabled:h||f>=y,className:`flex items-center justify-center gap-2 px-6 py-3 rounded-lg font-medium transition-colors ${h||f>=y?"bg-gray-400 text-white cursor-not-allowed":"bg-primary text-white hover:bg-primary/90"}`,children:[a.jsx(N.refresh,{className:`w-4 h-4 ${h?"animate-spin":""}`}),h?"Retrying...":`Retry${f>0?` (${f}/${y})`:""}`]}),S.showAuthButton&&a.jsxs("button",{onClick:x,className:"flex items-center justify-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-blue-700 transition-colors",children:[a.jsx(N.login,{className:"w-4 h-4"}),"Sign In"]}),t&&a.jsxs("button",{onClick:w,className:"flex items-center justify-center gap-2 bg-gray-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors",children:[a.jsx(N.home,{className:"w-4 h-4"}),"Go Home"]}),a.jsxs("button",{onClick:E,className:"flex items-center justify-center gap-2 bg-gray-600 text-white px-6 py-3 rounded-lg font-medium hover:bg-gray-700 transition-colors",children:[a.jsx(N.refresh,{className:"w-4 h-4"}),"Refresh Page"]})]}),a.jsxs("div",{className:`${S.textColor} text-sm mt-6 p-3 bg-white rounded border`,children:[a.jsx("p",{className:"font-medium mb-2",children:"Need help?"}),a.jsxs("ul",{className:"text-left space-y-1",children:[a.jsx("li",{children:"• Check your internet connection"}),a.jsx("li",{children:"• Clear your browser cache and cookies"}),a.jsx("li",{children:"• Try signing out and signing in again"}),a.jsx("li",{children:"• Contact support if the problem persists"})]})]})]})}),l&&a.jsx(no,{isOpen:l,onClose:()=>c(!1),mode:u,onModeChange:d})]})};class xt extends m.Component{constructor(e){super(e),this.state={hasError:!1}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){console.error("Error caught by boundary:",e,t)}render(){return this.state.hasError?this.props.fallback||a.jsx("div",{className:"flex items-center justify-center p-4 bg-red-50 border border-red-200 rounded-lg",children:a.jsxs("div",{className:"text-center",children:[a.jsx(tr,{className:"w-8 h-8 text-red-500 mx-auto mb-2"}),a.jsx("p",{className:"text-red-700 mb-2",children:"Something went wrong"}),a.jsxs("button",{onClick:()=>this.setState({hasError:!1}),className:"flex items-center justify-center space-x-1 text-red-600 hover:text-red-800 text-sm transition-colors",children:[a.jsx(rr,{className:"w-4 h-4"}),a.jsx("span",{children:"Try again"})]})]})}):this.props.children}}class ao{constructor(){ue(this,"isInitialized",!1);ue(this,"consentPreferences",null);this.loadConsentFromStorage(),this.initializeAdSense()}loadConsentFromStorage(){try{const e=localStorage.getItem("oentex-consent");if(e){const t=JSON.parse(e);this.consentPreferences=t.preferences}}catch(e){console.warn("Failed to load consent preferences:",e)}}initializeAdSense(){typeof window>"u"||(window.adsbygoogle||(window.adsbygoogle=[]),this.isInitialized=!0)}updateConsent(e){this.consentPreferences=e,e.marketing&&!this.isInitialized?this.initializeAdSense():!e.marketing&&this.isInitialized&&this.disableAdSense()}disableAdSense(){document.querySelectorAll('script[src*="googlesyndication.com"]').forEach(r=>r.remove()),document.querySelectorAll(".adsbygoogle").forEach(r=>{r.innerHTML="",r.style.display="none"}),this.isInitialized=!1}pushAd(e){var t;if((t=this.consentPreferences)!=null&&t.marketing&&window.adsbygoogle)try{const r=e.querySelector(".adsbygoogle");r&&!r.hasAttribute("data-adsbygoogle-status")?(window.adsbygoogle.push({}),console.log("AdSense: Manager push successful")):console.log("AdSense: Manager - Ad already loaded")}catch(r){console.warn("AdSense error:",r)}}canShowAds(){var e;return((e=this.consentPreferences)==null?void 0:e.marketing)===!0}}const oo=new ao,lo=n=>{oo.updateConsent(n)},co=({onConsentChange:n})=>{const[e,t]=m.useState(!1),[r,s]=m.useState(!1),[i,o]=m.useState({necessary:!0,analytics:!1,marketing:!1,personalization:!1});m.useEffect(()=>{const f=localStorage.getItem("oentex-consent");if(!f)t(!0);else{const v=JSON.parse(f);o(v.preferences)}},[]);const l=()=>{d({necessary:!0,analytics:!0,marketing:!0,personalization:!0}),t(!1)},c=()=>{d({necessary:!0,analytics:!1,marketing:!1,personalization:!1}),t(!1)},u=()=>{s(!0)},d=f=>{const v={preferences:f,timestamp:new Date().toISOString(),version:"1.0"};localStorage.setItem("oentex-consent",JSON.stringify(v)),o(f),n==null||n(f),lo(f)},h=()=>{d(i),s(!1),t(!1)},g=(f,v)=>{f!=="necessary"&&o(y=>({...y,[f]:v}))};return!e&&!r?null:a.jsxs(a.Fragment,{children:[e&&a.jsx("div",{className:"fixed bottom-0 left-0 right-0 z-50 bg-content1 border-t border-divider/30 shadow-enhanced-lg backdrop-blur-strong",children:a.jsx("div",{className:"container-p-lg",children:a.jsxs("div",{className:"flex flex-col lg:flex-row items-start lg:items-center justify-between gap-lg",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"text-lg font-semibold text-foreground mb-sm",children:"We value your privacy"}),a.jsx("p",{className:"text-foreground/70 text-sm leading-relaxed",children:"We use cookies and similar technologies to enhance your experience, analyze site traffic, and personalize content. By continuing to use our site, you consent to our use of cookies. You can manage your preferences at any time."})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-sm",children:[a.jsx("button",{onClick:c,className:"btn-secondary px-lg py-sm text-sm font-medium",children:"Reject All"}),a.jsx("button",{onClick:u,className:"btn-outline px-lg py-sm text-sm font-medium",children:"Manage Options"}),a.jsx("button",{onClick:l,className:"btn-primary px-lg py-sm text-sm font-medium",children:"Accept All"})]})]})})}),r&&a.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-lg",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>s(!1)}),a.jsx("div",{className:"relative bg-content1 rounded-2xl border border-divider/30 shadow-enhanced-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:a.jsxs("div",{className:"container-p-2xl",children:[a.jsxs("div",{className:"flex items-center justify-between mb-xl",children:[a.jsx("h2",{className:"text-2xl font-bold text-foreground",children:"Cookie Preferences"}),a.jsx("button",{onClick:()=>s(!1),className:"text-foreground/60 hover:text-foreground transition-colors",children:a.jsx(N.close,{className:"w-6 h-6"})})]}),a.jsx("p",{className:"text-foreground/70 mb-2xl leading-relaxed",children:"We use cookies to provide and improve our services. You can choose which types of cookies to allow. Some cookies are necessary for the site to function and cannot be disabled."}),a.jsxs("div",{className:"space-y-xl",children:[a.jsxs("div",{className:"border border-divider/30 rounded-xl container-p-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-md",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Necessary Cookies"}),a.jsx("p",{className:"text-sm text-foreground/70",children:"Required for basic site functionality"})]}),a.jsx("div",{className:"bg-success/20 text-success px-sm py-xs rounded-full text-xs font-medium",children:"Always Active"})]}),a.jsx("p",{className:"text-sm text-foreground/60",children:"These cookies are essential for the website to function properly. They enable basic functions like page navigation, access to secure areas, and remember your login status."})]}),a.jsxs("div",{className:"border border-divider/30 rounded-xl container-p-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-md",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Analytics Cookies"}),a.jsx("p",{className:"text-sm text-foreground/70",children:"Help us understand how visitors interact with our site"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:i.analytics,onChange:f=>g("analytics",f.target.checked),className:"sr-only"}),a.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${i.analytics?"bg-primary":"bg-content2"}`,children:a.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-sm transform transition-transform ${i.analytics?"translate-x-5":"translate-x-0.5"} mt-0.5`})})]})]}),a.jsx("p",{className:"text-sm text-foreground/60",children:"These cookies collect information about how you use our website, such as which pages you visit most often. This helps us improve our website's performance and user experience."})]}),a.jsxs("div",{className:"border border-divider/30 rounded-xl container-p-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-md",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Marketing Cookies"}),a.jsx("p",{className:"text-sm text-foreground/70",children:"Used to deliver relevant advertisements"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:i.marketing,onChange:f=>g("marketing",f.target.checked),className:"sr-only"}),a.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${i.marketing?"bg-primary":"bg-content2"}`,children:a.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-sm transform transition-transform ${i.marketing?"translate-x-5":"translate-x-0.5"} mt-0.5`})})]})]}),a.jsx("p",{className:"text-sm text-foreground/60",children:"These cookies are used to deliver advertisements more relevant to you and your interests. They may also be used to limit the number of times you see an advertisement."})]}),a.jsxs("div",{className:"border border-divider/30 rounded-xl container-p-lg",children:[a.jsxs("div",{className:"flex items-center justify-between mb-md",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-foreground",children:"Personalization Cookies"}),a.jsx("p",{className:"text-sm text-foreground/70",children:"Remember your preferences and settings"})]}),a.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:i.personalization,onChange:f=>g("personalization",f.target.checked),className:"sr-only"}),a.jsx("div",{className:`w-11 h-6 rounded-full transition-colors ${i.personalization?"bg-primary":"bg-content2"}`,children:a.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow-sm transform transition-transform ${i.personalization?"translate-x-5":"translate-x-0.5"} mt-0.5`})})]})]}),a.jsx("p",{className:"text-sm text-foreground/60",children:"These cookies remember your preferences and settings to provide a more personalized experience, such as your preferred language or region."})]})]}),a.jsxs("div",{className:"flex flex-col sm:flex-row gap-sm mt-2xl pt-xl border-t border-divider/30",children:[a.jsx("button",{onClick:c,className:"btn-secondary px-xl py-md font-medium",children:"Reject All"}),a.jsx("button",{onClick:h,className:"btn-primary px-xl py-md font-medium",children:"Save Preferences"})]})]})})]})]})},Ir=({position:n="top-right",topAnchorSelector:e,topMargin:t=8})=>{const[r,s]=m.useState(void 0);m.useEffect(()=>{if(!e||typeof window>"u"){s(void 0);return}const o=()=>{const d=document.querySelector(e);if(!d){s(void 0);return}const h=d.getBoundingClientRect();s(`${Math.max(0,h.bottom+t)}px`)};o();const l=()=>o(),c=()=>o();window.addEventListener("resize",l),window.addEventListener("scroll",c,!0);const u=window.setTimeout(o,0);return()=>{window.removeEventListener("resize",l),window.removeEventListener("scroll",c,!0),window.clearTimeout(u)}},[e,t]);const i={zIndex:9999};return n.startsWith("top")&&(i.top=r||"5rem"),n.startsWith("bottom")&&(i.bottom="1rem"),n.endsWith("right")&&(i.right="1rem"),n.endsWith("left")&&(i.left="1rem"),n.endsWith("center"),a.jsx(pn,{position:n,toastOptions:{duration:4e3,style:{background:"hsl(var(--heroui-content1))",color:"hsl(var(--heroui-foreground))",border:"1px solid hsl(var(--heroui-divider))",borderRadius:"0.75rem",padding:"1rem",fontWeight:"500",boxShadow:"0 10px 40px hsl(var(--heroui-foreground) / 0.15), 0 4px 16px hsl(var(--heroui-foreground) / 0.1)",backdropFilter:"blur(16px)"},success:{duration:3e3,style:{background:"hsl(var(--heroui-success) / 0.1)",color:"hsl(var(--heroui-success))",border:"1px solid hsl(var(--heroui-success) / 0.2)",borderRadius:"0.75rem",padding:"1rem",fontWeight:"500",boxShadow:"0 10px 40px hsl(var(--heroui-success) / 0.15), 0 4px 16px hsl(var(--heroui-success) / 0.08)",backdropFilter:"blur(16px)"}},error:{duration:5e3,style:{background:"hsl(var(--heroui-danger) / 0.1)",color:"hsl(var(--heroui-danger))",border:"1px solid hsl(var(--heroui-danger) / 0.2)",borderRadius:"0.75rem",padding:"1rem",fontWeight:"500",boxShadow:"0 10px 40px hsl(var(--heroui-danger) / 0.15), 0 4px 16px hsl(var(--heroui-danger) / 0.08)",backdropFilter:"blur(16px)"}},loading:{style:{background:"hsl(var(--heroui-primary) / 0.1)",color:"hsl(var(--heroui-primary))",border:"1px solid hsl(var(--heroui-primary) / 0.2)",borderRadius:"0.75rem",padding:"1rem",fontWeight:"500",boxShadow:"0 10px 40px hsl(var(--heroui-primary) / 0.15), 0 4px 16px hsl(var(--heroui-primary) / 0.08)",backdropFilter:"blur(16px)"}},warning:{duration:4e3,style:{background:"hsl(var(--heroui-warning) / 0.1)",color:"hsl(var(--heroui-warning))",border:"1px solid hsl(var(--heroui-warning) / 0.2)",borderRadius:"0.75rem",padding:"1rem",fontWeight:"500",boxShadow:"0 10px 40px hsl(var(--heroui-warning) / 0.15), 0 4px 16px hsl(var(--heroui-warning) / 0.08)",backdropFilter:"blur(16px)"}}},containerStyle:i,gutter:8,reverseOrder:!1})},Ae="/assets/logo-6VVD5FfA.png",uo=({isMobileOpen:n,setIsMobileOpen:e,isCollapsed:t,onToggleCollapse:r})=>{var h,g,f,v,y,p;const{user:s,signOut:i}=xe(),o=er(),l=gt(),c=[{id:"dashboard",name:"Dashboard",icon:N.home,path:"/dashboard"},{id:"deals",name:"Browse Platforms",icon:N.search,path:"/dashboard/deals"},{id:"my-deals",name:"My Ratings",icon:N.star,path:"/my-deals"}],u=async()=>{try{await i(),e(!1),l("/")}catch(b){console.error("Error signing out:",b),l("/")}},d=()=>{l("/profile"),e(!1)};return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:`hidden lg:block h-screen lg:flex-shrink-0 transition-all duration-300 relative ${t?"w-16":"w-64"}`,children:[a.jsx("button",{onClick:r,className:"absolute top-1/2 -right-4 z-50 w-8 h-8 bg-content1 border-2 border-border rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-200 hover:bg-content2 hover:border-primary/30 group hover:scale-105 active:scale-95",style:{transform:"translateY(-50%)"},"aria-label":t?"Expand sidebar":"Collapse sidebar",children:t?a.jsx(N.chevronRight,{className:"w-4 h-4 text-foreground/70 group-hover:text-primary transition-colors duration-200"}):a.jsx(N.chevronLeft,{className:"w-4 h-4 text-foreground/70 group-hover:text-primary transition-colors duration-200"})}),a.jsx("div",{className:"flex flex-col h-full w-full bg-content1 border-r border-border overflow-x-hidden",children:a.jsxs("div",{className:`flex flex-col h-full ${t?"container-p-sm pb-0":"container-p-xs"}`,children:[a.jsxs("div",{className:`flex items-center ${t?"justify-center":"justify-between"} container-p-sm border-b border-border flex-shrink-0 mb-md`,children:[!t&&a.jsxs("div",{className:"flex items-center gap-xs container-p-xs",children:[a.jsx("img",{src:Ae,alt:"Oentex",className:"h-8 w-auto"}),a.jsx("span",{className:"text-lg font-bold text-foreground",children:"Oentex"})]}),t&&a.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center overflow-hidden",children:a.jsx("img",{src:Ae,alt:"Oentex",className:"h-6 w-auto"})})]}),a.jsx("div",{className:`${t?"flex justify-center":""} container-p-sm border-b border-border flex-shrink-0 mb-md`,children:a.jsxs("button",{onClick:d,className:`w-full flex items-center ${t?"justify-center group":"gap-xs"} container-p-sm rounded-lg transition-colors duration-200 hover:bg-content2`,"aria-label":"View profile",title:t?((h=s==null?void 0:s.user_metadata)==null?void 0:h.full_name)||((g=s==null?void 0:s.email)==null?void 0:g.split("@")[0])||"User":void 0,children:[a.jsx("div",{className:`${t?"w-12 h-12":"w-8 h-8"} flex items-center justify-center flex-shrink-0 ${t?"rounded-lg":"rounded-full bg-content2"}`,children:a.jsx(N.user,{className:`${t?"w-6 h-6 group-hover:text-primary group-focus:text-primary":"w-4 h-4"} text-foreground/70`})}),!t&&a.jsxs("div",{className:"flex-1 min-w-0 text-left container-p-xs",children:[a.jsx("p",{className:"text-xs font-medium truncate text-foreground",children:((f=s==null?void 0:s.user_metadata)==null?void 0:f.full_name)||((v=s==null?void 0:s.email)==null?void 0:v.split("@")[0])||"User"}),a.jsx("p",{className:"text-xs truncate text-foreground/60",children:(s==null?void 0:s.email)||"user@example.com"})]})]})}),a.jsx("nav",{className:`flex-1 ${t?"flex flex-col items-center":"container-p-sm"} space-y-1 overflow-y-auto overflow-x-hidden mb-md`,children:c.map(b=>{const x=o.pathname===b.path;return a.jsxs("a",{href:b.path,onClick:w=>{w.preventDefault(),l(b.path),e(!1)},className:`${t?"w-12 h-12":"w-full"} flex items-center ${t?"justify-center":"gap-xs"} ${t?"container-p-sm":"container-px-sm container-py-xs"} rounded-lg text-left transition-colors duration-200 ${x?"text-primary":"hover:text-primary hover:bg-content2 text-foreground/60"}`,"aria-label":`Navigate to ${b.name}`,title:t?b.name:void 0,children:[a.jsx(b.icon,{className:"w-6 h-6"}),!t&&a.jsx("span",{className:"font-medium text-xs container-p-xs",children:b.name})]},b.id)})}),a.jsx("div",{className:`${t?"flex justify-center":""} container-p-sm border-t border-border flex-shrink-0 mt-md mb-0`,children:a.jsxs("button",{onClick:u,className:`${t?"w-12 h-12":"w-full"} flex items-center ${t?"justify-center":"justify-center sm:justify-start gap-xs"} ${t?"container-p-sm":"container-px-sm container-py-sm"} rounded-lg transition-colors duration-200 bg-content2 hover:bg-content3 text-foreground/70 hover:text-foreground`,"aria-label":"Sign out of account",title:t?"Sign Out":void 0,children:[a.jsx(N.logout,{className:"w-6 h-6"}),!t&&a.jsx("span",{className:"text-xs font-medium container-p-xs",children:"Sign Out"})]})})]})})]}),n&&a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden",onClick:()=>e(!1),"aria-label":"Close sidebar"}),a.jsx("div",{className:"fixed top-0 left-0 z-50 w-72 sm:w-80 h-screen bg-content1 border-r border-border lg:hidden",children:a.jsxs("div",{className:"flex flex-col h-full container-p-xs",children:[a.jsxs("div",{className:"flex items-center justify-between container-p-sm border-b border-border flex-shrink-0 mb-md",children:[a.jsxs("div",{className:"flex items-center gap-xs container-p-xs",children:[a.jsx("img",{src:Ae,alt:"Oentex",className:"h-8 w-auto"}),a.jsx("span",{className:"text-lg font-bold text-foreground",children:"Oentex"})]}),a.jsx("button",{onClick:()=>e(!1),className:"lg:hidden container-p-xs rounded-lg transition-colors hover:bg-content2 text-foreground/60","aria-label":"Close sidebar",children:a.jsx(N.close,{className:"w-5 h-5"})})]}),a.jsx("div",{className:"container-p-sm border-b border-border flex-shrink-0 mb-md",children:a.jsxs("button",{onClick:d,className:"w-full flex items-center gap-xs container-p-sm rounded-lg transition-colors duration-200 hover:bg-content2","aria-label":"View profile",children:[a.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 bg-primary",children:a.jsx(N.user,{className:"w-4 h-4 text-white"})}),a.jsxs("div",{className:"flex-1 min-w-0 text-left container-p-xs",children:[a.jsx("p",{className:"text-xs font-medium truncate text-foreground",children:((y=s==null?void 0:s.user_metadata)==null?void 0:y.full_name)||((p=s==null?void 0:s.email)==null?void 0:p.split("@")[0])||"User"}),a.jsx("p",{className:"text-xs truncate text-foreground/60",children:(s==null?void 0:s.email)||"user@example.com"})]})]})}),a.jsx("nav",{className:"flex-1 container-p-sm space-y-1 overflow-y-auto mb-md",children:c.map(b=>{const x=o.pathname===b.path;return a.jsxs("a",{href:b.path,onClick:w=>{w.preventDefault(),l(b.path),e(!1)},className:`w-full flex items-center gap-xs container-px-sm container-py-xs rounded-lg text-left transition-colors duration-200 ${x?"text-white bg-primary":"hover:bg-content2 text-foreground/60"}`,"aria-label":`Navigate to ${b.name}`,children:[a.jsx(b.icon,{className:"w-4 h-4"}),a.jsx("span",{className:"font-medium text-xs container-p-xs",children:b.name})]},b.id)})}),a.jsx("div",{className:"container-p-sm border-t border-border flex-shrink-0 mt-md",children:a.jsxs("button",{onClick:u,className:"w-full flex items-center justify-center sm:justify-start gap-xs container-px-sm container-py-sm rounded-lg transition-colors duration-200 bg-content2 hover:bg-content3 text-foreground/70 hover:text-foreground","aria-label":"Sign out of account",children:[a.jsx(N.logout,{className:"w-4 h-4"}),a.jsx("span",{className:"text-xs font-medium container-p-xs",children:"Sign Out"})]})})]})})]})]})},ho=({children:n})=>{var l,c;const[e,t]=m.useState(!1),[r,s]=m.useState(!1),{user:i,session:o}=xe();return m.useEffect(()=>{var f,v;if(!i||!((v=(f=o==null?void 0:o.user)==null?void 0:f.app_metadata)!=null&&v.provider))return;const u=o.user.app_metadata.provider,h=`welcome_toast_${o.user.id}`;if(sessionStorage.getItem(h))return;sessionStorage.setItem(h,"true");const g=u==="google"?"Google":u==="azure"?"Microsoft":"OAuth";setTimeout(()=>{Or(`Successfully signed in with ${g}`,"Welcome to Oentex!",5e3)},500)},[i==null?void 0:i.id,(c=(l=o==null?void 0:o.user)==null?void 0:l.app_metadata)==null?void 0:c.provider]),m.useEffect(()=>{i||Object.keys(sessionStorage).forEach(u=>{u.startsWith("welcome_toast_")&&sessionStorage.removeItem(u)})},[i]),m.useEffect(()=>{const u=()=>{window.innerWidth>=1024&&t(!1)};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),a.jsxs("div",{className:"h-screen bg-background flex",children:[a.jsx(Ir,{position:"top-right",topAnchorSelector:"#auth-topbar",topMargin:8}),a.jsx(uo,{isMobileOpen:e,setIsMobileOpen:t,isCollapsed:r,onToggleCollapse:()=>s(!r)}),a.jsxs("div",{className:"flex-1 h-screen overflow-y-auto",children:[a.jsx("header",{id:"auth-topbar",className:"bg-content1 border-b border-border container-px-sm md:container-px-md container-py-sm md:container-py-md flex-shrink-0",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("button",{onClick:()=>t(!0),className:"lg:hidden container-p-sm rounded-lg transition-colors duration-200 -ml-2 hover:bg-content2 text-foreground/60","aria-label":"Open sidebar menu",children:a.jsx(N.menu,{className:"w-6 h-6"})}),a.jsx("div",{className:"lg:hidden flex items-center gap-xs container-p-xs",children:a.jsx("span",{className:"text-lg font-bold text-foreground",children:"Oentex"})}),a.jsx("div",{className:"hidden lg:block"})]})}),a.jsx("main",{className:"flex-1 overflow-y-auto",children:a.jsx("div",{className:"container-p-sm md:container-p-md lg:container-p-lg",children:n})})]})]})},Zt=()=>{var d,h,g;const[n,e]=m.useState(!1),{user:t,signOut:r,loading:s,error:i,retryAuth:o}=xe(),l=gt(),c=m.useCallback(async()=>{if(!n){e(!0);try{await r()}finally{e(!1)}}},[r,n]),u=m.useCallback(()=>{l("/authentication")},[l]);if(s)return a.jsxs("div",{className:"flex items-center space-x-4 px-6 py-3 bg-gradient-to-r from-default-100 to-default-50 rounded-2xl border border-default-200 shadow-sm",children:[a.jsx(tt,{size:"sm",color:"primary"}),a.jsx("span",{className:"text-sm text-foreground-500 hidden sm:block font-medium",children:"Loading..."})]});if(i)return a.jsxs("div",{className:"flex items-center space-x-4 px-6 py-3 bg-gradient-to-r from-danger-100 to-danger-50 rounded-2xl border border-danger-200 shadow-sm",children:[a.jsx("div",{className:"w-8 h-8 bg-danger-200 rounded-full flex items-center justify-center",children:a.jsx(Xt,{name:"warning",size:"sm",color:"danger"})}),a.jsx(ke,{size:"sm",variant:"light",color:"danger",onPress:o,className:"text-sm underline font-medium",children:"Retry"})]});if(t){const f=((d=t.user_metadata)==null?void 0:d.full_name)||((h=t.email)==null?void 0:h.split("@")[0])||"User",v=f.split(" ").map(y=>y[0]).join("").toUpperCase().slice(0,2);return a.jsx("div",{className:"flex items-center space-x-4 px-4 py-2",children:a.jsxs(Rn,{placement:"bottom-end",children:[a.jsx(An,{children:a.jsxs("div",{className:"flex items-center space-x-4 cursor-pointer hover:opacity-80 transition-all duration-300 p-4 rounded-2xl hover:bg-gradient-to-r hover:from-default-100 hover:to-default-50 border border-transparent hover:border-default-200 shadow-sm hover:shadow-md",children:[a.jsx(On,{name:v,src:(g=t.user_metadata)==null?void 0:g.avatar_url,size:"sm",className:"bg-gradient-to-r from-primary to-secondary text-white shadow-lg"}),a.jsx("span",{className:"text-sm font-medium hidden sm:block text-foreground",children:f})]})}),a.jsxs(In,{"aria-label":"User menu",children:[a.jsx(je,{className:"h-14 gap-2",textValue:`Signed in as ${f}`,children:a.jsxs("div",{className:"flex flex-col",children:[a.jsx("span",{className:"text-sm font-semibold",children:"Signed in as"}),a.jsx("span",{className:"text-sm text-foreground-500",children:t.email})]})},"profile"),a.jsx(je,{href:"/dashboard",className:"text-foreground",children:"Dashboard"},"dashboard"),a.jsx(je,{href:"/profile",className:"text-foreground",children:"Profile Settings"},"profile-page"),a.jsx(je,{href:"/my-deals",className:"text-foreground",children:"My Deals"},"my-deals"),a.jsx(je,{color:"danger",className:"text-danger",onPress:c,startContent:n?a.jsx(tt,{size:"sm",color:"danger"}):a.jsx(Xt,{name:"logout",size:"sm"}),children:n?"Signing out...":"Sign Out"},"logout")]})]})})}return a.jsx(xt,{children:a.jsx(ke,{color:"primary",variant:"solid",onPress:u,className:"bg-gradient-to-r from-primary to-secondary text-white font-medium hover:opacity-90 transition-all rounded-2xl container-px-lg container-py-md",children:"Launch App"})})},fo=()=>{const[n,e]=m.useState(!1),t=[{name:"About",to:"/about"},{name:"Deals",to:"/deals"},{name:"FAQ",to:"/faq"},{name:"Contact",to:"/contact"}];return a.jsx("header",{id:"site-header",className:"fixed top-0 left-0 right-0 z-50 bg-background/95 backdrop-blur-sm border-b border-border",children:a.jsxs("div",{className:"container-page",children:[a.jsxs("div",{className:"flex justify-between items-center h-16",children:[a.jsxs(X,{to:"/",className:"flex items-center space-x-2 group",children:[a.jsx("img",{src:Ae,alt:"Oentex Logo",className:"w-12 h-12 object-contain group-hover:scale-110 transition-transform duration-300"}),a.jsx("span",{className:"font-bold text-xl text-text group-hover:text-primary transition-colors",children:"Oentex"})]}),a.jsx("nav",{className:"hidden md:flex items-center space-x-10",children:t.map(r=>a.jsx(X,{to:r.to,className:"text-textSecondary hover:text-text transition-colors font-medium hover:scale-105 transform duration-200 px-sm py-xs",children:r.name},r.name))}),a.jsx("div",{className:"hidden md:flex items-center",children:a.jsx(Zt,{})}),a.jsx("button",{onClick:()=>e(!n),className:"md:hidden p-sm rounded-lg text-textSecondary hover:text-text hover:bg-surface transition-colors",children:n?a.jsx(N.close,{className:"w-6 h-6"}):a.jsx(N.menu,{className:"w-6 h-6"})})]}),n&&a.jsx("div",{className:"md:hidden",children:a.jsxs("div",{className:"container-px-xs container-py-sm space-y-2 border-t border-border bg-background",children:[t.map(r=>a.jsx(X,{to:r.to,className:"block container-px-md container-py-md text-textSecondary hover:text-text hover:bg-surface rounded-lg transition-colors",onClick:()=>e(!1),children:r.name},r.name)),a.jsx("div",{className:"container-px-sm container-py-sm border-t border-border mt-2 pt-4",children:a.jsx(Zt,{})})]})})]})})},go=()=>a.jsx("svg",{viewBox:"0 0 24 24",className:"w-5 h-5",fill:"currentColor","aria-hidden":"true",children:a.jsx("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})}),mo=()=>{const n=new Date().getFullYear(),e={product:{title:"Product",links:[{name:"Deals",to:"/deals"},{name:"FAQ",to:"/faq"},{name:"Platforms",to:"/platforms"}]},company:{title:"Company",links:[{name:"About",to:"/about"},{name:"Contact",to:"/contact"},{name:"Careers",to:"/careers"}]}},t=[{name:"X (Twitter)",icon:go,to:"https://x.com/oentex_official"},{name:"Email",icon:N.mail,to:"mailto:support@oentex.com"}],r=s=>({product:"lg:col-span-3",company:"lg:col-span-3"})[s]||"lg:col-span-3";return a.jsx("footer",{className:"bg-content2 border-t border-divider mt-auto",children:a.jsxs("div",{className:"container-page",children:[a.jsx("div",{className:"section-py-xl",children:a.jsxs("div",{className:"grid grid-cols-12 gap-2xl",children:[a.jsxs("div",{className:"col-span-12 md:col-span-6 lg:col-span-6 flex flex-col pr-lg py-md",children:[a.jsx("div",{className:"mb-lg pr-sm py-sm",children:a.jsxs(X,{to:"/",className:"flex items-center space-x-3 group",children:[a.jsx("img",{src:Ae,alt:"Oentex Logo",className:"w-12 h-12 object-contain group-hover:scale-110 transition-transform duration-300"}),a.jsxs("div",{children:[a.jsx("span",{className:"font-bold text-2xl text-foreground group-hover:text-primary transition-colors duration-300",children:"Oentex"}),a.jsx("p",{className:"text-foreground/60 text-sm font-medium",children:"Trading Platform Reviews"})]})]})}),a.jsx("p",{className:"text-foreground/80 text-sm mb-2xl leading-relaxed max-w-lg pr-sm py-sm",children:"Discover and rate the best trading platforms, exchanges, and financial services. Make informed decisions with real user reviews and comprehensive ratings."}),a.jsxs("div",{className:"mt-auto pt-2xl pr-sm py-sm",children:[a.jsx("h5",{className:"text-sm font-semibold text-foreground mb-md",children:"Follow Us"}),a.jsx("div",{className:"flex items-center space-x-3",children:t.map(s=>a.jsx(X,{to:s.to,className:"text-foreground/70 hover:text-primary transition-all duration-200 p-sm rounded-lg hover:bg-primary/10 group relative",target:s.to.startsWith("http")?"_blank":void 0,rel:s.to.startsWith("http")?"noopener noreferrer":void 0,"aria-label":s.name,children:a.jsx(s.icon,{className:"w-5 h-5 group-hover:scale-110 transition-transform duration-200"})},s.name))})]})]}),Object.entries(e).map(([s,i])=>a.jsxs("div",{className:`col-span-12 md:col-span-6 ${r(s)} space-y-4 px-lg py-md`,children:[a.jsx("h3",{className:"font-semibold text-foreground text-base mb-md px-sm py-sm",children:i.title}),a.jsx("nav",{className:"space-y-4 px-sm py-sm",children:i.links.map(o=>a.jsx(X,{to:o.to,className:"block text-foreground/70 hover:text-primary transition-all duration-200 text-sm hover:translate-x-1 transform group px-sm py-sm",children:a.jsx("span",{className:"group-hover:underline decoration-primary/50 underline-offset-4",children:o.name})},o.name))})]},s))]})}),a.jsx("div",{className:"border-t border-divider/50 section-py-lg",children:a.jsxs("div",{className:"grid grid-cols-12 gap-md items-center",children:[a.jsx("div",{className:"col-span-12 lg:col-span-6",children:a.jsxs("p",{className:"text-foreground/70 text-sm text-center lg:text-left",children:["© ",n," Oentex. All rights reserved."]})}),a.jsx("div",{className:"col-span-12 lg:col-span-6",children:a.jsxs("div",{className:"flex items-center justify-center lg:justify-end space-x-8 px-lg py-sm",children:[a.jsx(X,{to:"/privacy",className:"text-foreground/70 hover:text-primary transition-colors text-sm hover:underline underline-offset-4 decoration-primary/50 px-md py-sm",children:"Privacy"}),a.jsx(X,{to:"/terms",className:"text-foreground/70 hover:text-primary transition-colors text-sm hover:underline underline-offset-4 decoration-primary/50 px-md py-sm",children:"Terms"}),a.jsx(X,{to:"/cookies",className:"text-foreground/70 hover:text-primary transition-colors text-sm hover:underline underline-offset-4 decoration-primary/50 px-md py-sm",children:"Cookies"})]})})]})})]})})},q=({children:n,className:e="",hideHeader:t=!1,hideFooter:r=!1})=>a.jsxs("div",{className:`min-h-screen bg-background text-foreground background-enhanced ${e}`,children:[a.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/2 via-transparent to-secondary/2 pointer-events-none"}),a.jsx("div",{className:"absolute top-0 right-0 w-96 h-96 bg-gradient-to-br from-primary/5 to-transparent rounded-full blur-3xl animate-float pointer-events-none"}),a.jsx("div",{className:"absolute bottom-0 left-0 w-96 h-96 bg-gradient-to-tr from-secondary/5 to-transparent rounded-full blur-3xl animate-float pointer-events-none",style:{animationDelay:"-3s"}}),!t&&a.jsx(fo,{}),a.jsx("main",{className:`relative z-10 flex-1 layout-transition ${t?"pt-0":"pt-16"}`,children:a.jsx("div",{className:"component-transition",children:n})}),!r&&a.jsx(mo,{}),a.jsx(Ir,{position:t?"bottom-center":"top-right",topAnchorSelector:t?void 0:"#site-header",topMargin:t?0:8})]}),po=m.lazy(()=>C(()=>import("./Home-CxUxCIMk.js"),__vite__mapDeps([3,2,1,4,5,6]))),vo=m.lazy(()=>C(()=>import("./About-DP5XpUcz.js"),__vite__mapDeps([7,2,1,8,6,9]))),bo=m.lazy(()=>C(()=>import("./Deals-BR4nWU8J.js"),__vite__mapDeps([10,2,1,11,12,13,4,5,6]))),wo=m.lazy(()=>C(()=>import("./FAQ-D5_rktkM.js"),__vite__mapDeps([14,2,1,8,6]))),yo=m.lazy(()=>C(()=>import("./Contact-x96LgbJK.js"),__vite__mapDeps([15,2,1,8,6]))),xo=m.lazy(()=>C(()=>import("./Terms-DRavkIlj.js"),__vite__mapDeps([16,2,1,6]))),_o=m.lazy(()=>C(()=>import("./Privacy-DAMOe8A9.js"),__vite__mapDeps([17,2,1,6]))),jo=m.lazy(()=>C(()=>import("./Authentication-gi9y3J0A.js"),__vite__mapDeps([18,2,1,6]))),Eo=m.lazy(()=>C(()=>import("./AuthCallback-XWfgbNRf.js"),__vite__mapDeps([19,2,1]))),So=m.lazy(()=>C(()=>import("./ResetPassword-W1Tb2RJR.js"),__vite__mapDeps([20,2,1]))),_t=m.lazy(()=>C(()=>import("./Unsubscribe-CgMfGXiu.js"),__vite__mapDeps([21,2,1]))),ko=m.lazy(()=>C(()=>import("./Dashboard-B7Ip_2vW.js"),__vite__mapDeps([22,2,1,13]))),To=m.lazy(()=>C(()=>import("./Deals-B5hcy_gQ.js"),__vite__mapDeps([23,2,1,11,12,13,4]))),No=m.lazy(()=>C(()=>import("./MyDeals-CdSsdiA0.js"),__vite__mapDeps([24,2,1,12,13]))),Ro=m.lazy(()=>C(()=>import("./Profile-BAA2W5m0.js"),__vite__mapDeps([25,2,1]))),Ao=()=>a.jsx(m.Suspense,{fallback:a.jsx(Ke,{message:"Processing OAuth tokens..."}),children:a.jsx(Eo,{})}),Oo=({children:n})=>a.jsx(q,{hideHeader:!0,hideFooter:!0,children:n}),Io=()=>a.jsx(ho,{children:a.jsx(m.Suspense,{fallback:a.jsx(Ke,{message:"Loading dashboard..."}),children:a.jsxs(mt,{children:[a.jsx($,{path:"/",element:a.jsx(It,{to:"/dashboard",replace:!0})}),a.jsx($,{path:"/dashboard",element:a.jsx(ko,{})}),a.jsx($,{path:"/dashboard/deals",element:a.jsx(To,{})}),a.jsx($,{path:"/my-deals",element:a.jsx(No,{})}),a.jsx($,{path:"/profile",element:a.jsx(Ro,{})}),a.jsx($,{path:"/unsubscribe",element:a.jsx(_t,{})}),a.jsx($,{path:"*",element:a.jsx(It,{to:"/dashboard",replace:!0})})]})})}),$o=()=>a.jsxs(a.Fragment,{children:[a.jsx(so,{}),a.jsx(xt,{children:a.jsx(m.Suspense,{fallback:a.jsx(Ke,{message:"Loading page..."}),children:a.jsxs(mt,{children:[a.jsx($,{path:"/",element:a.jsx(q,{children:a.jsx(po,{})})}),a.jsx($,{path:"/about",element:a.jsx(q,{children:a.jsx(vo,{})})}),a.jsx($,{path:"/deals",element:a.jsx(q,{children:a.jsx(bo,{})})}),a.jsx($,{path:"/faq",element:a.jsx(q,{children:a.jsx(wo,{})})}),a.jsx($,{path:"/contact",element:a.jsx(q,{children:a.jsx(yo,{})})}),a.jsx($,{path:"/terms",element:a.jsx(q,{children:a.jsx(xo,{})})}),a.jsx($,{path:"/privacy",element:a.jsx(q,{children:a.jsx(_o,{})})}),a.jsx($,{path:"/unsubscribe",element:a.jsx(q,{children:a.jsx(_t,{})})}),a.jsx($,{path:"/authentication",element:a.jsx(Oo,{children:a.jsx(jo,{})})}),a.jsx($,{path:"/auth/callback",element:a.jsx(q,{children:a.jsx(Ao,{})})}),a.jsx($,{path:"/auth/reset-password",element:a.jsx(q,{children:a.jsx(So,{})})}),a.jsx($,{path:"*",element:a.jsx(q,{children:a.jsx("div",{className:"min-h-screen flex items-center justify-center pt-20",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h1",{className:"text-4xl font-bold text-text mb-4",children:"404"}),a.jsx("p",{className:"text-textSecondary mb-6",children:"Page not found"}),a.jsx("a",{href:"/",className:"btn-primary",children:"Go Home"})]})})})})]})})})]}),Po=()=>{const{user:n,loading:e,initialized:t,isFullyReady:r,error:s}=xe();return e||!t?a.jsx(Yt,{stage:"initializing"}):s&&!r?a.jsx(io,{error:s,showReturnHome:!1}):r?n?a.jsx(Io,{}):a.jsx($o,{}):a.jsx(Yt,{stage:"validating"})};function Co(){return a.jsxs(xt,{children:[a.jsxs(mt,{children:[a.jsx($,{path:"/unsubscribe",element:a.jsx(m.Suspense,{fallback:a.jsx(Ke,{message:"Loading unsubscribe..."}),children:a.jsx(_t,{})})}),a.jsx($,{path:"/*",element:a.jsx(Po,{})})]}),a.jsx(co,{}),!1]})}const Lo=new vn({defaultOptions:{queries:{staleTime:60*1e3}}});bn.hydrateRoot(document.getElementById("root"),a.jsx(wn.StrictMode,{children:a.jsx(yn,{children:a.jsx(xn,{client:Lo,children:a.jsx($n,{navigate:n=>{window.location.href=n},locale:"en-US",disableAnimation:!1,disableRipple:!1,validationBehavior:"native",reducedMotion:"user",children:a.jsx(ro,{children:a.jsx(_n,{children:a.jsx(Co,{})})})})})})}));export{no as A,Qo as D,q as G,N as I,Xo as L,Qt as a,Or as b,oo as c,P as d,te as e,Ae as l,B as s,xe as u};
