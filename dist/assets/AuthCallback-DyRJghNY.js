import{r as g,j as e}from"./heroui-0ik-TEjB.js";import{a as p,c as w}from"./router-Cc6Kb6KN.js";import{L as b,d as y,e as f}from"./index-xfTcSX6L.js";import"./query-CmYTTArA.js";const P=()=>{const n=p(),[r]=w(),[i,o]=g.useState(null);return g.useEffect(()=>{(async()=>{var c;try{const l=r.get("error"),h=r.get("error_code"),s=r.get("error_description");if(l){if(h==="unexpected_failure"&&(s!=null&&s.includes("email"))){o("Microsoft email access required. Please verify your email at account.microsoft.com or try Google sign-in.");return}o("Authentication failed. Please try again.");return}const a=r.get("redirect_to")||((c=y.auth)==null?void 0:c.redirectPath)||"/dashboard",d=r.get("code");if(d){const{error:t}=await f.exchangeCodeForSession(d);if(t){const m=(t==null?void 0:t.message)||"";if(m.includes("email")&&m.includes("external provider")){o("Microsoft email access required. Please verify your email at account.microsoft.com or try Google sign-in.");return}o("Authentication failed. Please try again.");return}const u=localStorage.getItem("returnTo");u&&localStorage.removeItem("returnTo"),n(u||a,{replace:!0});return}if(window.location.hash.includes("access_token")){window.history.replaceState&&window.history.replaceState(null,"",window.location.pathname),n(a,{replace:!0});return}const{session:x}=await f.getSession();if(x){const t=localStorage.getItem("returnTo");t&&localStorage.removeItem("returnTo"),n(t||a,{replace:!0});return}o("Please try signing in again.")}catch{o("Something went wrong. Please try again.")}})()},[n,r]),i?e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-content1 rounded-lg shadow-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Sign-in Failed"}),e.jsx("p",{className:"text-foreground/70 mb-6",children:i}),e.jsx("button",{onClick:()=>n("/",{replace:!0}),className:"w-full bg-blue-600 text-content1 px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"Try Again"})]})}):e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-content1 rounded-lg shadow-lg p-8 text-center",children:[e.jsx(b,{className:"mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-2",children:"Signing you in..."})]})})};export{P as default};
