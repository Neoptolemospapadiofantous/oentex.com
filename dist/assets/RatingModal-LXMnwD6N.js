import{r as g,j as e}from"./heroui-0ik-TEjB.js";import{u as y,I as x,a as p}from"./index-8n21VcdY.js";import{d as j,R as N}from"./useDealsQuery-BBNBvbrA.js";const C=({isOpen:h,onClose:l,companyId:v,companyName:c,existingRating:t,onRatingSubmitted:d,companyRating:m})=>{const{user:b}=y(),o=j(),[r,n]=g.useState({mode:"overall",overall_rating:0,platform_usability:0,customer_support:0,fees_commissions:0,security_trust:0,educational_resources:0,mobile_app:0});g.useEffect(()=>{if(t){const s=t.overall_rating?"overall":"categories";n({mode:s,overall_rating:t.overall_rating||0,platform_usability:t.platform_usability||0,customer_support:t.customer_support||0,fees_commissions:t.fees_commissions||0,security_trust:t.security_trust||0,educational_resources:t.educational_resources||0,mobile_app:t.mobile_app||0})}},[t]);const _=async()=>{if(!b){p("Please sign in to submit a rating");return}try{const s={};if(r.mode==="overall"){if(r.overall_rating===0){p("Please select an overall rating");return}s.overall_rating=r.overall_rating}else if(r.platform_usability>0&&(s.platform_usability=r.platform_usability),r.customer_support>0&&(s.customer_support=r.customer_support),r.fees_commissions>0&&(s.fees_commissions=r.fees_commissions),r.security_trust>0&&(s.security_trust=r.security_trust),r.educational_resources>0&&(s.educational_resources=r.educational_resources),r.mobile_app>0&&(s.mobile_app=r.mobile_app),!Object.values(s).some(i=>i&&i>0)){p("Please rate at least one category");return}console.log("📊 Modern rating submission via mutation hook..."),await o.mutateAsync({userId:b.id,companyId:v,ratings:s,existingRating:t}),l(),d==null||d(),console.log("✅ Modern rating submission completed successfully")}catch(s){console.error("❌ Modern rating submission failed:",s)}},f=({rating:s,onRatingChange:a,label:i})=>e.jsxs("div",{className:"flex items-center justify-between container-py-md",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:i}),e.jsxs("div",{className:"flex items-center gap-xs",children:[[1,2,3,4,5].map(u=>e.jsx("button",{type:"button",onClick:()=>a(u),className:"container-p-xs hover:scale-110 transition-transform rounded-sm focus:outline-none focus:ring-2 focus:ring-primary/40",disabled:o.isPending,children:e.jsx(x.star,{className:`w-6 h-6 transition-colors ${u<=s?"fill-warning text-warning":"text-content3 hover:text-warning"}`})},u)),e.jsx("span",{className:"ml-sm text-sm text-foreground/60 min-w-[3ch]",children:s>0?s.toFixed(1):""})]})]});return h?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 container-p-lg",children:e.jsxs("div",{className:"bg-content1/90 backdrop-blur-xl rounded-3xl max-w-xl w-full max-h-[90vh] overflow-y-auto border border-divider/30 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between container-p-2xl border-b border-divider/30",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-foreground",children:["Rate ",c]}),m&&e.jsxs("p",{className:"text-sm text-foreground/60 mt-xs",children:["Current: ",m.averageRating.toFixed(1),"⭐ (",m.totalRatings," reviews)"]})]}),e.jsx("button",{onClick:l,className:"container-p-sm hover:bg-content2 rounded-lg transition-colors",disabled:o.isPending,children:e.jsx(x.close,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"container-p-2xl border-b border-divider/30",children:e.jsxs("div",{className:"flex gap-sm",children:[e.jsx("button",{type:"button",onClick:()=>n(s=>({...s,mode:"overall"})),className:`container-px-lg container-py-sm rounded-xl text-sm font-medium transition-colors ${r.mode==="overall"?"bg-primary text-white":"bg-content2 text-foreground/70 hover:bg-primary/10"}`,disabled:o.isPending,children:"Overall Rating"}),e.jsx("button",{type:"button",onClick:()=>n(s=>({...s,mode:"categories"})),className:`container-px-lg container-py-sm rounded-xl text-sm font-medium transition-colors ${r.mode==="categories"?"bg-primary text-white":"bg-content2 text-foreground/70 hover:bg-primary/10"}`,disabled:o.isPending,children:"Detailed Rating"})]})}),e.jsx("div",{className:"container-p-2xl",children:r.mode==="overall"?e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-foreground/60 mb-lg",children:["Rate your overall experience with ",c]}),e.jsx(f,{rating:r.overall_rating,onRatingChange:s=>n(a=>({...a,overall_rating:s})),label:"Overall Experience"})]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-foreground/60 mb-lg",children:["Rate different aspects of ",c," (optional categories)"]}),e.jsx("div",{className:"space-y-xs",children:N.map(s=>e.jsx(f,{rating:r[s.key],onRatingChange:a=>n(i=>({...i,[s.key]:a})),label:s.label},s.key))})]})}),e.jsxs("div",{className:"flex gap-md container-p-2xl border-t border-divider/30",children:[e.jsx("button",{type:"button",onClick:l,className:"flex-1 container-px-lg container-py-md border border-divider rounded-xl text-foreground/70 hover:bg-content2 transition-colors",disabled:o.isPending,children:"Cancel"}),e.jsx("button",{type:"button",onClick:_,disabled:o.isPending,className:"flex-1 container-px-lg container-py-md bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-sm",children:o.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x.refresh,{className:"w-4 h-4 animate-spin"}),"Submitting..."]}):"Submit Rating"})]})]})}):null};export{C as R};
