import{V as N,r as x,j as e,aP as w,aQ as P,aR as R,aS as C,aL as S,aT as A,O as h,S as b,N as E,a3 as m}from"./index-q1shbo1Y.js";import{c as k,R as O}from"./useDealsQuery-DE1_uq8W.js";import{t as D,a as j}from"./useCategoriesQuery-DpmMe7TM.js";const M=({isOpen:v,onClose:_,companyId:y,companyName:c,existingRating:t,onRatingSubmitted:d,companyRating:u})=>{const{user:f}=N(),i=k(),[s,n]=x.useState({mode:"overall",overall_rating:0,platform_usability:0,customer_support:0,fees_commissions:0,security_trust:0,educational_resources:0,mobile_app:0});x.useEffect(()=>{if(t){const a=t.overall_rating?"overall":"categories";n({mode:a,overall_rating:t.overall_rating||0,platform_usability:t.platform_usability||0,customer_support:t.customer_support||0,fees_commissions:t.fees_commissions||0,security_trust:t.security_trust||0,educational_resources:t.educational_resources||0,mobile_app:t.mobile_app||0})}},[t]);const g=async()=>{if(!f){m.error("Please sign in to submit a rating");return}try{const a={};if(s.mode==="overall"){if(s.overall_rating===0){m.error("Please select an overall rating");return}a.overall_rating=s.overall_rating}else if(s.platform_usability>0&&(a.platform_usability=s.platform_usability),s.customer_support>0&&(a.customer_support=s.customer_support),s.fees_commissions>0&&(a.fees_commissions=s.fees_commissions),s.security_trust>0&&(a.security_trust=s.security_trust),s.educational_resources>0&&(a.educational_resources=s.educational_resources),s.mobile_app>0&&(a.mobile_app=s.mobile_app),!Object.values(a).some(r=>r&&r>0)){m.error("Please rate at least one category");return}await i.mutateAsync({userId:f.id,companyId:y,ratings:a,existingRating:t}),_(),d==null||d()}catch(a){console.error("Rating submission failed:",a)}},p=({rating:a,onRatingChange:l,label:r})=>e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsx("span",{className:"text-small font-medium",children:r}),e.jsxs("div",{className:"flex items-center gap-1",children:[[1,2,3,4,5].map(o=>e.jsx(E.button,{type:"button",onClick:()=>l(o),className:"p-1 rounded-small",disabled:i.isPending,whileHover:{scale:1.1},whileTap:{scale:.95},children:e.jsx(b,{className:`w-6 h-6 transition-colors ${o<=a?"fill-warning text-warning":"text-default-300 hover:text-warning"}`})},o)),e.jsx("span",{className:"ml-2 text-small text-default-500 min-w-[3ch]",children:a>0?a.toFixed(1):""})]})]});return e.jsx(w,{isOpen:v,onClose:_,size:"md",backdrop:"blur",children:e.jsx(P,{children:a=>e.jsxs(e.Fragment,{children:[e.jsx(R,{children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Rate ",c]}),u&&e.jsxs("p",{className:"text-small text-default-500",children:["Current: ",u.averageRating.toFixed(1),"⭐ (",u.totalRatings," reviews)"]})]})}),e.jsxs(C,{children:[e.jsxs(D,{selectedKey:s.mode,onSelectionChange:l=>n(r=>({...r,mode:l})),variant:"underlined",color:"primary",className:"w-full",isDisabled:i.isPending,children:[e.jsx(j,{title:"Overall Rating"},"overall"),e.jsx(j,{title:"Detailed Rating"},"categories")]}),e.jsx(S,{}),e.jsx("div",{className:"py-4",children:s.mode==="overall"?e.jsxs("div",{children:[e.jsxs("p",{className:"text-small text-default-600 mb-4",children:["Rate your overall experience with ",c]}),e.jsx(p,{rating:s.overall_rating,onRatingChange:l=>n(r=>({...r,overall_rating:l})),label:"Overall Experience"})]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-small text-default-600 mb-4",children:["Rate different aspects of ",c," (optional categories)"]}),e.jsx("div",{className:"space-y-1",children:O.map(l=>e.jsx(p,{rating:s[l.key],onRatingChange:r=>n(o=>({...o,[l.key]:r})),label:l.label},l.key))})]})})]}),e.jsxs(A,{children:[e.jsx(h,{variant:"light",onPress:a,isDisabled:i.isPending,children:"Cancel"}),e.jsx(h,{color:"primary",onPress:g,isLoading:i.isPending,startContent:!i.isPending&&e.jsx(b,{className:"w-4 h-4"}),children:i.isPending?"Submitting...":"Submit Rating"})]})]})})})};export{M as R};
