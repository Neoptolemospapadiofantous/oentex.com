import{r as d,j as e}from"./heroui-0ik-TEjB.js";import{u as K,I as m,D as V}from"./index-xfTcSX6L.js";import{u as X,U as ee}from"./useDebounce-CUUeozPM.js";import{R as ae}from"./RatingModal-9i2Eq9WL.js";import{u as ne,a as te,b as re}from"./useDealsQuery-DWygHkjP.js";import{u as se,a as oe,b as ie}from"./useCategoriesQuery-CJ254HAD.js";import"./router-Cc6Kb6KN.js";import"./query-CmYTTArA.js";const Ce=({isInDashboard:r=!1})=>{var F,E,P,U,I;const{user:t,isFullyReady:o}=K(),n=r||!!t,[a,g]=d.useState({searchTerm:"",category:"all",sortBy:"rating"}),[l,c]=d.useState(1),[x,w]=d.useState(null),[T,C]=d.useState(!1),z=X(a.searchTerm,300),v=12,u=ne(l,v,{searchTerm:z,category:a.category,sortBy:a.sortBy}),p=((F=u.data)==null?void 0:F.deals)||[],b=((E=u.data)==null?void 0:E.companies)||[],j=((P=u.data)==null?void 0:P.totalCount)||0,y=se(),h=y.data||[],Y=d.useMemo(()=>p.map(s=>{var i;return(i=s.company)==null?void 0:i.id}).filter(Boolean),[p]),L=te(t==null?void 0:t.id,Y),A=oe(Array.isArray(p)?p:[]).data||new Map,M=ie(Array.isArray(b)?b:[]).data||new Map,Q=re(),N=d.useMemo(()=>{const s=L.data||{};return p.map(i=>{var f;return{...i,userRating:(f=i.company)!=null&&f.id?s[i.company.id]:void 0}})},[p,L.data]),k=Math.ceil(j/v),H=l<k,W=l>1,$=d.useMemo(()=>{if(a.category==="all")return null;const s=h.find(f=>f.value===a.category),i=M.get(a.category);return{title:(s==null?void 0:s.label)||"Category Deals",description:(s==null?void 0:s.description)||"Exclusive deals in this category",companies:(i==null?void 0:i.companies)||[],count:(i==null?void 0:i.count)||0}},[a.category,h,M]),G=d.useCallback((s,i)=>{g(f=>({...f,[s]:i})),c(1)},[]),O=d.useCallback(s=>{c(s),window.scrollTo({top:0,behavior:"smooth"})},[]),Z=d.useCallback(s=>{if(!t){if(n){console.warn("Unauthenticated user in dashboard context");return}return}s.company&&(w(s),C(!0))},[t,n]),q=d.useCallback(async s=>{try{await Q.mutateAsync(s.id),window.open(s.affiliate_link,"_blank","noopener,noreferrer")}catch(i){console.error("Error tracking deal click:",i),window.open(s.affiliate_link,"_blank","noopener,noreferrer")}},[Q]),J=d.useCallback(()=>{C(!1),w(null)},[]),R=d.useCallback(()=>{u.refetch(),y.refetch()},[u,y]);if(y.error)return e.jsx(D,{isDashboard:n,icon:m.database,title:"Categories Not Available",description:"Categories table not found. Please run the SQL script to create the categories table.",actionLabel:"Retry Connection",onAction:R,colorScheme:"danger"});if(!o||u.isLoading||y.isLoading)return e.jsxs(S,{isDashboard:n,children:[e.jsx(_,{companiesCount:b.length,categoriesCount:h.length-1,isDashboard:n,isLoading:!0}),e.jsx(V,{})]});if(u.error)return e.jsx(D,{isDashboard:n,icon:m.warning,title:"Unable to Load Deals",description:u.error instanceof Error?u.error.message:"Failed to load deals",actionLabel:"Try Again",onAction:R,colorScheme:"warning"});if(!h.length)return e.jsx(D,{isDashboard:n,icon:m.database,title:"No Categories Found",description:"The categories table exists but contains no data. Please add categories to the database.",actionLabel:"Reload Categories",onAction:R,colorScheme:"default"});const B=e.jsxs(S,{isDashboard:n,children:[e.jsx(_,{companiesCount:b.length,categoriesCount:h.length-1,isDashboard:n}),e.jsx(le,{filters:a,categories:h,categoryStats:A,onFilterChange:G}),$&&e.jsx(de,{categoryInfo:$}),N.length===0&&!u.isLoading&&e.jsx(ce,{searchTerm:a.searchTerm,selectedCategory:a.category,onClearFilters:()=>{g({searchTerm:"",category:"all",sortBy:"rating"}),c(1)}}),N.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-xl my-4xl animate-fade-in-up",children:N.map((s,i)=>e.jsx("div",{className:"animate-scale-in",style:{animationDelay:`${i*100}ms`},children:e.jsx(ee,{deal:s,onRateClick:Z,onTrackClick:q,isGuest:!t,showRatingButton:!!t})},s.id))}),k>1&&e.jsx(me,{currentPage:l,totalPages:k,hasNextPage:H,hasPrevPage:W,onPageChange:O}),N.length>0&&e.jsxs("div",{className:"text-center text-foreground/70 text-sm mb-2xl",children:["Showing ",(l-1)*v+1," to ",Math.min(l*v,j)," of ",j," deals"]}),e.jsx(ue,{companiesCount:b.length,categories:h,categoryStats:A,totalCount:j}),T&&x&&t&&e.jsx(ae,{isOpen:T,onClose:()=>{C(!1),w(null)},companyId:x.company.id,companyName:x.company.name,existingRating:x.userRating,onRatingSubmitted:J,companyRating:{averageRating:((U=x.company)==null?void 0:U.overall_rating)||0,totalRatings:((I=x.company)==null?void 0:I.total_reviews)||0}})]});return B},S=({isDashboard:r,children:t})=>e.jsx("div",{className:`min-h-screen ${r?"":"background-enhanced"}`,children:e.jsx("div",{className:r?"container-p-sm md:container-p-md lg:container-p-lg":"container-page section-px-lg section-py-xl",children:t})}),le=({filters:r,categories:t,categoryStats:o,onFilterChange:n})=>e.jsx("div",{className:"glass-enhanced rounded-2xl border border-divider/40 mb-2xl shadow-enhanced backdrop-blur-strong animate-slide-in-left",children:e.jsxs("div",{className:"container-p-3xl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-lg mb-2xl",children:[e.jsxs("div",{className:"relative",children:[e.jsx(m.search,{className:"absolute text-foreground/60 w-5 h-5 z-10",style:{left:"var(--heroui-padding-lg)",top:"50%",transform:"translateY(-50%)"}}),e.jsx("input",{type:"text",placeholder:"Search deals, companies...",value:r.searchTerm,onChange:a=>n("searchTerm",a.target.value),className:"w-full py-3 bg-content1 border border-divider/50 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary/50 outline-none text-foreground text-base font-medium backdrop-blur-sm transition-all duration-300 hover:border-divider/70 hover:bg-content2 placeholder:text-foreground/60 h-12 focus-enhanced shadow-sm",style:{paddingLeft:"var(--heroui-padding-3xl)",paddingRight:"var(--heroui-padding-md)"}})]}),e.jsxs("div",{className:"relative",children:[e.jsx(m.filter,{className:"absolute text-foreground/60 w-5 h-5 z-10",style:{left:"var(--heroui-padding-lg)",top:"50%",transform:"translateY(-50%)"}}),e.jsx("select",{value:r.category,onChange:a=>n("category",a.target.value),className:"w-full py-3 bg-content1 border border-divider/50 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary/50 outline-none text-foreground backdrop-blur-sm transition-all duration-300 hover:border-divider/70 hover:bg-content2 h-12 appearance-none focus-enhanced shadow-sm",style:{paddingLeft:"var(--heroui-padding-3xl)",paddingRight:"var(--heroui-padding-2xl)"},children:t.map(a=>e.jsxs("option",{value:a.value,children:[a.label," ",a.value!=="all"&&`(${o.get(a.value)||0})`]},a.value))}),e.jsx(m.chevronDown,{className:"absolute text-foreground/60 w-4 h-4 pointer-events-none",style:{right:"var(--heroui-padding-sm)",top:"50%",transform:"translateY(-50%)"}})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:r.sortBy,onChange:a=>n("sortBy",a.target.value),className:"w-full py-3 bg-content1 border border-divider/50 rounded-lg focus:ring-2 focus:ring-primary/20 focus:border-primary/50 outline-none text-foreground backdrop-blur-sm transition-all duration-300 hover:border-divider/70 hover:bg-content2 h-12 appearance-none focus-enhanced shadow-sm",style:{paddingLeft:"var(--heroui-padding-md)",paddingRight:"var(--heroui-padding-2xl)"},children:[e.jsx("option",{value:"rating",children:"Highest Rated"}),e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"popular",children:"Most Claimed"}),e.jsx("option",{value:"name",children:"Company A-Z"})]}),e.jsx(m.chevronDown,{className:"absolute text-foreground/60 w-4 h-4 pointer-events-none",style:{right:"var(--heroui-padding-sm)",top:"50%",transform:"translateY(-50%)"}})]})]}),e.jsx("div",{className:"flex flex-wrap gap-lg py-xl",children:t.map((a,g)=>{const l=o.get(a.value)||0,c=r.category===a.value;return e.jsxs("button",{onClick:()=>n("category",a.value),className:`relative overflow-hidden gap-md flex items-center px-lg py-md text-sm font-medium transition-all duration-300 rounded-full animate-scale-in ${c?"bg-gradient-to-r from-primary to-secondary text-primary-foreground shadow-enhanced animate-glow-pulse":"bg-content2/50 text-foreground/80 border border-divider/50 hover:border-primary/30 hover:bg-content2/70"}`,style:{animationDelay:`${g*50}ms`},children:[e.jsx("span",{className:"relative z-10",children:a.label}),a.value!=="all"&&e.jsx("span",{className:`relative z-10 text-xs font-bold px-sm py-xs rounded-full transition-all duration-300 ${c?"bg-primary-foreground/20 text-primary-foreground":"bg-foreground/10 text-foreground/70"}`,children:l}),c&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-white/5 to-transparent animate-shimmer"})]},a.value)})})]})}),de=({categoryInfo:r})=>e.jsxs("div",{className:"bg-gradient-to-r from-primary/15 via-primary/8 to-secondary/15 rounded-xl container-p-lg mb-xl border border-primary/30 shadow-enhanced backdrop-blur-sm animate-slide-in-bottom",children:[e.jsx("h3",{className:"text-lg font-semibold text-foreground mb-md",children:r.title}),e.jsx("p",{className:"text-foreground/70 mb-lg",children:r.description}),e.jsxs("div",{className:"flex flex-wrap gap-md",children:[r.companies.slice(0,8).map((t,o)=>e.jsx("span",{className:"bg-primary/20 text-primary container-px-md container-py-sm rounded-lg text-sm border border-primary/30 animate-scale-in",style:{animationDelay:`${o*100}ms`},children:t},t)),r.companies.length>8&&e.jsxs("span",{className:"text-foreground/70 text-sm animate-fade-in",children:["+",r.companies.length-8," more"]})]})]}),ce=({searchTerm:r,selectedCategory:t,onClearFilters:o})=>e.jsxs("div",{className:"text-center py-4xl animate-fade-in-up",children:[e.jsx(m.gift,{className:"w-16 h-16 text-foreground/40 mx-auto mb-xl animate-float"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-md",children:"No deals found"}),e.jsx("p",{className:"text-foreground/70 mb-2xl",children:r||t!=="all"?"Try adjusting your search or filter criteria":"No deals are currently available. Check back soon!"}),e.jsx("button",{onClick:o,className:"btn-enhanced bg-primary text-primary-foreground px-xl py-md rounded-lg hover:bg-primary/90 transition-all duration-300 font-medium hover:scale-105",children:"Clear Filters"})]}),me=({currentPage:r,totalPages:t,hasNextPage:o,hasPrevPage:n,onPageChange:a})=>e.jsxs("div",{className:"flex items-center justify-center gap-xl my-4xl animate-fade-in-up",children:[e.jsxs("button",{onClick:()=>a(r-1),disabled:!n,className:"inline-flex items-center gap-sm bg-content2/50 text-foreground px-xl py-md rounded-lg hover:bg-content2/70 transition-all duration-300 font-medium disabled:opacity-50 disabled:cursor-not-allowed card-hover-enhanced focus-enhanced",children:[e.jsx(m.chevronLeft,{className:"w-4 h-4"}),"Previous"]}),e.jsxs("div",{className:"flex items-center gap-xl",children:[Array.from({length:Math.min(5,t)},(g,l)=>{const c=l+1,x=c===r;return e.jsx("button",{onClick:()=>a(c),className:`w-10 h-10 rounded-lg font-medium transition-all duration-300 card-hover-enhanced focus-enhanced ${x?"bg-gradient-to-r from-primary to-secondary text-primary-foreground shadow-enhanced":"bg-content2/50 text-foreground hover:bg-content2/70"}`,children:c},c)}),t>5&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-foreground/50",children:"..."}),e.jsx("button",{onClick:()=>a(t),className:"w-10 h-10 bg-content2/50 text-foreground rounded-lg hover:bg-content2/70 transition-all duration-300 font-medium card-hover-enhanced focus-enhanced",children:t})]})]}),e.jsxs("button",{onClick:()=>a(r+1),disabled:!o,className:"inline-flex items-center gap-sm bg-content2/50 text-foreground px-xl py-md rounded-lg hover:bg-content2/70 transition-all duration-300 font-medium disabled:opacity-50 disabled:cursor-not-allowed card-hover-enhanced focus-enhanced",children:["Next",e.jsx(m.chevronRight,{className:"w-4 h-4"})]})]}),ue=({companiesCount:r,categories:t,categoryStats:o})=>e.jsxs("div",{className:"glass-enhanced rounded-2xl container-p-2xl text-center shadow-enhanced-lg border border-divider/30 animate-fade-in-up background-enhanced",children:[e.jsxs("div",{className:"flex items-center justify-center gap-md my-xl",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-2xl flex items-center justify-center shadow-enhanced animate-float",children:e.jsx(m.users,{className:"w-6 h-6 text-white"})}),e.jsx("h3",{className:"text-xl font-semibold text-foreground",children:"Curated Trading Platforms"})]}),e.jsx("div",{className:"flex flex-col items-center justify-center",children:e.jsxs("p",{className:"text-foreground/70 max-w-3xl mx-auto my-2xl text-center text-lg leading-relaxed",children:[r," handpicked platforms across ",t.filter(n=>n.value!=="all"&&(o.get(n.value)||0)>0).length," categories. Every company is verified, regulated, and trusted by our trading community."]})}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-lg text-sm text-foreground/70",children:[t.filter(n=>n.value!=="all").filter(n=>(o.get(n.value)||0)>0).slice(0,3).map((n,a)=>{const g=o.get(n.value)||0;return e.jsxs("span",{className:"flex items-center gap-xs bg-content2/50 px-3 py-2 rounded-full border border-divider/30 animate-scale-in",style:{animationDelay:`${a*200}ms`},children:[e.jsx("span",{className:"text-success",children:"✓"}),e.jsxs("span",{children:[g," ",n.label]})]},n.value)}),e.jsxs("span",{className:"flex items-center gap-xs bg-content2/50 px-3 py-2 rounded-full border border-divider/30 animate-scale-in",style:{animationDelay:"600ms"},children:[e.jsx("span",{className:"text-success",children:"✓"}),e.jsx("span",{children:"Real Reviews"})]})]})]}),D=({isDashboard:r,icon:t,title:o,description:n,actionLabel:a,onAction:g,colorScheme:l})=>e.jsx(S,{isDashboard:r,children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center animate-fade-in-up",children:[e.jsx(t,{className:`w-12 h-12 mx-auto mb-xl ${l==="danger"?"text-danger":l==="warning"?"text-warning":"text-foreground/40"}`}),e.jsx("h2",{className:"text-xl font-semibold text-foreground mb-md",children:o}),e.jsx("p",{className:"text-foreground/70 mb-2xl max-w-md mx-auto",children:n}),e.jsxs("button",{onClick:g,className:`btn-enhanced inline-flex items-center gap-sm px-xl py-md rounded-lg transition-all duration-300 font-medium hover:scale-105 focus-enhanced ${l==="danger"?"bg-danger text-danger-foreground hover:bg-danger/90":l==="warning"?"bg-warning text-warning-foreground hover:bg-warning/90":"bg-primary text-primary-foreground hover:bg-primary/90"}`,children:[e.jsx(m.refresh,{className:"w-4 h-4"}),a]})]})})}),_=({companiesCount:r,categoriesCount:t,isDashboard:o,isLoading:n=!1})=>e.jsx("div",{className:"text-center mb-6xl animate-fade-in-up",children:e.jsxs("div",{className:"glass-enhanced rounded-3xl container-p-2xl border border-divider/30 shadow-enhanced-lg",children:[e.jsx("h1",{className:"text-4xl lg:text-5xl font-bold text-foreground mb-3xl",children:e.jsx("span",{className:"gradient-text-animated",children:o?"Browse Trading Platforms":"Trading Deals & Exclusive Bonuses"})}),e.jsx("p",{className:`text-foreground/70 mx-auto ${o?"text-sm mb-md":"text-xl mb-xl"}`,children:n?"Loading exclusive offers with real-time ratings...":`Curated offers from top platforms across ${t} categories`}),!n&&e.jsxs("p",{className:"text-foreground/70",children:[r," vetted platforms • Real community ratings • Updated daily"]})]})});export{Ce as default};
