import{r as o,j as e}from"./heroui-0ik-TEjB.js";import{u as $,I as n,s as _}from"./index-8n21VcdY.js";import{u as S}from"./query-CmYTTArA.js";import{R as K}from"./RatingModal-LXMnwD6N.js";import"./router-Cc6Kb6KN.js";import"./useDealsQuery-BBNBvbrA.js";const Y=()=>e.jsx("div",{className:"bg-content1/60 backdrop-blur-xl rounded-3xl container-p-lg border border-divider/30 animate-pulse",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 space-y-md",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-12 h-12 bg-content2 rounded-2xl"}),e.jsx("div",{className:"w-16 h-6 bg-content2 rounded-lg"})]}),e.jsxs("div",{className:"space-y-sm",children:[e.jsx("div",{className:"w-20 h-8 bg-content2 rounded-lg"}),e.jsx("div",{className:"w-32 h-4 bg-content2 rounded-md"})]})]})})}),H=()=>e.jsx("div",{className:"bg-content1/60 backdrop-blur-xl rounded-3xl container-p-lg border border-divider/30 animate-pulse",children:e.jsxs("div",{className:"space-y-md",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-md",children:[e.jsx("div",{className:"w-12 h-12 bg-content2 rounded-2xl"}),e.jsxs("div",{className:"space-y-sm",children:[e.jsx("div",{className:"w-32 h-5 bg-content2 rounded-md"}),e.jsx("div",{className:"w-24 h-4 bg-content2 rounded-md"})]})]}),e.jsx("div",{className:"w-16 h-8 bg-content2 rounded-lg"})]}),e.jsx("div",{className:"w-full h-16 bg-content2 rounded-lg"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"w-24 h-4 bg-content2 rounded-md"}),e.jsx("div",{className:"w-20 h-8 bg-content2 rounded-lg"})]})]})});function Q(t){const l=[t.platform_usability,t.customer_support,t.fees_commissions,t.security_trust,t.educational_resources,t.mobile_app].filter(d=>typeof d=="number"&&d>0);return l.length?Math.round(l.reduce((d,i)=>d+i,0)/l.length*10)/10:0}const ee=()=>{const{user:t}=$(),[l,d]=o.useState("newest"),[i,R]=o.useState("all"),[u,p]=o.useState(!1),[v,f]=o.useState(null),[k,C]=o.useState(""),[M,b]=o.useState(null),[A,D]=o.useState(void 0),{data:m=[],isLoading:F,error:T,refetch:j}=S({queryKey:["my-ratings",t==null?void 0:t.id],enabled:!!(t!=null&&t.id),queryFn:async()=>{const{data:r,error:s}=await _.from("ratings").select("*").eq("user_id",t.id).order("updated_at",{ascending:!1});if(s)throw s;return(r||[]).map(a=>({...a,rating:a.overall_rating&&a.overall_rating>0?a.overall_rating:Q(a)}))}}),g=o.useMemo(()=>Array.from(new Set(m.map(r=>r.company_id))),[m]),{data:h=[],isLoading:L,error:I,refetch:y}=S({queryKey:["my-rated-companies",g.sort().join(",")],enabled:g.length>0,queryFn:async()=>{const{data:r,error:s}=await _.from("trading_companies").select("id, name, slug, logo_url, category, overall_rating, total_reviews").in("id",g);if(s)throw s;return r||[]}}),c=o.useMemo(()=>{const r=new Map(h.map(s=>[s.id,s]));return m.map(s=>{const a=r.get(s.company_id);return{...s,company:a,company_name:(a==null?void 0:a.name)||"Unknown Company"}})},[m,h]),N=o.useMemo(()=>{let r=c;return i!=="all"&&(r=r.filter(s=>Number(s.rating)===Number(i))),r.sort((s,a)=>{switch(l){case"newest":return new Date(a.created_at).getTime()-new Date(s.created_at).getTime();case"oldest":return new Date(s.created_at).getTime()-new Date(a.created_at).getTime();case"rating":return(a.rating||0)-(s.rating||0);case"company":return(s.company_name||"").localeCompare(a.company_name||"");default:return 0}}),r},[c,l,i]),E=r=>{const s=h.find(a=>a.id===r.company_id);f(r.company_id),C((s==null?void 0:s.name)||"Unknown Company"),b(r),D(s?{averageRating:s.overall_rating||0,totalRatings:s.total_reviews||0}:void 0),p(!0)},U=()=>{p(!1),f(null),b(null)},q=()=>{j(),y()},P=()=>{j(),y()};if(F||L)return e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"container-page section-py-xl",children:[e.jsxs("div",{className:"text-center mb-2xl",children:[e.jsx("div",{className:"w-48 h-8 bg-content2 rounded-lg mx-auto mb-lg animate-pulse"}),e.jsx("div",{className:"w-64 h-6 bg-content2 rounded-lg mx-auto animate-pulse"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-lg mb-2xl",children:[...Array(3)].map((r,s)=>e.jsx(Y,{},s))}),e.jsx("div",{className:"space-y-md",children:[...Array(4)].map((r,s)=>e.jsx(H,{},s))})]})});if(T||I)return e.jsx("div",{className:"min-h-screen",children:e.jsx("div",{className:"container-page section-py-xl",children:e.jsx("div",{className:"flex items-center justify-center min-h-96",children:e.jsxs("div",{className:"text-center animate-fade-in-up",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-danger to-danger/80 rounded-3xl flex items-center justify-center mb-2xl shadow-2xl shadow-danger/20",children:e.jsx(n.warning,{className:"w-10 h-10 text-danger-foreground"})}),e.jsx("h2",{className:"text-3xl font-bold gradient-text mb-lg",children:"Failed to load your ratings"}),e.jsx("p",{className:"text-xl text-foreground/70 mb-2xl max-w-lg mx-auto",children:"There was an error loading your ratings data. Please try refreshing the page."}),e.jsxs("button",{onClick:P,className:"px-2xl py-lg bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white rounded-2xl font-semibold text-lg transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-primary/25",children:[e.jsx(n.refresh,{className:"w-5 h-5 mr-sm inline"}),"Try Again"]})]})})})});const x=c.length,B=x>0?(c.reduce((r,s)=>r+(s.rating||0),0)/x).toFixed(1):"0.0",O=x>0?new Date(Math.max(...c.map(r=>new Date(r.updated_at).getTime()))).toLocaleDateString():"Never";return e.jsx("div",{className:"min-h-screen",children:e.jsxs("div",{className:"container-page section-py-xl",children:[e.jsxs("div",{className:"text-center mb-2xl",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-bold gradient-text mb-lg",children:"My Platform Ratings"}),e.jsx("p",{className:"text-lg text-foreground/70 mb-sm",children:"Manage and review your platform ratings and reviews"}),e.jsx("p",{className:"text-sm text-foreground/60",children:"Track your trading platform experiences and share feedback with the community"})]}),e.jsx("section",{className:"mb-2xl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-lg",children:[e.jsx("div",{className:"group relative overflow-hidden bg-content1/60 backdrop-blur-xl rounded-3xl container-p-lg border border-divider/30 hover:border-primary/30 transition-all duration-500 hover:shadow-2xl hover:shadow-primary/10 transform hover:scale-[1.02]",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-lg",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-primary to-primary/80 rounded-2xl flex items-center justify-center shadow-lg transition-all duration-300 group-hover:scale-110 group-hover:rotate-3",children:e.jsx(n.star,{className:"w-7 h-7 text-primary-foreground"})})}),e.jsx("div",{className:"text-xs font-semibold px-sm py-xs rounded-lg bg-primary/20 text-primary border border-primary/30",children:"Platforms rated"})]}),e.jsxs("div",{className:"space-y-sm",children:[e.jsx("h3",{className:"text-4xl font-bold text-primary group-hover:text-primary transition-colors duration-300 tracking-tight",children:x}),e.jsx("p",{className:"text-base font-semibold text-foreground group-hover:text-foreground transition-colors duration-300",children:"Total Ratings"}),e.jsx("p",{className:"text-sm text-foreground/60 leading-relaxed",children:"Platforms you've reviewed"})]})]})}),e.jsx("div",{className:"group relative overflow-hidden bg-content1/60 backdrop-blur-xl rounded-3xl container-p-lg border border-divider/30 hover:border-success/30 transition-all duration-500 hover:shadow-2xl hover:shadow-success/10 transform hover:scale-[1.02]",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-lg",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-success to-success/80 rounded-2xl flex items-center justify-center shadow-lg transition-all duration-300 group-hover:scale-110 group-hover:rotate-3",children:e.jsx(n.arrowTrendingUp,{className:"w-7 h-7 text-success-foreground"})})}),e.jsx("div",{className:"text-xs font-semibold px-sm py-xs rounded-lg bg-success/20 text-success border border-success/30",children:"Your average"})]}),e.jsxs("div",{className:"space-y-sm",children:[e.jsx("h3",{className:"text-4xl font-bold text-success group-hover:text-success transition-colors duration-300 tracking-tight",children:B}),e.jsx("p",{className:"text-base font-semibold text-foreground group-hover:text-foreground transition-colors duration-300",children:"Average Rating"}),e.jsx("p",{className:"text-sm text-foreground/60 leading-relaxed",children:"Your satisfaction score"})]})]})}),e.jsx("div",{className:"group relative overflow-hidden bg-content1/60 backdrop-blur-xl rounded-3xl container-p-lg border border-divider/30 hover:border-warning/30 transition-all duration-500 hover:shadow-2xl hover:shadow-warning/10 transform hover:scale-[1.02]",children:e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-start justify-between mb-lg",children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-14 h-14 bg-gradient-to-br from-warning to-warning/80 rounded-2xl flex items-center justify-center shadow-lg transition-all duration-300 group-hover:scale-110 group-hover:rotate-3",children:e.jsx(n.calendar,{className:"w-7 h-7 text-warning-foreground"})})}),e.jsx("div",{className:"text-xs font-semibold px-sm py-xs rounded-lg bg-warning/20 text-warning border border-warning/30",children:"Most recent"})]}),e.jsxs("div",{className:"space-y-sm",children:[e.jsx("h3",{className:"text-lg font-bold text-warning group-hover:text-warning transition-colors duration-300 tracking-tight",children:O}),e.jsx("p",{className:"text-base font-semibold text-foreground group-hover:text-foreground transition-colors duration-300",children:"Last Updated"}),e.jsx("p",{className:"text-sm text-foreground/60 leading-relaxed",children:"Latest rating activity"})]})]})})]})}),e.jsx("section",{className:"mb-xl",children:e.jsxs("div",{className:"bg-content1/90 backdrop-blur-2xl rounded-3xl border border-divider/50 container-p-lg hover:shadow-2xl hover:shadow-primary/5 transition-all duration-500",children:[e.jsxs("div",{className:"flex items-center gap-md mb-lg",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-2xl flex items-center justify-center",children:e.jsx(n.filter,{className:"w-4 h-4 text-white"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Filter & Sort"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-lg",children:[e.jsxs("div",{className:"space-y-sm",children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-sm",children:"Filter by Rating"}),e.jsxs("select",{value:i,onChange:r=>R(r.target.value==="all"?"all":Number(r.target.value)),className:"w-full container-px-lg container-py-md border border-divider/50 rounded-2xl focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none text-foreground bg-content1 backdrop-blur-sm transition-all duration-300 hover:border-primary/50 hover:bg-content2 hover:shadow-lg hover:shadow-primary/10",children:[e.jsx("option",{value:"all",children:"All Ratings"}),e.jsx("option",{value:5,children:"5 Stars ⭐⭐⭐⭐⭐"}),e.jsx("option",{value:4,children:"4 Stars ⭐⭐⭐⭐"}),e.jsx("option",{value:3,children:"3 Stars ⭐⭐⭐"}),e.jsx("option",{value:2,children:"2 Stars ⭐⭐"}),e.jsx("option",{value:1,children:"1 Star ⭐"})]})]}),e.jsxs("div",{className:"space-y-sm",children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-sm",children:"Sort By"}),e.jsxs("select",{value:l,onChange:r=>d(r.target.value),className:"w-full container-px-lg container-py-md border border-divider/50 rounded-2xl focus:ring-2 focus:ring-primary/30 focus:border-primary outline-none text-foreground bg-content1 backdrop-blur-sm transition-all duration-300 hover:border-primary/50 hover:bg-content2 hover:shadow-lg hover:shadow-primary/10",children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"rating",children:"Highest Rating"}),e.jsx("option",{value:"company",children:"Company A-Z"})]})]})]})]})}),e.jsx("section",{children:N.length>0?e.jsx("div",{className:"space-y-md",children:N.map((r,s)=>e.jsx("div",{className:"group bg-content1/90 backdrop-blur-2xl rounded-3xl border border-divider/50 container-p-lg hover:shadow-2xl hover:shadow-primary/5 transition-all duration-500 hover:border-primary/30 transform hover:scale-[1.01]",style:{animationDelay:`${s*100}ms`},children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-md mb-lg",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary/20 to-secondary/20 rounded-2xl flex items-center justify-center",children:e.jsx(n.star,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-foreground group-hover:text-primary transition-colors duration-300",children:r.company_name}),e.jsx("div",{className:"flex items-center gap-md",children:e.jsxs("div",{className:"flex items-center gap-xs",children:[[...Array(5)].map((a,w)=>{const z=Math.round(r.rating||0);return e.jsx(n.star,{className:`w-4 h-4 ${w<z?"text-warning fill-current":"text-foreground/300"}`},w)}),e.jsxs("span",{className:"ml-sm text-sm font-semibold text-foreground/80",children:[(r.rating||0).toFixed(1),"/5"]})]})})]})]}),r.review&&e.jsx("div",{className:"bg-content2/50 rounded-2xl container-p-lg mb-lg border border-divider/30",children:e.jsxs("p",{className:"text-foreground/80 leading-relaxed italic",children:['"',r.review,'"']})}),e.jsxs("div",{className:"flex flex-wrap items-center gap-lg text-sm text-foreground/60 mb-lg",children:[e.jsxs("span",{className:"flex items-center gap-xs",children:[e.jsx(n.calendar,{className:"w-4 h-4"}),"Rated on ",new Date(r.created_at).toLocaleDateString()]}),r.updated_at!==r.created_at&&e.jsxs("span",{className:"flex items-center gap-xs",children:[e.jsx(n.refresh,{className:"w-4 h-4"}),"Updated on ",new Date(r.updated_at).toLocaleDateString()]})]}),e.jsxs("button",{onClick:()=>E(r),className:"flex items-center gap-sm px-xl py-md bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white rounded-2xl font-semibold transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-primary/25",children:[e.jsx(n.edit,{className:"w-4 h-4"}),"Edit Rating"]})]})})},r.id))}):e.jsxs("div",{className:"text-center py-4xl",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-primary to-secondary rounded-3xl flex items-center justify-center mb-2xl mx-auto shadow-2xl shadow-primary/20",children:e.jsx(n.star,{className:"w-10 h-10 text-white"})}),e.jsx("h3",{className:"text-2xl font-bold gradient-text mb-lg",children:i!=="all"?`No ${i}-star ratings found`:"No ratings yet"}),e.jsx("p",{className:"text-xl text-foreground/70 mb-2xl max-w-lg mx-auto",children:i!=="all"?"Try adjusting your filter criteria or rate some platforms first.":"Start rating platforms to see them appear here and help the community."}),e.jsxs("button",{onClick:()=>window.location.href="/deals",className:"px-2xl py-lg bg-gradient-to-r from-primary to-secondary hover:from-primary/90 hover:to-secondary/90 text-white rounded-2xl font-semibold text-lg transition-all duration-300 hover:scale-105 hover:shadow-2xl hover:shadow-primary/25",children:[e.jsx(n.search,{className:"w-5 h-5 mr-sm inline"}),"Browse Platforms"]})]})}),u&&v&&e.jsx(K,{isOpen:u,onClose:U,companyId:v,companyName:k,existingRating:M,onRatingSubmitted:q,companyRating:A})]})})};export{ee as default};
