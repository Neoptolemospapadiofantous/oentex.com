import{r as h,j as s,h as m,t as M,u as R,q as g,s as W}from"./heroui-0ik-TEjB.js";import{u as I,a as d,I as o,l as $,b as F}from"./index-8n21VcdY.js";import{a as T}from"./router-Cc6Kb6KN.js";import"./query-CmYTTArA.js";const _=()=>{const[e,n]=h.useState({isLoading:!1,loadingProvider:null,success:!1,error:null,registrationStep:"email",email:"",password:"",confirmPassword:"",fullName:"",isEmailValid:!1,isPasswordValid:!1,isConfirmPasswordValid:!1}),{signInWithGoogle:f,signInWithMicrosoft:x,signUpWithEmail:j}=I(),u=T();h.useEffect(()=>{n({isLoading:!1,loadingProvider:null,success:!1,error:null,registrationStep:"email",email:"",password:"",confirmPassword:"",fullName:"",isEmailValid:!1,isPasswordValid:!1,isConfirmPasswordValid:!1})},[]);const b=r=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r),y=r=>r.length>=12,P=r=>{let t=r;r.length>0&&!r.startsWith(" ")&&(t=` ${r}`);const i=t.trim(),a=b(i);n(l=>({...l,email:t,isEmailValid:a})),e.error&&(e.error.includes("email")||e.error.includes("Email"))&&e.registrationStep==="email"&&n(l=>({...l,error:null}))},v=r=>{let t=r;r.length>0&&!r.startsWith(" ")&&(t=` ${r}`);const i=t.trim(),a=y(i);n(l=>({...l,password:t,isPasswordValid:a})),e.error&&(e.error.includes("password")||e.error.includes("Password"))&&e.registrationStep==="password"&&n(l=>({...l,error:null}))},V=r=>{let t=r;r.length>0&&!r.startsWith(" ")&&(t=` ${r}`);const i=t.trim(),a=e.password.trim(),l=i===a&&i.length>=12;n(c=>({...c,confirmPassword:t,isConfirmPasswordValid:l})),e.error&&(e.error.includes("password")||e.error.includes("Password"))&&e.registrationStep==="password"&&n(c=>({...c,error:null}))},C=r=>{let t=r;r.length>0&&!r.startsWith(" ")&&(t=` ${r}`),n(i=>({...i,fullName:t})),e.error&&(e.error.includes("name")||e.error.includes("Name"))&&e.registrationStep==="password"&&n(i=>({...i,error:null}))},p=()=>{e.isEmailValid?n(r=>({...r,registrationStep:"password",error:null})):d("Please enter a valid email address","Invalid Email")},w=async()=>{if(n(a=>({...a,error:null})),!e.isEmailValid||!e.isPasswordValid||!e.isConfirmPasswordValid){const a="Please fill in all fields correctly";n(l=>({...l,error:a})),d(a,"Validation Error");return}const r=e.password.trim(),t=e.confirmPassword.trim();if(r!==t){const a="Passwords do not match";n(l=>({...l,error:a})),d(a,"Password Error");return}if(!e.email.trim()||!r||!e.fullName.trim()){const a="All fields are required";n(l=>({...l,error:a})),d(a,"Required Fields");return}n(a=>({...a,isLoading:!0,error:null}));const i=setTimeout(()=>{n(a=>({...a,isLoading:!1,error:"Request timed out. Please check your connection and try again."}))},3e4);try{const a=await j(e.email.trim(),r,{full_name:e.fullName.trim()});if(clearTimeout(i),a.error){const l=a.error.message||"Failed to create account. Please try again.";console.log("🔍 Registration error in component:",{error:a.error,errorMessage:l,errorType:a.error.type,fullError:JSON.stringify(a.error,null,2)}),n(c=>({...c,isLoading:!1,error:l})),d(l,"Registration Failed")}else n(l=>({...l,isLoading:!1,success:!0})),F("Account created successfully! Redirecting to dashboard...","Welcome to Oentex!",3e3),setTimeout(()=>u("/dashboard"),2e3)}catch(a){clearTimeout(i),console.error("Registration error:",a);let l="Failed to create account. Please try again.";a instanceof Error&&(a.message.includes("network")?l="Network error. Please check your connection and try again.":a.message.includes("timeout")?l="Request timed out. Please try again.":a.message.includes("rate limit")?l="Too many attempts. Please wait a moment and try again.":a.message.includes("abort")?l="Request was cancelled. Please try again.":l=a.message),n(c=>({...c,isLoading:!1,error:l})),d(l,"Registration Failed")}},E=()=>{n(r=>({...r,registrationStep:"email",error:null}))},k=()=>{n(r=>({...r,error:null})),e.registrationStep==="password"?w():p()},S=h.useCallback(async r=>{if(!e.isLoading){n(t=>({...t,isLoading:!0,loadingProvider:r,error:null}));try{const t=r==="google"?await f():await x();if(t.error){let i=t.error.message||`Failed to sign in with ${r}. Please try again.`;t.error.message.includes("popup")?i="Popup blocked. Please allow popups and try again.":t.error.message.includes("cancelled")?i="Sign-in was cancelled. Please try again.":t.error.message.includes("network")?i="Network error. Please check your connection and try again.":t.error.message.includes("rate limit")&&(i="Too many attempts. Please wait a moment and try again."),n(a=>({...a,isLoading:!1,loadingProvider:null,error:i})),d(i,`${r.charAt(0).toUpperCase()+r.slice(1)} Sign-in Failed`)}else n(i=>({...i,isLoading:!1,loadingProvider:null,success:!0})),setTimeout(()=>u("/dashboard"),2e3)}catch(t){console.error("OAuth sign-in error:",t);let i=`Failed to sign in with ${r}. Please try again.`;t instanceof Error&&(t.message.includes("popup")?i="Popup blocked. Please allow popups and try again.":t.message.includes("cancelled")?i="Sign-in was cancelled. Please try again.":t.message.includes("network")?i="Network error. Please check your connection and try again.":t.message.includes("timeout")?i="Request timed out. Please try again.":t.message.includes("rate limit")?i="Too many attempts. Please wait a moment and try again.":i=t.message),n(a=>({...a,isLoading:!1,loadingProvider:null,error:i})),d(i,`${r.charAt(0).toUpperCase()+r.slice(1)} Sign-in Failed`)}}},[e.isLoading,f,x,u]),L=()=>s.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 21 21",fill:"none","aria-hidden":"true",children:[s.jsx("path",{d:"M10 1H1v9h9V1z",fill:"#f25022"}),s.jsx("path",{d:"M20 1h-9v9h9V1z",fill:"#7fba00"}),s.jsx("path",{d:"M10 11H1v9h9v-9z",fill:"#00a4ef"}),s.jsx("path",{d:"M20 11h-9v9h9v-9z",fill:"#ffb900"})]}),z=()=>s.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:[s.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),s.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),s.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z",fill:"#FBBC05"}),s.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),N=({provider:r,icon:t,label:i})=>{const a=e.loadingProvider===r,l=e.isLoading;return s.jsx(m,{onPress:()=>S(r),isDisabled:l,variant:"solid",color:"default",size:"md",className:"w-full font-medium py-md text-sm rounded-lg bg-default-100 hover:bg-default-200 text-foreground border-0 shadow-none transition-all duration-200 hover:scale-[1.01] active:scale-[0.99]",startContent:a?s.jsx(W,{size:"sm",className:"text-current"}):s.jsx("div",{className:"flex items-center justify-center",children:t}),isLoading:a,children:s.jsx("span",{className:"ml-md",children:a?"Connecting...":i})})};return e.success?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background section-px-lg",children:s.jsxs("div",{className:"w-full max-w-md text-center border border-divider rounded-large bg-content1 shadow-medium p-lg",children:[s.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-success-200 to-success-300 rounded-full flex items-center justify-center mx-auto mb-2xl shadow-lg",children:s.jsx(o.success,{className:"w-10 h-10 text-success"})}),s.jsx("h2",{className:"text-3xl font-bold text-foreground mb-lg",children:"Welcome to Oentex!"}),s.jsx("p",{className:"text-foreground-500 text-lg mb-2xl",children:"Your account has been created. Redirecting to dashboard..."}),s.jsx("div",{className:"w-64 h-2 bg-success-200 rounded-full mx-auto overflow-hidden",children:s.jsx("div",{className:"w-full h-full bg-gradient-to-r from-success to-success-400 animate-pulse rounded-full"})})]})}):s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background section-px-md py-md",children:s.jsxs("div",{className:"w-full max-w-sm border border-divider rounded-large bg-content1 shadow-medium p-lg",children:[s.jsxs("div",{className:"text-center mb-lg",children:[s.jsx("div",{className:"flex items-center justify-center gap-md mb-md",children:s.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-primary to-secondary rounded-full flex items-center justify-center shadow-lg",children:s.jsx("img",{src:$,alt:"Oentex Logo",className:"w-8 h-8 object-contain"})})}),s.jsx("p",{className:"text-foreground-500 text-base",children:"Sign up or Login with"})]}),s.jsxs("div",{className:"space-y-md mb-lg",children:[s.jsx(N,{provider:"google",icon:s.jsx(z,{}),label:"Google"}),s.jsx(N,{provider:"microsoft",icon:s.jsx(L,{}),label:"Microsoft"})]}),e.error&&s.jsx("div",{className:"bg-danger-50 border border-danger-300 rounded-large container-p-md mb-md shadow-small",children:s.jsxs("div",{className:"flex items-center justify-between gap-sm",children:[s.jsxs("div",{className:"flex items-center gap-sm",children:[s.jsx(o.warning,{className:"w-4 h-4 text-danger flex-shrink-0"}),s.jsx("p",{className:"text-danger text-sm font-medium",children:e.error})]}),s.jsxs("div",{className:"flex gap-xs",children:[e.error.includes("already exists")&&s.jsx(m,{size:"sm",variant:"solid",color:"primary",onPress:()=>{n(r=>({...r,error:null,registrationStep:"email"}))},className:"text-white",children:"Sign In Instead"}),s.jsx(m,{size:"sm",variant:"light",color:"danger",onPress:k,className:"text-danger hover:bg-danger-100",children:"Retry"})]})]})}),s.jsxs("div",{className:"relative mb-md",children:[s.jsx("div",{className:"absolute inset-0 flex items-center",children:s.jsx("div",{className:"w-full border-t border-divider"})}),s.jsx("div",{className:"relative flex justify-center text-sm",children:s.jsx("span",{className:"px-md bg-content1 text-foreground-500 border border-divider rounded-full",children:"OR"})})]}),s.jsx(M,{className:"mb-md border border-divider shadow-small bg-content2",children:s.jsx(R,{className:"container-p-md",children:e.registrationStep==="email"?s.jsxs("div",{className:"space-y-md",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground mb-sm",children:"Enter your email"}),s.jsx("p",{className:"text-sm text-foreground-500",children:"We'll send you a verification link"})]}),s.jsx(g,{type:"email",placeholder:"name@example.com",value:e.email,onValueChange:P,isInvalid:e.email.length>0&&!e.isEmailValid,className:"w-full",size:"md",startContent:s.jsx(o.mail,{className:"w-4 h-4 text-foreground-400 mr-2"}),endContent:e.email.length>0&&e.isEmailValid?s.jsx(o.check,{className:"w-4 h-4 text-success"}):e.email.length>0&&!e.isEmailValid?s.jsx(o.warning,{className:"w-4 h-4 text-danger"}):null,classNames:{input:"pl-4 text-white placeholder:text-foreground-400 ml-2",inputWrapper:`focus-within:border-primary focus-within:shadow-none bg-content2 ${e.email.length>0&&!e.isEmailValid?"border-danger":e.email.length>0&&e.isEmailValid?"border-success":""}`,innerWrapper:"gap-3"}}),s.jsx(m,{onPress:p,isDisabled:!e.isEmailValid,color:"primary",size:"md",className:"w-full font-medium",children:"Continue"})]}):s.jsxs("div",{className:"space-y-md",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground mb-sm",children:"Create your password"}),s.jsx("p",{className:"text-sm text-foreground-500",children:"Choose a strong password for your account"})]}),s.jsxs("div",{className:"space-y-sm",children:[s.jsx(g,{type:"text",placeholder:" Full Name",value:e.fullName,onValueChange:C,isInvalid:e.fullName.length>0&&e.fullName.trim().length===0,className:"w-full",size:"md",startContent:s.jsx(o.user,{className:"w-4 h-4 text-foreground-400"}),endContent:e.fullName.length>0&&e.fullName.trim().length>0?s.jsx(o.check,{className:"w-4 h-4 text-success"}):e.fullName.length>0&&e.fullName.trim().length===0?s.jsx(o.warning,{className:"w-4 h-4 text-danger"}):null,classNames:{input:"pl-md text-white placeholder:text-foreground-400",inputWrapper:`focus-within:border-primary focus-within:shadow-none bg-content2 ${e.fullName.length>0&&e.fullName.trim().length===0?"border-danger":e.fullName.length>0&&e.fullName.trim().length>0?"border-success":""}`}}),s.jsxs("div",{className:"space-y-sm",children:[s.jsx(g,{type:"password",placeholder:" Password (min. 12 characters)",value:e.password,onValueChange:v,isInvalid:e.password.length>0&&!e.isPasswordValid,className:"w-full",size:"md",startContent:s.jsx(o.lock,{className:"w-4 h-4 text-foreground-400"}),endContent:e.password.length>0&&e.isPasswordValid?s.jsx(o.check,{className:"w-4 h-4 text-success"}):e.password.length>0&&!e.isPasswordValid?s.jsx(o.warning,{className:"w-4 h-4 text-danger"}):null,classNames:{input:"pl-md text-white placeholder:text-foreground-400",inputWrapper:`focus-within:border-primary focus-within:shadow-none bg-content2 ${e.password.length>0&&!e.isPasswordValid?"border-danger":e.password.length>0&&e.isPasswordValid?"border-success":""}`}}),e.password.length>0&&s.jsxs("div",{className:"flex items-center gap-sm",children:[s.jsx("div",{className:"flex-1 bg-content3 rounded-full h-1",children:s.jsx("div",{className:`h-1 rounded-full transition-all duration-300 ${e.password.length<6?"bg-danger w-1/4":e.password.length<9?"bg-warning w-1/2":e.password.length<12?"bg-warning w-3/4":"bg-success w-full"}`})}),s.jsx("span",{className:`text-xs font-medium ${e.password.length<6?"text-danger":e.password.length<9||e.password.length<12?"text-warning":"text-success"}`,children:e.password.length<6?"Weak":e.password.length<9?"Fair":e.password.length<12?"Good":"Strong"})]})]}),s.jsx(g,{type:"password",placeholder:" Confirm Password",value:e.confirmPassword,onValueChange:V,isInvalid:e.confirmPassword.length>0&&!e.isConfirmPasswordValid,className:"w-full",size:"md",startContent:s.jsx(o.lock,{className:"w-4 h-4 text-foreground-400"}),endContent:e.confirmPassword.length>0&&e.isConfirmPasswordValid?s.jsx(o.check,{className:"w-4 h-4 text-success"}):e.confirmPassword.length>0&&!e.isConfirmPasswordValid?s.jsx(o.warning,{className:"w-4 h-4 text-danger"}):null,classNames:{input:"pl-md text-white placeholder:text-foreground-400",inputWrapper:`focus-within:border-primary focus-within:shadow-none bg-content2 ${e.confirmPassword.length>0&&!e.isConfirmPasswordValid?"border-danger":e.confirmPassword.length>0&&e.isConfirmPasswordValid?"border-success":""}`}})]}),s.jsxs("div",{className:"flex gap-md pt-sm",children:[s.jsx(m,{onPress:E,variant:"bordered",size:"md",className:"flex-1 font-medium",children:"Back"}),s.jsx(m,{onPress:w,isDisabled:!e.isEmailValid||!e.isPasswordValid||!e.isConfirmPasswordValid||e.isLoading,color:"primary",size:"md",className:"flex-1 font-medium",isLoading:e.isLoading,children:e.isLoading?"Creating Account...":"Create Account"})]})]})})}),s.jsx("div",{className:"text-center mt-md",children:s.jsxs("p",{className:"text-xs text-foreground-400",children:["By continuing, you agree to our"," ",s.jsx("button",{onClick:()=>u("/terms"),className:"text-primary hover:text-primary-600 underline font-medium cursor-pointer transition-colors duration-200",children:"Terms"})," ","and"," ",s.jsx("button",{onClick:()=>u("/privacy"),className:"text-primary hover:text-primary-600 underline font-medium cursor-pointer transition-colors duration-200",children:"Privacy Policy"})]})}),s.jsx("div",{className:"text-center mt-sm",children:s.jsx("button",{className:"text-xs bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent hover:opacity-80 transition-opacity duration-200",children:"Need help?"})})]})})};export{_ as Authentication,_ as default};
